SELECT
	T0.SHORI,
	T0.DENPYOU_DATE,
	T0.NYUUKIN_NUMBER,
	T0.TORIHIKISAKI_CD,
	T0.TORIHIKISAKI_NAME_RYAKU,
	T0.BANK_NAME_RYAKU,
	T0.BANK_SHIETN_NAME_RYAKU,
	T0.KOUZA_SHURUI,
	T0.KOUZA_NO,	
	T0.SYSTEM_ID,
	T0.SEQ,
	T0.UPDATE_USER,
	T0.UPDATE_DATE,
	T0.CREATE_USER,
	T0.CREATE_DATE
FROM
(
SELECT
	case 
	when T1.SEQ = 1 then '新規' 
	when T1.SEQ <> 1 and T1.SEQ <> TX.SEQ then '修正'
	when T1.SEQ <> 1 and T1.SEQ = TX.SEQ and T1.DELETE_FLG = 0 then '修正'
	when T1.SEQ <> 1 and T1.SEQ = TX.SEQ and T1.DELETE_FLG <> 0 then '削除'
	else ''
	end as SHORI,
	CONVERT(varchar,CONVERT(varchar,T1.DENPYOU_DATE,111) + '(' + LEFT(DATENAME(weekday, T1.DENPYOU_DATE),1) + ')') AS DENPYOU_DATE,
	T2.BANK_NAME_RYAKU AS BANK_NAME_RYAKU,
	T3.BANK_SHIETN_NAME_RYAKU AS BANK_SHIETN_NAME_RYAKU,
	T1.KOUZA_SHURUI AS KOUZA_SHURUI,
	T1.KOUZA_NO AS KOUZA_NO,
	T1.TORIHIKISAKI_CD AS TORIHIKISAKI_CD,
	T4.TORIHIKISAKI_NAME_RYAKU AS TORIHIKISAKI_NAME_RYAKU,
	T1.SYSTEM_ID AS SYSTEM_ID,
	T1.SEQ AS SEQ,
	T1.UPDATE_USER AS UPDATE_USER,
	T1.UPDATE_DATE,
	T1.CREATE_USER AS CREATE_USER,
	T1.CREATE_DATE,
	T1.NYUUKIN_NUMBER AS NYUUKIN_NUMBER

	

FROM dbo.T_NYUUKIN_ENTRY AS T1 
	LEFT JOIN T_NYUUKIN_SUM_ENTRY TS1 ON T1.SYSTEM_ID = TS1.SYSTEM_ID AND T1.SEQ = TS1.SEQ AND T1.NYUUKIN_NUMBER = TS1.NYUUKIN_NUMBER
	LEFT JOIN dbo.M_BANK AS T2 ON T1.BANK_CD = T2.BANK_CD
	LEFT JOIN dbo.M_BANK_SHITEN AS T3 ON  T1.BANK_CD = T3.BANK_CD AND T1.BANK_SHITEN_CD = T3.BANK_SHITEN_CD AND T1.KOUZA_SHURUI=T3.KOUZA_SHURUI AND T1.KOUZA_NO=T3.KOUZA_NO
	LEFT JOIN dbo.M_TORIHIKISAKI AS T4 ON T1.TORIHIKISAKI_CD = T4.TORIHIKISAKI_CD AND T4.DELETE_FLG = 0
	JOIN (SELECT MAX(SEQ) AS SEQ,SYSTEM_ID FROM T_NYUUKIN_ENTRY   group by SYSTEM_ID) AS TX ON T1.SYSTEM_ID = TX.SYSTEM_ID

WHERE 
T1.DELETE_FLG = T1.DELETE_FLG
/*IF !kyotenCD.IsNull && ''!=kyotenCD*/AND T1.KYOTEN_CD = /*kyotenCD*/0 /*END*/
/*IF !updateFrom.IsNull && ''!=updateFrom*/AND CONVERT(date, T1.UPDATE_DATE) >= CONVERT(date, /*updateFrom*/0) /*END*/
/*IF !updateTo.IsNull && ''!=updateTo*/AND CONVERT(date, T1.UPDATE_DATE) <= CONVERT(date, /*updateTo*/0) /*END*/
) AS T0
WHERE 
T0.SEQ = T0.SEQ
/*IF !appendWhere.IsNull && ''!=appendWhere*//*$appendWhere*//*END*/

ORDER BY SYSTEM_ID desc, SEQ asc
