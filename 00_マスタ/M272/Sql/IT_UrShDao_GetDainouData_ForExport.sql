SELECT 
	SHORI,
	DENPYOU_DATE,
	DENPYOU_NUMBER,
	KUBUN,
	TORIHIKISAKI_CD,
	TORIHIKISAKI_NAME,
	GYOUSHA_CD,
	GYOUSHA_NAME,
	GENBA_CD,
	GENBA_NAME,
	UNPAN_GYOUSHA_CD,
	UNPAN_GYOUSHA_NAME,
	SHASHU,
	SHARYOU,
	UNTENSHA,
	KOUSHIN_SHA,
	KOUSHIN_BI,
	SAKUSEI_SHA,
	SAKUSEI_BI,
	SYSTEM_ID,
	SEQ
FROM
(	
	--------------URIAGE START----------------------
	SELECT
		CASE 
			WHEN T1.SEQ = 1 THEN '新規' 
			WHEN T1.SEQ <> 1 and T1.SEQ <> TX.SEQ THEN '修正'
			WHEN T1.SEQ <> 1 and T1.SEQ = TX.SEQ and T1.DELETE_FLG = 0 THEN '修正'
			WHEN T1.SEQ <> 1 and T1.SEQ = TX.SEQ and T1.DELETE_FLG <> 0 THEN '削除'
			ELSE ''
		END AS SHORI,
		T1.DENPYOU_DATE AS DENPYOU_DATE,
		T1.UR_SH_NUMBER AS DENPYOU_NUMBER,
		0 AS KUBUN_NUM,
		'受入' AS KUBUN,
		T1.TORIHIKISAKI_CD AS TORIHIKISAKI_CD,
		T1.TORIHIKISAKI_NAME AS TORIHIKISAKI_NAME,
		T1.GYOUSHA_CD AS GYOUSHA_CD,
		T1.GYOUSHA_NAME AS GYOUSHA_NAME,
		T1.GENBA_CD AS GENBA_CD,
		T1.GENBA_NAME AS GENBA_NAME,
		T1.UNPAN_GYOUSHA_CD AS UNPAN_GYOUSHA_CD,
		T1.UNPAN_GYOUSHA_NAME AS UNPAN_GYOUSHA_NAME,
		T1.SHASHU_NAME AS SHASHU,
		T1.SHARYOU_NAME AS SHARYOU,
		T1.UNTENSHA_NAME AS UNTENSHA,
		T1.UPDATE_USER AS KOUSHIN_SHA,
		T1.UPDATE_DATE AS KOUSHIN_BI,
		T1.CREATE_USER AS SAKUSEI_SHA,
		T1.CREATE_DATE AS SAKUSEI_BI,
		T1.SYSTEM_ID AS SYSTEM_ID,
		T1.SEQ AS SEQ
	FROM dbo.T_UR_SH_ENTRY AS T1 ,(SELECT MAX(SEQ) AS SEQ,SYSTEM_ID FROM T_UR_SH_ENTRY   group by SYSTEM_ID) AS TX

	WHERE 
	T1.DELETE_FLG = T1.DELETE_FLG AND T1.DAINOU_FLG = 1 AND T1.SHIHARAI_DATE IS NOT NULL AND T1.SHIHARAI_DATE <> ''
	/*IF !kyotenCD.IsNull && ''!=kyotenCD*/AND T1.KYOTEN_CD = /*kyotenCD*/0 /*END*/
	/*IF !updateFrom.IsNull && ''!=updateFrom*/AND CONVERT(date, T1.UPDATE_DATE) >= CONVERT(date, /*updateFrom*/0) /*END*/
	/*IF !updateTo.IsNull && ''!=updateTo*/AND CONVERT(date, T1.UPDATE_DATE) <= CONVERT(date, /*updateTo*/0) /*END*/
	AND T1.SEQ = T1.SEQ  AND T1.SYSTEM_ID = TX.SYSTEM_ID
	--------------URIAGE END----------------------
	UNION ALL
	--------------SHIHARAI START------------------
	SELECT			
		CASE 
			WHEN T1.SEQ = 1 THEN '新規' 
			WHEN T1.SEQ <> 1 and T1.SEQ <> TX.SEQ THEN '修正'
			WHEN T1.SEQ <> 1 and T1.SEQ = TX.SEQ and T1.DELETE_FLG = 0 THEN '修正'
			WHEN T1.SEQ <> 1 and T1.SEQ = TX.SEQ and T1.DELETE_FLG <> 0 THEN '削除'
			ELSE ''
		END AS SHORI,
		T1.DENPYOU_DATE AS DENPYOU_DATE,
		T1.UR_SH_NUMBER AS DENPYOU_NUMBER,
		1 AS KUBUN_NUM,
		'出荷' AS KUBUN,
		T1.TORIHIKISAKI_CD AS TORIHIKISAKI_CD,
		T1.TORIHIKISAKI_NAME AS TORIHIKISAKI_NAME,
		T1.GYOUSHA_CD AS GYOUSHA_CD,
		T1.GYOUSHA_NAME AS GYOUSHA_NAME,
		T1.GENBA_CD AS GENBA_CD,
		T1.GENBA_NAME AS GENBA_NAME,
		T1.UNPAN_GYOUSHA_CD AS UNPAN_GYOUSHA_CD,
		T1.UNPAN_GYOUSHA_NAME AS UNPAN_GYOUSHA_NAME,
		T1.SHASHU_NAME AS SHASHU,
		T1.SHARYOU_NAME AS SHARYOU,
		T1.UNTENSHA_NAME AS UNTENSHA,
		T1.UPDATE_USER AS KOUSHIN_SHA,
		T1.UPDATE_DATE AS KOUSHIN_BI,
		T1.CREATE_USER AS SAKUSEI_SHA,
		T1.CREATE_DATE AS SAKUSEI_BI,
		T1.SYSTEM_ID AS SYSTEM_ID,
		T1.SEQ AS SEQ
	FROM dbo.T_UR_SH_ENTRY AS T1 ,(SELECT MAX(SEQ) AS SEQ,SYSTEM_ID FROM T_UR_SH_ENTRY   group by SYSTEM_ID) AS TX

	WHERE 
	T1.DELETE_FLG = T1.DELETE_FLG AND T1.DAINOU_FLG = 1 AND T1.URIAGE_DATE IS NOT NULL AND T1.URIAGE_DATE <> ''
	/*IF !kyotenCD.IsNull && ''!=kyotenCD*/AND T1.KYOTEN_CD = /*kyotenCD*/0 /*END*/
	/*IF !updateFrom.IsNull && ''!=updateFrom*/AND CONVERT(date, T1.UPDATE_DATE) >= CONVERT(date, /*updateFrom*/0) /*END*/
	/*IF !updateTo.IsNull && ''!=updateTo*/AND CONVERT(date, T1.UPDATE_DATE) <= CONVERT(date, /*updateTo*/0) /*END*/
	AND T1.SEQ = T1.SEQ  AND T1.SYSTEM_ID = TX.SYSTEM_ID
	--------------SHIHARAI END--------------------
) AS T0
WHERE 
T0.SEQ = T0.SEQ
/*IF !appendWhere.IsNull && ''!=appendWhere*//*$appendWhere*//*END*/

ORDER BY DENPYOU_NUMBER DESC, SEQ ASC, KUBUN_NUM ASC
