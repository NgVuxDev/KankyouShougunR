SELECT 
	ITA.ITAKU_KEIYAKU_NO,
	ITA.HAISHUTSU_JIGYOUSHA_CD AS GYOUSHA_CD,
	GYO.GYOUSHA_NAME_RYAKU,
	GYO.GYOUSHA_POST,
	GYOTODO.TODOUFUKEN_NAME_RYAKU AS GYOUSHA_TODOUFUKEN_NAME_RYAKU,
	GYO.GYOUSHA_ADDRESS1,
	ITA.HAISHUTSU_JIGYOUJOU_CD AS GENBA_CD,
	GEN.GENBA_NAME_RYAKU,
	GEN.GENBA_POST,
	GENTODO.TODOUFUKEN_NAME_RYAKU AS GENBA_TODOUFUKEN_NAME_RYAKU,
	GEN.GENBA_ADDRESS1,
	GEN.GENBA_TEL,
	KYO.CHIIKI_CD,
	CHI.CHIIKI_NAME_RYAKU,
	KYO.KYOKA_KBN,
	KYO.FUTSUU_KYOKA_NO AS KYOKA_NO,
	UPN.SYSTEM_ID AS UPN_SYSTEM_ID,
	SBN.SYSTEM_ID AS SBN_SYSTEM_ID
FROM 
    dbo.M_CHIIKIBETSU_KYOKA KYO
	LEFT JOIN dbo.M_CHIIKI CHI ON CHI.CHIIKI_CD = KYO.CHIIKI_CD
	LEFT JOIN dbo.M_ITAKU_UPN_KYOKASHO UPN ON UPN.GYOUSHA_CD = KYO.GYOUSHA_CD AND UPN.GENBA_CD = KYO.GENBA_CD AND UPN.CHIIKI_CD = KYO.CHIIKI_CD AND UPN.KYOKA_KBN = ((KYO.KYOKA_KBN * 2) - 1) AND UPN.KYOKA_NO = KYO.FUTSUU_KYOKA_NO
	LEFT JOIN dbo.M_ITAKU_SBN_KYOKASHO SBN ON SBN.GYOUSHA_CD = KYO.GYOUSHA_CD AND SBN.GENBA_CD = KYO.GENBA_CD AND SBN.CHIIKI_CD = KYO.CHIIKI_CD AND SBN.KYOKA_KBN = ((KYO.KYOKA_KBN * 2) - 1) AND SBN.KYOKA_NO = KYO.FUTSUU_KYOKA_NO
	INNER JOIN dbo.M_ITAKU_KEIYAKU_KIHON ITA ON ITA.SYSTEM_ID = UPN.SYSTEM_ID OR ITA.SYSTEM_ID = SBN.SYSTEM_ID
	LEFT JOIN dbo.M_GYOUSHA GYO ON GYO.GYOUSHA_CD = ITA.HAISHUTSU_JIGYOUSHA_CD
	LEFT JOIN dbo.M_TODOUFUKEN GYOTODO ON GYOTODO.TODOUFUKEN_CD = GYO.GYOUSHA_TODOUFUKEN_CD
	LEFT JOIN dbo.M_GENBA GEN ON GEN.GYOUSHA_CD = ITA.HAISHUTSU_JIGYOUSHA_CD AND GEN.GENBA_CD = ITA.HAISHUTSU_JIGYOUJOU_CD
	LEFT JOIN dbo.M_TODOUFUKEN GENTODO ON GEN.GENBA_TODOUFUKEN_CD = GENTODO.TODOUFUKEN_CD
WHERE KYO.DELETE_FLG = 0
  AND (KYO.FUTSUU_KYOKA_NO IS NOT NULL AND KYO.FUTSUU_KYOKA_NO != '')
  /*IF !data.KYOKA_KBN.IsNull*/AND KYO.KYOKA_KBN = /*data.KYOKA_KBN*/1/*END*/
  /*IF data.GYOUSHA_CD != null*/AND KYO.GYOUSHA_CD = /*data.GYOUSHA_CD*/'000001'/*END*/
  /*IF data.GENBA_CD != null*/AND KYO.GENBA_CD = /*data.GENBA_CD*/'000001'/*END*/
  /*IF data.CHIIKI_CD != null*/AND KYO.CHIIKI_CD = /*data.CHIIKI_CD*/'000001'/*END*/
  /*IF data.FUTSUU_KYOKA_NO != null*//*IF data.FUTSUU_KYOKA_NO != ''*/AND KYO.FUTSUU_KYOKA_NO = /*data.FUTSUU_KYOKA_NO*/'00000000000'/*END*//*END*/
  /*IF !data.FUTSUU_KYOKA_BEGIN.IsNull*/AND KYO.FUTSUU_KYOKA_END >= CONVERT(DATETIME, /*data.FUTSUU_KYOKA_BEGIN*/null, 120)/*END*/
  /*IF !data.FUTSUU_KYOKA_END.IsNull*/AND KYO.FUTSUU_KYOKA_END <= CONVERT(DATETIME, /*data.FUTSUU_KYOKA_END*/null, 120)/*END*/
ORDER BY KYO.KYOKA_KBN, KYO.GYOUSHA_CD, KYO.GENBA_CD, KYO.CHIIKI_CD, KYO.FUTSUU_KYOKA_NO
