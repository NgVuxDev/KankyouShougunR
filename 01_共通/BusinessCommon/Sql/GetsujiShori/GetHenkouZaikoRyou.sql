--受入量
SELECT '1' AS KBN, NIOROSHI_GYOUSHA_CD AS GYOUSHA_CD,NIOROSHI_GENBA_CD AS GENBA_CD,ZAIKO_HINMEI_CD,SUM(ZAIKO_RYOU) AS ZAIKO_RYOU, SUM(TANKA * ZAIKO_RYOU) AS ZAIKO_KINGAKU FROM T_UKEIRE_ENTRY TUE
INNER JOIN T_UKEIRE_DETAIL TUD 
ON TUE.SYSTEM_ID = TUD.SYSTEM_ID
AND TUE.SEQ = TUD.SEQ
INNER JOIN T_ZAIKO_HINMEI_HURIWAKE MZH
ON MZH.SYSTEM_ID = TUD.SYSTEM_ID
AND MZH.SEQ = TUD.SEQ
AND MZH.DETAIL_SYSTEM_ID = TUD.DETAIL_SYSTEM_ID
AND MZH.DENSHU_KBN_CD = 1
WHERE TUE.NIOROSHI_GYOUSHA_CD = /*data.GYOUSHA_CD*/
AND TUE.NIOROSHI_GENBA_CD = /*data.GENBA_CD*/
AND MZH.ZAIKO_HINMEI_CD = /*data.ZAIKO_HINMEI_CD*/
/*IF !data.FROM_DATE.IsNull*/
AND TUE.DENPYOU_DATE >= /*data.FROM_DATE*/
/*END*/
AND TUE.DENPYOU_DATE <= /*data.TO_DATE*/
AND TUE.DELETE_FLG = 0
AND TUE.KAKUTEI_KBN = 1
AND TUE.TAIRYUU_KBN = 0
GROUP BY NIOROSHI_GYOUSHA_CD,NIOROSHI_GENBA_CD,ZAIKO_HINMEI_CD

UNION 

--出荷量
SELECT '2' AS KBN, NIZUMI_GYOUSHA_CD AS GYOUSHA_CD,NIZUMI_GENBA_CD AS GENBA_CD,ZAIKO_HINMEI_CD,SUM(ZAIKO_RYOU)*-1 AS ZAIKO_RYOU, SUM(TANKA * ZAIKO_RYOU)*-1 AS ZAIKO_KINGAKU FROM T_SHUKKA_ENTRY TSE
INNER JOIN T_SHUKKA_DETAIL TSD 
ON TSE.SYSTEM_ID = TSD.SYSTEM_ID
AND TSE.SEQ = TSD.SEQ
INNER JOIN T_ZAIKO_HINMEI_HURIWAKE MZH
ON MZH.SYSTEM_ID = TSD.SYSTEM_ID
AND MZH.SEQ = TSD.SEQ
AND MZH.DETAIL_SYSTEM_ID = TSD.DETAIL_SYSTEM_ID
AND MZH.DENSHU_KBN_CD = 2
WHERE TSE.NIZUMI_GYOUSHA_CD = /*data.GYOUSHA_CD*/
AND TSE.NIZUMI_GENBA_CD = /*data.GENBA_CD*/
AND MZH.ZAIKO_HINMEI_CD = /*data.ZAIKO_HINMEI_CD*/
/*IF !data.FROM_DATE.IsNull*/
AND TSE.DENPYOU_DATE >= /*data.FROM_DATE*/
/*END*/
AND TSE.DENPYOU_DATE <= /*data.TO_DATE*/
AND TSE.DELETE_FLG = 0
AND TSE.KAKUTEI_KBN = 1
AND TSE.TAIRYUU_KBN = 0
GROUP BY NIZUMI_GYOUSHA_CD,NIZUMI_GENBA_CD,ZAIKO_HINMEI_CD

UNION 

--調整量
SELECT '3' AS KBN, GYOUSHA_CD,GENBA_CD,TZTD.ZAIKO_HINMEI_CD,SUM(TYOUSEI_RYOU) AS ZAIKO_RYOU, SUM(TYOUSEI_RYOU * ISNULL(MZH.ZAIKO_TANKA,0)) AS ZAIKO_KINGAKU FROM T_ZAIKO_TYOUSEI_ENTRY TZTE
INNER JOIN T_ZAIKO_TYOUSEI_DETAIL TZTD
ON TZTE.SYSTEM_ID = TZTD.SYSTEM_ID
AND TZTE.SEQ = TZTD.SEQ
LEFT JOIN M_ZAIKO_HINMEI MZH
ON MZH.ZAIKO_HINMEI_CD = TZTD.ZAIKO_HINMEI_CD
WHERE TZTE.GYOUSHA_CD = /*data.GYOUSHA_CD*/
AND TZTE.GENBA_CD = /*data.GENBA_CD*/
AND TZTD.ZAIKO_HINMEI_CD = /*data.ZAIKO_HINMEI_CD*/
/*IF !data.FROM_DATE.IsNull*/
AND TZTE.TYOUSEI_DATE >= /*data.FROM_DATE*/
/*END*/
AND TZTE.TYOUSEI_DATE <= /*data.TO_DATE*/
GROUP BY GYOUSHA_CD,GENBA_CD,TZTD.ZAIKO_HINMEI_CD

UNION 

--移動量
--該当現場から移動する移動量
SELECT '4' AS KBN, TZIE.GYOUSHA_CD,TZIE.GENBA_CD,TZIE.ZAIKO_HINMEI_CD,SUM(TZID.IDOU_RYOU)*-1 AS ZAIKO_RYOU, SUM(TZID.IDOU_RYOU * ISNULL(MZH.ZAIKO_TANKA,0)) *-1  AS ZAIKO_KINGAKU  FROM T_ZAIKO_IDOU_ENTRY TZIE
INNER JOIN T_ZAIKO_IDOU_DETAIL TZID
ON TZIE.SYSTEM_ID = TZID.SYSTEM_ID
AND TZIE.SEQ = TZID.SEQ
LEFT JOIN M_ZAIKO_HINMEI MZH
ON MZH.ZAIKO_HINMEI_CD = TZIE.ZAIKO_HINMEI_CD
WHERE TZIE.GYOUSHA_CD = /*data.GYOUSHA_CD*/
AND TZIE.GENBA_CD = /*data.GENBA_CD*/
AND TZIE.ZAIKO_HINMEI_CD = /*data.ZAIKO_HINMEI_CD*/
/*IF !data.FROM_DATE.IsNull*/
AND TZIE.IDOU_DATE >= /*data.FROM_DATE*/
/*END*/
AND TZIE.IDOU_DATE <= /*data.TO_DATE*/
GROUP BY TZIE.GYOUSHA_CD,TZIE.GENBA_CD,TZIE.ZAIKO_HINMEI_CD

UNION 

--該当現場に移動する移動量
SELECT '5' AS KBN, TZIE.GYOUSHA_CD,TZID.GENBA_CD,TZIE.ZAIKO_HINMEI_CD,SUM(TZID.IDOU_RYOU) AS ZAIKO_RYOU, SUM(TZID.IDOU_RYOU * ISNULL(MZH.ZAIKO_TANKA,0)) AS ZAIKO_KINGAKU  FROM T_ZAIKO_IDOU_ENTRY TZIE
INNER JOIN T_ZAIKO_IDOU_DETAIL TZID
ON TZIE.SYSTEM_ID = TZID.SYSTEM_ID
AND TZIE.SEQ = TZID.SEQ
LEFT JOIN M_ZAIKO_HINMEI MZH
ON MZH.ZAIKO_HINMEI_CD = TZIE.ZAIKO_HINMEI_CD
WHERE TZIE.GYOUSHA_CD = /*data.GYOUSHA_CD*/
AND TZID.GENBA_CD = /*data.GENBA_CD*/
AND TZIE.ZAIKO_HINMEI_CD = /*data.ZAIKO_HINMEI_CD*/
/*IF !data.FROM_DATE.IsNull*/
AND TZIE.IDOU_DATE >= /*data.FROM_DATE*/
/*END*/
AND TZIE.IDOU_DATE <= /*data.TO_DATE*/
GROUP BY TZIE.GYOUSHA_CD,TZID.GENBA_CD,TZIE.ZAIKO_HINMEI_CD