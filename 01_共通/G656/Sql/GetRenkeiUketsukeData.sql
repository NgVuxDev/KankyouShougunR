-- 検索対象伝票で1.受付が選択された場合
SELECT 
   DENPYOU_TYPE1 AS '伝票'
  ,DENPYOU_NUMBER1 AS '伝票番号'
  ,DENPYOU_DATE1 AS '伝票日付'
  ,TORIHIKISAKI_NAME1 AS '取引先'
  ,GYOUSHA_NAME1 AS '業者'
  ,GENBA_NAME1 AS '現場'
  ,DENPYOU_TYPE2 AS '伝票'
  ,DENPYOU_NUMBER2 AS '伝票番号'
  ,DENPYOU_DATE2 AS '伝票日付'
  ,TORIHIKISAKI_NAME2 AS '取引先'
  ,GYOUSHA_NAME2 AS '業者'
  ,GENBA_NAME2 AS '現場'
  ,DENPYOU_TYPE_KBN AS HIDDEN_DENPYOU_TYPE
  ,DENPYOU_TYPE1 AS HIDDEN_DENPYOU_KBN
  ,DENPYOU_NUMBER1  AS HIDDEN_DENPYOU_NO
  ,DENPYOU_DATE1 AS HIDDEN_DENPYOU_DATE
  ,TORIHIKISAKI_NAME1 AS HIDDEN_TORIHIKISAKI_NAME
  ,GYOUSHA_NAME1 AS HIDDEN_GYOUSHA_NAME
  ,GENBA_NAME1 AS HIDDEN_GENBA_NAME
  ,SYSTEM_ID1 AS HIDDEN_SYSTEM_ID
  ,SYSTEM_ID2 AS HIDDEN_SYSTEM_ID_R
  ,HAIKI_KBN_CD1 AS HIDDEN_HAIKI_KBN_CD
  ,HAIKI_KBN_CD2 AS HIDDEN_HAIKI_KBN_CD_R
FROM(
SELECT 
       '収集受付' AS DENPYOU_TYPE1
      ,SS.UKETSUKE_NUMBER  AS DENPYOU_NUMBER1
      ,SS.SAGYOU_DATE AS DENPYOU_DATE1
      ,SS.TORIHIKISAKI_NAME AS TORIHIKISAKI_NAME1
      ,SS.GYOUSHA_NAME AS GYOUSHA_NAME1
      ,SS.GENBA_NAME AS GENBA_NAME1
	  ,1 AS DENPYOU_TYPE_KBN
      ,'受入' AS DENPYOU_TYPE2
      ,CONVERT(nvarchar,UKEIRE.UKEIRE_NUMBER) AS DENPYOU_NUMBER2
      ,UKEIRE.DENPYOU_DATE AS DENPYOU_DATE2
      ,UKEIRE.TORIHIKISAKI_NAME AS TORIHIKISAKI_NAME2
      ,UKEIRE.GYOUSHA_NAME AS GYOUSHA_NAME2
      ,UKEIRE.GENBA_NAME AS GENBA_NAME2
      ,SS.SYSTEM_ID AS SYSTEM_ID1
	  ,'' AS HAIKI_KBN_CD1
      ,UKEIRE.SYSTEM_ID AS SYSTEM_ID2
	  ,'' AS HAIKI_KBN_CD2
 FROM 
     T_UKETSUKE_SS_ENTRY SS
LEFT JOIN T_UKEIRE_ENTRY UKEIRE
       ON UKEIRE.UKETSUKE_NUMBER = SS.UKETSUKE_NUMBER
      AND UKEIRE.DELETE_FLG = 0
WHERE 
SS.DELETE_FLG = 0
AND (
     (/*data.RENKEI_KBN*/ = 1) 
  OR (/*data.RENKEI_KBN*/ = 2 AND UKEIRE.SYSTEM_ID IS NOT NULL) 
  OR (/*data.RENKEI_KBN*/ = 3 AND UKEIRE.SYSTEM_ID IS NULL)
  )
/*IF !data.KYOTEN_CD.IsNull*/
AND SS.KYOTEN_CD = /*data.KYOTEN_CD*/
/*END*/
/*IF !data.DENPYOU_DATE_FROM.IsNull*/
AND CONVERT(varchar(10), SS.SAGYOU_DATE,120) >= /*data.DENPYOU_DATE_FROM*/
/*END*/
/*IF !data.DENPYOU_DATE_TO.IsNull*/
AND CONVERT(varchar(10), SS.SAGYOU_DATE,120) <= /*data.DENPYOU_DATE_TO*/
/*END*/
/*IF data.DENPYOU_NO != null*/
AND SS.UKETSUKE_NUMBER = /*data.DENPYOU_NO*/
/*END*/
/*IF data.TORIHIKISAKI_CD != null*/
AND SS.TORIHIKISAKI_CD = /*data.TORIHIKISAKI_CD*/
/*END*/
/*IF data.GYOUSHA_CD != null*/
AND SS.GYOUSHA_CD = /*data.GYOUSHA_CD*/
/*END*/
/*IF data.GYOUSHA_CD != null*/
AND SS.GENBA_CD = /*data.GYOUSHA_CD*/
/*END*/

UNION

SELECT 
       '収集受付' AS DENPYOU_TYPE1
      ,SS.UKETSUKE_NUMBER  AS DENPYOU_NUMBER1
      ,SS.SAGYOU_DATE AS DENPYOU_DATE1
      ,SS.TORIHIKISAKI_NAME AS TORIHIKISAKI_NAME1
      ,SS.GYOUSHA_NAME AS GYOUSHA_NAME1
      ,SS.GENBA_NAME AS GENBA_NAME1
	  ,1 AS DENPYOU_TYPE_KBN
      ,'売上支払' AS DENPYOU_TYPE2
      ,CONVERT(nvarchar,URSH.UR_SH_NUMBER) AS DENPYOU_NUMBER2
      ,URSH.DENPYOU_DATE AS DENPYOU_DATE2
      ,URSH.TORIHIKISAKI_NAME AS TORIHIKISAKI_NAME2
      ,URSH.GYOUSHA_NAME AS GYOUSHA_NAME2
      ,URSH.GENBA_NAME AS GENBA_NAME2
      ,SS.SYSTEM_ID AS SYSTEM_ID1
	  ,'' AS HAIKI_KBN_CD1
      ,URSH.SYSTEM_ID AS SYSTEM_ID2
	  ,'' AS HAIKI_KBN_CD2
 FROM 
     T_UKETSUKE_SS_ENTRY SS
LEFT JOIN T_UR_SH_ENTRY URSH
       ON URSH.UKETSUKE_NUMBER = SS.UKETSUKE_NUMBER
      AND URSH.DELETE_FLG = 0
      AND ISNULL(URSH.DAINOU_FLG, 0) = 0
WHERE 
SS.DELETE_FLG = 0
AND (
     (/*data.RENKEI_KBN*/ = 1) 
  OR (/*data.RENKEI_KBN*/ = 2 AND URSH.SYSTEM_ID IS NOT NULL) 
  OR (/*data.RENKEI_KBN*/ = 3 AND URSH.SYSTEM_ID IS NULL)
  )
/*IF !data.KYOTEN_CD.IsNull*/
AND SS.KYOTEN_CD = /*data.KYOTEN_CD*/
/*END*/
/*IF !data.DENPYOU_DATE_FROM.IsNull*/
AND CONVERT(varchar(10), SS.SAGYOU_DATE,120) >= /*data.DENPYOU_DATE_FROM*/
/*END*/
/*IF !data.DENPYOU_DATE_TO.IsNull*/
AND CONVERT(varchar(10), SS.SAGYOU_DATE,120) <= /*data.DENPYOU_DATE_TO*/
/*END*/
/*IF data.DENPYOU_NO != null*/
AND SS.UKETSUKE_NUMBER = /*data.DENPYOU_NO*/
/*END*/
/*IF data.TORIHIKISAKI_CD != null*/
AND SS.TORIHIKISAKI_CD = /*data.TORIHIKISAKI_CD*/
/*END*/
/*IF data.GYOUSHA_CD != null*/
AND SS.GYOUSHA_CD = /*data.GYOUSHA_CD*/
/*END*/
/*IF data.GYOUSHA_CD != null*/
AND SS.GENBA_CD = /*data.GYOUSHA_CD*/
/*END*/

UNION

SELECT 
       '収集受付' AS DENPYOU_TYPE1
      ,SS.UKETSUKE_NUMBER  AS DENPYOU_NUMBER1
      ,SS.SAGYOU_DATE AS DENPYOU_DATE1
      ,SS.TORIHIKISAKI_NAME AS TORIHIKISAKI_NAME1
      ,SS.GYOUSHA_NAME AS GYOUSHA_NAME1
      ,SS.GENBA_NAME AS GENBA_NAME1
	  ,1 AS DENPYOU_TYPE_KBN
      ,'マニフェスト' AS DENPYOU_TYPE2
      ,MANIFEST.MANIFEST_ID AS DENPYOU_NUMBER2
      ,MANIFEST.KOUFU_DATE AS DENPYOU_DATE2
      ,MT.TORIHIKISAKI_NAME_RYAKU AS TORIHIKISAKI_NAME2
      ,MANIFEST.HST_GYOUSHA_NAME AS GYOUSHA_NAME2
      ,MANIFEST.HST_GENBA_NAME AS GENBA_NAME2
      ,SS.SYSTEM_ID AS SYSTEM_ID1
	  ,'' AS HAIKI_KBN_CD1
      ,MANIFEST.SYSTEM_ID AS SYSTEM_ID2
	  ,MANIFEST.HAIKI_KBN_CD AS HAIKI_KBN_CD2
 FROM 
     T_UKETSUKE_SS_ENTRY SS
LEFT JOIN T_MANIFEST_ENTRY MANIFEST
       ON MANIFEST.RENKEI_SYSTEM_ID = SS.SYSTEM_ID
      AND MANIFEST.DELETE_FLG = 0
      AND MANIFEST.RENKEI_DENSHU_KBN_CD = 100
LEFT JOIN M_TORIHIKISAKI MT
       ON MT.TORIHIKISAKI_CD = MANIFEST.TORIHIKISAKI_CD
WHERE 
SS.DELETE_FLG = 0
AND (
     (/*data.RENKEI_KBN*/ = 1) 
  OR (/*data.RENKEI_KBN*/ = 2 AND MANIFEST.SYSTEM_ID IS NOT NULL) 
  OR (/*data.RENKEI_KBN*/ = 3 AND MANIFEST.SYSTEM_ID IS NULL)
  )
/*IF !data.KYOTEN_CD.IsNull*/
AND SS.KYOTEN_CD = /*data.KYOTEN_CD*/
/*END*/
/*IF !data.DENPYOU_DATE_FROM.IsNull*/
AND CONVERT(varchar(10), SS.SAGYOU_DATE,120) >= /*data.DENPYOU_DATE_FROM*/
/*END*/
/*IF !data.DENPYOU_DATE_TO.IsNull*/
AND CONVERT(varchar(10), SS.SAGYOU_DATE,120) <= /*data.DENPYOU_DATE_TO*/
/*END*/
/*IF data.DENPYOU_NO != null*/
AND SS.UKETSUKE_NUMBER = /*data.DENPYOU_NO*/
/*END*/
/*IF data.TORIHIKISAKI_CD != null*/
AND SS.TORIHIKISAKI_CD = /*data.TORIHIKISAKI_CD*/
/*END*/
/*IF data.GYOUSHA_CD != null*/
AND SS.GYOUSHA_CD = /*data.GYOUSHA_CD*/
/*END*/
/*IF data.GYOUSHA_CD != null*/
AND SS.GENBA_CD = /*data.GYOUSHA_CD*/
/*END*/

UNION

SELECT 
       '出荷受付' AS DENPYOU_TYPE1
      ,SK.UKETSUKE_NUMBER  AS DENPYOU_NUMBER1
      ,SK.SAGYOU_DATE AS DENPYOU_DATE1
      ,SK.TORIHIKISAKI_NAME AS TORIHIKISAKI_NAME1
      ,SK.GYOUSHA_NAME AS GYOUSHA_NAME1
      ,SK.GENBA_NAME AS GENBA_NAME1
	  ,2 AS DENPYOU_TYPE_KBN
      ,'出荷' AS DENPYOU_TYPE2
      ,CONVERT(nvarchar,SHUKKA.SHUKKA_NUMBER) AS DENPYOU_NUMBER2
      ,SHUKKA.DENPYOU_DATE AS DENPYOU_DATE2
      ,SHUKKA.TORIHIKISAKI_NAME AS TORIHIKISAKI_NAME2
      ,SHUKKA.GYOUSHA_NAME AS GYOUSHA_NAME2
      ,SHUKKA.GENBA_NAME AS GENBA_NAME2
      ,SK.SYSTEM_ID AS SYSTEM_ID1
	  ,'' AS HAIKI_KBN_CD1
      ,SHUKKA.SYSTEM_ID AS SYSTEM_ID2
	  ,'' AS HAIKI_KBN_CD2
 FROM 
     T_UKETSUKE_SK_ENTRY SK
LEFT JOIN T_SHUKKA_ENTRY SHUKKA
       ON SHUKKA.UKETSUKE_NUMBER = SK.UKETSUKE_NUMBER
      AND SHUKKA.DELETE_FLG = 0
WHERE 
SK.DELETE_FLG = 0
AND (
     (/*data.RENKEI_KBN*/ = 1) 
  OR (/*data.RENKEI_KBN*/ = 2 AND SHUKKA.SYSTEM_ID IS NOT NULL) 
  OR (/*data.RENKEI_KBN*/ = 3 AND SHUKKA.SYSTEM_ID IS NULL)
  )
/*IF !data.KYOTEN_CD.IsNull*/
AND SK.KYOTEN_CD = /*data.KYOTEN_CD*/
/*END*/
/*IF !data.DENPYOU_DATE_FROM.IsNull*/
AND CONVERT(varchar(10),SK.SAGYOU_DATE,120) >= /*data.DENPYOU_DATE_FROM*/
/*END*/
/*IF !data.DENPYOU_DATE_TO.IsNull*/
AND CONVERT(varchar(10),SK.SAGYOU_DATE,120) <= /*data.DENPYOU_DATE_TO*/
/*END*/
/*IF data.DENPYOU_NO != null*/
AND SK.UKETSUKE_NUMBER = /*data.DENPYOU_NO*/
/*END*/
/*IF data.TORIHIKISAKI_CD != null*/
AND SK.TORIHIKISAKI_CD = /*data.TORIHIKISAKI_CD*/
/*END*/
/*IF data.GYOUSHA_CD != null*/
AND SK.GYOUSHA_CD = /*data.GYOUSHA_CD*/
/*END*/
/*IF data.GYOUSHA_CD != null*/
AND SK.GENBA_CD = /*data.GYOUSHA_CD*/
/*END*/

UNION

SELECT 
       '出荷受付' AS DENPYOU_TYPE1
      ,SK.UKETSUKE_NUMBER  AS DENPYOU_NUMBER1
      ,SK.SAGYOU_DATE AS DENPYOU_DATE1
      ,SK.TORIHIKISAKI_NAME AS TORIHIKISAKI_NAME1
      ,SK.GYOUSHA_NAME AS GYOUSHA_NAME1
      ,SK.GENBA_NAME AS GENBA_NAME1
	  ,2 AS DENPYOU_TYPE_KBN
      ,'売上支払' AS DENPYOU_TYPE2
      ,CONVERT(nvarchar,URSH.UR_SH_NUMBER) AS DENPYOU_NUMBER2
      ,URSH.DENPYOU_DATE AS DENPYOU_DATE2
      ,URSH.TORIHIKISAKI_NAME AS TORIHIKISAKI_NAME2
      ,URSH.GYOUSHA_NAME AS GYOUSHA_NAME2
      ,URSH.GENBA_NAME AS GENBA_NAME2
      ,SK.SYSTEM_ID AS SYSTEM_ID1
	  ,'' AS HAIKI_KBN_CD1
      ,URSH.SYSTEM_ID AS SYSTEM_ID2
	  ,'' AS HAIKI_KBN_CD2
 FROM 
     T_UKETSUKE_SK_ENTRY SK
LEFT JOIN T_UR_SH_ENTRY URSH
       ON URSH.UKETSUKE_NUMBER = SK.UKETSUKE_NUMBER
      AND URSH.DELETE_FLG = 0
      AND ISNULL(URSH.DAINOU_FLG, 0) = 0
WHERE 
SK.DELETE_FLG = 0
AND (
     (/*data.RENKEI_KBN*/ = 1) 
  OR (/*data.RENKEI_KBN*/ = 2 AND URSH.SYSTEM_ID IS NOT NULL) 
  OR (/*data.RENKEI_KBN*/ = 3 AND URSH.SYSTEM_ID IS NULL)
  )
/*IF !data.KYOTEN_CD.IsNull*/
AND SK.KYOTEN_CD = /*data.KYOTEN_CD*/
/*END*/
/*IF !data.DENPYOU_DATE_FROM.IsNull*/
AND CONVERT(varchar(10), SK.SAGYOU_DATE,120) >= /*data.DENPYOU_DATE_FROM*/
/*END*/
/*IF !data.DENPYOU_DATE_TO.IsNull*/
AND CONVERT(varchar(10), SK.SAGYOU_DATE,120) <= /*data.DENPYOU_DATE_TO*/
/*END*/
/*IF data.DENPYOU_NO != null*/
AND SK.UKETSUKE_NUMBER = /*data.DENPYOU_NO*/
/*END*/
/*IF data.TORIHIKISAKI_CD != null*/
AND SK.TORIHIKISAKI_CD = /*data.TORIHIKISAKI_CD*/
/*END*/
/*IF data.GYOUSHA_CD != null*/
AND SK.GYOUSHA_CD = /*data.GYOUSHA_CD*/
/*END*/
/*IF data.GYOUSHA_CD != null*/
AND SK.GENBA_CD = /*data.GYOUSHA_CD*/
/*END*/

UNION

SELECT 
       '出荷受付' AS DENPYOU_TYPE1
      ,SK.UKETSUKE_NUMBER  AS DENPYOU_NUMBER1
      ,SK.SAGYOU_DATE AS DENPYOU_DATE1
      ,SK.TORIHIKISAKI_NAME AS TORIHIKISAKI_NAME1
      ,SK.GYOUSHA_NAME AS GYOUSHA_NAME1
      ,SK.GENBA_NAME AS GENBA_NAME1
	  ,2 AS DENPYOU_TYPE_KBN
      ,'マニフェスト' AS DENPYOU_TYPE2
      ,MANIFEST.MANIFEST_ID AS DENPYOU_NUMBER2
      ,MANIFEST.KOUFU_DATE AS DENPYOU_DATE2
      ,MT.TORIHIKISAKI_NAME_RYAKU AS TORIHIKISAKI_NAME2
      ,MANIFEST.HST_GYOUSHA_NAME AS GYOUSHA_NAME2
      ,MANIFEST.HST_GENBA_NAME AS GENBA_NAME2
      ,SK.SYSTEM_ID AS SYSTEM_ID1
	  ,'' AS HAIKI_KBN_CD1
      ,MANIFEST.SYSTEM_ID AS SYSTEM_ID2
	  ,MANIFEST.HAIKI_KBN_CD AS HAIKI_KBN_CD2
 FROM 
     T_UKETSUKE_SK_ENTRY SK
LEFT JOIN T_MANIFEST_ENTRY MANIFEST
       ON MANIFEST.RENKEI_SYSTEM_ID = SK.SYSTEM_ID
      AND MANIFEST.DELETE_FLG = 0
      AND MANIFEST.RENKEI_DENSHU_KBN_CD = 100
LEFT JOIN M_TORIHIKISAKI MT
       ON MT.TORIHIKISAKI_CD = MANIFEST.TORIHIKISAKI_CD
WHERE 
SK.DELETE_FLG = 0
AND (
     (/*data.RENKEI_KBN*/ = 1) 
  OR (/*data.RENKEI_KBN*/ = 2 AND MANIFEST.SYSTEM_ID IS NOT NULL) 
  OR (/*data.RENKEI_KBN*/ = 3 AND MANIFEST.SYSTEM_ID IS NULL)
  )
/*IF !data.KYOTEN_CD.IsNull*/
AND SK.KYOTEN_CD = /*data.KYOTEN_CD*/
/*END*/
/*IF !data.DENPYOU_DATE_FROM.IsNull*/
AND CONVERT(varchar(10), SK.SAGYOU_DATE,120) >= /*data.DENPYOU_DATE_FROM*/
/*END*/
/*IF !data.DENPYOU_DATE_TO.IsNull*/
AND CONVERT(varchar(10), SK.SAGYOU_DATE,120) <= /*data.DENPYOU_DATE_TO*/
/*END*/
/*IF data.DENPYOU_NO != null*/
AND SK.UKETSUKE_NUMBER = /*data.DENPYOU_NO*/
/*END*/
/*IF data.TORIHIKISAKI_CD != null*/
AND SK.TORIHIKISAKI_CD = /*data.TORIHIKISAKI_CD*/
/*END*/
/*IF data.GYOUSHA_CD != null*/
AND SK.GYOUSHA_CD = /*data.GYOUSHA_CD*/
/*END*/
/*IF data.GYOUSHA_CD != null*/
AND SK.GENBA_CD = /*data.GYOUSHA_CD*/
/*END*/

UNION

SELECT 
       '持込受付' AS DENPYOU_TYPE1
      ,MK.UKETSUKE_NUMBER  AS DENPYOU_NUMBER1
      ,MK.SAGYOU_DATE AS DENPYOU_DATE1
      ,MK.TORIHIKISAKI_NAME AS TORIHIKISAKI_NAME1
      ,MK.GYOUSHA_NAME AS GYOUSHA_NAME1
      ,MK.GENBA_NAME AS GENBA_NAME1
	  ,3 AS DENPYOU_TYPE_KBN
      ,'受入' AS DENPYOU_TYPE2
      ,CONVERT(nvarchar,UKEIRE.UKEIRE_NUMBER) AS DENPYOU_NUMBER2
      ,UKEIRE.DENPYOU_DATE AS DENPYOU_DATE2
      ,UKEIRE.TORIHIKISAKI_NAME AS TORIHIKISAKI_NAME2
      ,UKEIRE.GYOUSHA_NAME AS GYOUSHA_NAME2
      ,UKEIRE.GENBA_NAME AS GENBA_NAME2
      ,MK.SYSTEM_ID AS SYSTEM_ID1
	  ,'' AS HAIKI_KBN_CD1
      ,UKEIRE.SYSTEM_ID AS SYSTEM_ID2
	  ,'' AS HAIKI_KBN_CD2
 FROM 
     T_UKETSUKE_MK_ENTRY MK
LEFT JOIN T_UKEIRE_ENTRY UKEIRE
       ON UKEIRE.UKETSUKE_NUMBER = MK.UKETSUKE_NUMBER
      AND UKEIRE.DELETE_FLG = 0
WHERE 
MK.DELETE_FLG = 0
AND (
     (/*data.RENKEI_KBN*/ = 1) 
  OR (/*data.RENKEI_KBN*/ = 2 AND UKEIRE.SYSTEM_ID IS NOT NULL) 
  OR (/*data.RENKEI_KBN*/ = 3 AND UKEIRE.SYSTEM_ID IS NULL)
  )
/*IF !data.KYOTEN_CD.IsNull*/
AND MK.KYOTEN_CD = /*data.KYOTEN_CD*/
/*END*/
/*IF !data.DENPYOU_DATE_FROM.IsNull*/
AND CONVERT(varchar(10), MK.SAGYOU_DATE,120) >= /*data.DENPYOU_DATE_FROM*/
/*END*/
/*IF !data.DENPYOU_DATE_TO.IsNull*/
AND CONVERT(varchar(10), MK.SAGYOU_DATE,120) <= /*data.DENPYOU_DATE_TO*/
/*END*/
/*IF data.DENPYOU_NO != null*/
AND MK.UKETSUKE_NUMBER = /*data.DENPYOU_NO*/
/*END*/
/*IF data.TORIHIKISAKI_CD != null*/
AND MK.TORIHIKISAKI_CD = /*data.TORIHIKISAKI_CD*/
/*END*/
/*IF data.GYOUSHA_CD != null*/
AND MK.GYOUSHA_CD = /*data.GYOUSHA_CD*/
/*END*/
/*IF data.GYOUSHA_CD != null*/
AND MK.GENBA_CD = /*data.GYOUSHA_CD*/
/*END*/

UNION

SELECT 
       '持込受付' AS DENPYOU_TYPE1
      ,MK.UKETSUKE_NUMBER  AS DENPYOU_NUMBER1
      ,MK.SAGYOU_DATE AS DENPYOU_DATE1
      ,MK.TORIHIKISAKI_NAME AS TORIHIKISAKI_NAME1
      ,MK.GYOUSHA_NAME AS GYOUSHA_NAME1
      ,MK.GENBA_NAME AS GENBA_NAME1
	  ,3 AS DENPYOU_TYPE_KBN
      ,'売上支払' AS DENPYOU_TYPE2
      ,CONVERT(nvarchar,URSH.UR_SH_NUMBER) AS DENPYOU_NUMBER2
      ,URSH.DENPYOU_DATE AS DENPYOU_DATE2
      ,URSH.TORIHIKISAKI_NAME AS TORIHIKISAKI_NAME2
      ,URSH.GYOUSHA_NAME AS GYOUSHA_NAME2
      ,URSH.GENBA_NAME AS GENBA_NAME2
      ,MK.SYSTEM_ID AS SYSTEM_ID1
	  ,'' AS HAIKI_KBN_CD1
      ,URSH.SYSTEM_ID AS SYSTEM_ID2
	  ,'' AS HAIKI_KBN_CD2
 FROM 
     T_UKETSUKE_MK_ENTRY MK
LEFT JOIN T_UR_SH_ENTRY URSH
       ON URSH.UKETSUKE_NUMBER = MK.UKETSUKE_NUMBER
      AND URSH.DELETE_FLG = 0
      AND ISNULL(URSH.DAINOU_FLG, 0) = 0
WHERE 
MK.DELETE_FLG = 0
AND (
     (/*data.RENKEI_KBN*/ = 1) 
  OR (/*data.RENKEI_KBN*/ = 2 AND URSH.SYSTEM_ID IS NOT NULL) 
  OR (/*data.RENKEI_KBN*/ = 3 AND URSH.SYSTEM_ID IS NULL)
  )
/*IF !data.KYOTEN_CD.IsNull*/
AND MK.KYOTEN_CD = /*data.KYOTEN_CD*/
/*END*/
/*IF !data.DENPYOU_DATE_FROM.IsNull*/
AND CONVERT(varchar(10), MK.SAGYOU_DATE,120) >= /*data.DENPYOU_DATE_FROM*/
/*END*/
/*IF !data.DENPYOU_DATE_TO.IsNull*/
AND CONVERT(varchar(10), MK.SAGYOU_DATE,120) <= /*data.DENPYOU_DATE_TO*/
/*END*/
/*IF data.DENPYOU_NO != null*/
AND MK.UKETSUKE_NUMBER = /*data.DENPYOU_NO*/
/*END*/
/*IF data.TORIHIKISAKI_CD != null*/
AND MK.TORIHIKISAKI_CD = /*data.TORIHIKISAKI_CD*/
/*END*/
/*IF data.GYOUSHA_CD != null*/
AND MK.GYOUSHA_CD = /*data.GYOUSHA_CD*/
/*END*/
/*IF data.GYOUSHA_CD != null*/
AND MK.GENBA_CD = /*data.GYOUSHA_CD*/
/*END*/

UNION

SELECT 
       '持込受付' AS DENPYOU_TYPE1
      ,MK.UKETSUKE_NUMBER  AS DENPYOU_NUMBER1
      ,MK.SAGYOU_DATE AS DENPYOU_DATE1
      ,MK.TORIHIKISAKI_NAME AS TORIHIKISAKI_NAME1
      ,MK.GYOUSHA_NAME AS GYOUSHA_NAME1
      ,MK.GENBA_NAME AS GENBA_NAME1
	  ,3 AS DENPYOU_TYPE_KBN
      ,'マニフェスト' AS DENPYOU_TYPE2
      ,MANIFEST.MANIFEST_ID AS DENPYOU_NUMBER2
      ,MANIFEST.KOUFU_DATE AS DENPYOU_DATE2
      ,MT.TORIHIKISAKI_NAME_RYAKU AS TORIHIKISAKI_NAME2
      ,MANIFEST.HST_GYOUSHA_NAME AS GYOUSHA_NAME2
      ,MANIFEST.HST_GENBA_NAME AS GENBA_NAME2
      ,MK.SYSTEM_ID AS SYSTEM_ID1
	  ,'' AS HAIKI_KBN_CD1
      ,MANIFEST.SYSTEM_ID AS SYSTEM_ID2
	  ,MANIFEST.HAIKI_KBN_CD AS HAIKI_KBN_CD2
 FROM 
     T_UKETSUKE_MK_ENTRY MK
LEFT JOIN T_MANIFEST_ENTRY MANIFEST
       ON MANIFEST.RENKEI_SYSTEM_ID = MK.SYSTEM_ID
      AND MANIFEST.DELETE_FLG = 0
      AND MANIFEST.RENKEI_DENSHU_KBN_CD = 100
LEFT JOIN M_TORIHIKISAKI MT
       ON MT.TORIHIKISAKI_CD = MANIFEST.TORIHIKISAKI_CD
WHERE 
MK.DELETE_FLG = 0
AND (
     (/*data.RENKEI_KBN*/ = 1) 
  OR (/*data.RENKEI_KBN*/ = 2 AND MANIFEST.SYSTEM_ID IS NOT NULL) 
  OR (/*data.RENKEI_KBN*/ = 3 AND MANIFEST.SYSTEM_ID IS NULL)
  )
/*IF !data.KYOTEN_CD.IsNull*/
AND MK.KYOTEN_CD = /*data.KYOTEN_CD*/
/*END*/
/*IF !data.DENPYOU_DATE_FROM.IsNull*/
AND CONVERT(varchar(10), MK.SAGYOU_DATE,120) >= /*data.DENPYOU_DATE_FROM*/
/*END*/
/*IF !data.DENPYOU_DATE_TO.IsNull*/
AND CONVERT(varchar(10), MK.SAGYOU_DATE,120) <= /*data.DENPYOU_DATE_TO*/
/*END*/
/*IF data.DENPYOU_NO != null*/
AND MK.UKETSUKE_NUMBER = /*data.DENPYOU_NO*/
/*END*/
/*IF data.TORIHIKISAKI_CD != null*/
AND MK.TORIHIKISAKI_CD = /*data.TORIHIKISAKI_CD*/
/*END*/
/*IF data.GYOUSHA_CD != null*/
AND MK.GYOUSHA_CD = /*data.GYOUSHA_CD*/
/*END*/
/*IF data.GYOUSHA_CD != null*/
AND MK.GENBA_CD = /*data.GYOUSHA_CD*/
/*END*/
) AS A
ORDER BY DENPYOU_TYPE_KBN,DENPYOU_DATE1,DENPYOU_NUMBER1