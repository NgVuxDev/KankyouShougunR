WITH MANI AS
(SELECT DISTINCT 
     TME.SYSTEM_ID AS SYSTEM_ID
    ,TME.SEQ AS SEQ
    ,TMD.DETAIL_SYSTEM_ID AS DETAIL_SYSTEM_ID
    ,TME.MANIFEST_ID AS MANIFEST_ID
    ,NULL AS KANRI_ID
    ,NULL AS DEN_SEQ
    ,MHS.HAIKI_SHURUI_NAME AS HAIKI_SHURUI_NAME
    ,TME.HAIKI_KBN_CD AS HAIKI_KBN_CD
    ,TMD.HAIKI_SHURUI_CD AS HAIKI_SHURUI_CD
    ,TME.HST_GYOUSHA_CD AS HST_GYOUSHA_CD
    ,TME.HST_GENBA_CD AS HST_GENBA_CD
    ,TMU.UPN_SAKI_GYOUSHA_CD AS SBN_GYOUSHA_CD
    ,TMU.UPN_SAKI_GENBA_CD AS SBN_GENBA_CD
	,TMU.UPN_ROUTE_NO AS ROUTE_NO
    ,TMD.SBN_HOUHOU_CD AS SBN_HOUHOU_CD
    ,TMU.UPN_SAKI_KBN AS UPN_SAKI_KBN
    ,TMD.KANSAN_SUU AS KANSAN_SUU
    /*IF data.GYOUSHA_KBN.Value == 1 && data.SAI_ITAKU_KBN.Value == 1*/
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4 THEN 1
            WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 THEN 1
            ELSE 0 END AS ITAKU_KBN
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4 THEN NEXT_TMU.UPN_SAKI_GYOUSHA_CD
            WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 THEN NEXT_DTR19EX.UPNSAKI_GYOUSHA_CD
            ELSE NULL END AS SBN_GYOUSHA_CD_NEXT
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4 THEN NEXT_TMU.UPN_SAKI_GENBA_CD
            WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 THEN NEXT_DTR19EX.UPNSAKI_GENBA_CD
            ELSE NULL END AS SBN_GENBA_CD_NEXT
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4 THEN NEXT_TMU.UPN_SAKI_GENBA_NAME
            WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 THEN NEXT_DEN_ITAMGA.GENBA_NAME1 + NEXT_DEN_ITAMGA.GENBA_NAME2
            ELSE NULL END AS ITAKUSAKI_NAME
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4 THEN NEXT_TMU.UPN_SAKI_GENBA_ADDRESS
            WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 THEN 
            /*IF data.ADDRESS_KBN.Value == 1*/
                NEXT_DEN_ITAMT.TODOUFUKEN_NAME + NEXT_DEN_ITAMGA.GENBA_ADDRESS1 + NEXT_DEN_ITAMGA.GENBA_ADDRESS2 
            /*END*/
            /*IF data.ADDRESS_KBN.Value == 2*/
                NEXT_DEN_ITAMGA.GENBA_ADDRESS1 + NEXT_DEN_ITAMGA.GENBA_ADDRESS2
            /*END*/
            /*IF data.ADDRESS_KBN.Value == 3*/
                NEXT_DEN_ITAMT.TODOUFUKEN_NAME + NEXT_DEN_ITAMGA.GENBA_ADDRESS1 
            /*END*/
            ELSE NULL END AS ITAKUSAKI_ADDRESS
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4 THEN NEXT_ITAMGA.CHIIKI_CD
            WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 THEN NEXT_DEN_ITAMGA.CHIIKI_CD
            ELSE NULL END AS ITAKUSAKI_CHIIKI_CD
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4 THEN
				--二次マニが紙マニフェストの場合
				CASE WHEN NEXT_TME.HAIKI_KBN_CD = 2 THEN
					CASE WHEN TMD_NEXT.HAIKI_SHURUI_CD BETWEEN '0000' AND '2099' THEN NEXT_MCK.FUTSUU_KYOKA_NO
					ELSE NEXT_MCK.TOKUBETSU_KYOKA_NO
					END
				ELSE
					CASE WHEN TMD_NEXT.HAIKI_SHURUI_CD BETWEEN '0000' AND '6999' THEN NEXT_MCK.FUTSUU_KYOKA_NO
					ELSE NEXT_MCK.TOKUBETSU_KYOKA_NO
					END
				END
			WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 THEN
				--二次マニが電子マニフェストの場合
				CASE WHEN (NEXT_DTR18.HAIKI_DAI_CODE + NEXT_DTR18.HAIKI_CHU_CODE + NEXT_DTR18.HAIKI_SHO_CODE) BETWEEN '0000' AND '6999' THEN NEXT_DEN_MCK.FUTSUU_KYOKA_NO
					ELSE NEXT_DEN_MCK.TOKUBETSU_KYOKA_NO
					END
			ELSE NULL END AS ITAKUSAKI_KYOKA_NO
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4 THEN
				--二次マニが紙マニフェストの場合
				CASE WHEN NEXT_TME.HAIKI_KBN_CD = 2 THEN
					CASE WHEN TMD_NEXT.HAIKI_SHURUI_CD BETWEEN '0000' AND '2099' THEN 0
					ELSE 1
					END
				ELSE
					CASE WHEN TMD_NEXT.HAIKI_SHURUI_CD BETWEEN '0000' AND '6999' THEN 0
					ELSE 1
					END
				END
			WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 THEN
				--二次マニが電子マニフェストの場合
				CASE WHEN (NEXT_DTR18.HAIKI_DAI_CODE + NEXT_DTR18.HAIKI_CHU_CODE + NEXT_DTR18.HAIKI_SHO_CODE) BETWEEN '0000' AND '6999' THEN 0
					ELSE 1
					END
			ELSE NULL END AS ITAKUSAKI_KYOKA_KBN
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4 AND ((TMR.NEXT_HAIKI_KBN_CD = 3 AND NEXT_TMU.UPN_ROUTE_NO >= 1) OR TMR.NEXT_HAIKI_KBN_CD != 3)
              THEN T_MANIFEST_UPN_NEXT1.UPN_JYUTAKUSHA_CD  
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 AND NEXT_DTR19.UPN_ROUTE_NO >= 1
              THEN NEXT_UPN_EX1.UPN_GYOUSHA_CD
              ELSE NULL
              END AS UPN_GYOUSHA_CD1_NEXT
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4 AND ((TMR.NEXT_HAIKI_KBN_CD = 3 AND NEXT_TMU.UPN_ROUTE_NO >= 2) OR TMR.NEXT_HAIKI_KBN_CD != 3)
              THEN T_MANIFEST_UPN_NEXT2.UPN_JYUTAKUSHA_CD  
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 AND NEXT_DTR19.UPN_ROUTE_NO >= 2 
              THEN NEXT_UPN_EX2.UPN_GYOUSHA_CD
              ELSE NULL
              END AS UPN_GYOUSHA_CD2_NEXT
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4 AND ((TMR.NEXT_HAIKI_KBN_CD = 3 AND NEXT_TMU.UPN_ROUTE_NO >= 3) OR TMR.NEXT_HAIKI_KBN_CD != 3)
              THEN T_MANIFEST_UPN_NEXT3.UPN_JYUTAKUSHA_CD  
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 AND NEXT_DTR19.UPN_ROUTE_NO >= 3 
              THEN NEXT_UPN_EX3.UPN_GYOUSHA_CD
              ELSE NULL
              END AS UPN_GYOUSHA_CD3_NEXT
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND (TMR.NEXT_HAIKI_KBN_CD = 1 OR TMR.NEXT_HAIKI_KBN_CD = 2)
              THEN NEXT_TME.TMH_GYOUSHA_CD   
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 3 AND NEXT_TMU.UPN_ROUTE_NO > 1
              THEN T_MANIFEST_UPN_NEXT1.UPN_SAKI_GYOUSHA_CD
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 AND NEXT_DTR19.UPN_ROUTE_NO > 1
              THEN NEXT_UPN_EX1.UPNSAKI_GYOUSHA_CD
              ELSE NULL
              END AS TMH1_GYOUSHA_CD_NEXT
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND (TMR.NEXT_HAIKI_KBN_CD = 1 OR TMR.NEXT_HAIKI_KBN_CD = 2)
              THEN NEXT_TME.TMH_GENBA_CD   
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 3 AND NEXT_TMU.UPN_ROUTE_NO > 1
              THEN T_MANIFEST_UPN_NEXT1.UPN_SAKI_GENBA_CD
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 AND NEXT_DTR19.UPN_ROUTE_NO > 1
              THEN NEXT_UPN_EX1.UPNSAKI_GENBA_CD
              ELSE NULL
              END AS TMH1_GENBA_CD_NEXT 
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND (TMR.NEXT_HAIKI_KBN_CD = 1 OR TMR.NEXT_HAIKI_KBN_CD = 2)
              THEN NULL   
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 3 AND NEXT_TMU.UPN_ROUTE_NO > 2
              THEN T_MANIFEST_UPN_NEXT2.UPN_SAKI_GYOUSHA_CD
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 AND NEXT_DTR19.UPN_ROUTE_NO > 2
              THEN NEXT_UPN_EX2.UPNSAKI_GYOUSHA_CD
              ELSE NULL
              END AS TMH2_GYOUSHA_CD_NEXT
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND (TMR.NEXT_HAIKI_KBN_CD = 1 OR TMR.NEXT_HAIKI_KBN_CD = 2)
              THEN NULL   
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 3 AND NEXT_TMU.UPN_ROUTE_NO > 2
              THEN T_MANIFEST_UPN_NEXT2.UPN_SAKI_GENBA_CD
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 AND NEXT_DTR19.UPN_ROUTE_NO > 2
              THEN NEXT_UPN_EX2.UPNSAKI_GENBA_CD
              ELSE NULL
              END AS TMH2_GENBA_CD_NEXT 
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4
              THEN TMD_NEXT.HAIKI_SHURUI_CD
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4
              THEN NEXT_DTR18.HAIKI_DAI_CODE + NEXT_DTR18.HAIKI_CHU_CODE + NEXT_DTR18.HAIKI_SHO_CODE
              ELSE NULL
              END AS HAIKI_SHURUI_CD_NEXT 
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4
              THEN NEXT_TME.MANIFEST_ID
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4
              THEN NEXT_DTR18.MANIFEST_ID
              ELSE NULL
              END AS MANIFEST_ID_NEXT 
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4
              THEN NEXT_TME.KOUFU_DATE
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4
              THEN NEXT_DTR18.HIKIWATASHI_DATE 
              ELSE NULL
              END AS KOUFU_DATE_NEXT 
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4
              THEN TMD.GENNYOU_SUU
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4
              THEN TMD.GENNYOU_SUU 
              ELSE NULL
              END AS GENYOU_SUU
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4
				THEN MCB_NEXT.HOUKOKU_BUNRUI_CD
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4
				THEN NEXT_D_MCB.HOUKOKU_BUNRUI_CD
              ELSE NULL
              END AS HOUKOKUSHO_BUNRUI_CD_NEXT
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4
				THEN MCB_NEXT.HOUKOKU_BUNRUI_NAME
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4
				THEN NEXT_D_MCB.HOUKOKU_BUNRUI_NAME
              ELSE NULL
              END AS HOUKOKUSHO_BUNRUI_NAME_NEXT
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4
				THEN MCS_NEXT.HOUKOKU_SHOBUN_HOUHOU_CD
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4
				THEN NEXT_D_CBS.HOUKOKU_SHOBUN_HOUHOU_CD
              ELSE NULL
              END AS SHOBUN_HOUHOU_CD_NEXT
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4
				THEN MCS_NEXT.HOUKOKU_SHOBUN_HOUHOU_NAME
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4
				THEN NEXT_D_CBS.HOUKOKU_SHOBUN_HOUHOU_NAME
              ELSE NULL
              END AS SHOBUN_HOUHOU_NAME_NEXT
    /*END*/
    /*IF data.GYOUSHA_KBN.Value == 1 && data.SAI_ITAKU_KBN.Value == 2*/
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4 AND NEXT_ITAMGA.JISHA_KBN = 0 THEN 1
            WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 AND NEXT_DEN_ITAMGA.JISHA_KBN = 0 THEN 1
            ELSE 0 END AS ITAKU_KBN
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4 AND NEXT_ITAMGA.JISHA_KBN = 0 THEN NEXT_TMU.UPN_SAKI_GYOUSHA_CD
            WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 AND NEXT_DEN_ITAMGA.JISHA_KBN = 0 THEN NEXT_DTR19EX.UPNSAKI_GYOUSHA_CD
            ELSE NULL END AS SBN_GYOUSHA_CD_NEXT
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4 AND NEXT_ITAMGA.JISHA_KBN = 0 THEN NEXT_TMU.UPN_SAKI_GENBA_CD
            WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 AND NEXT_DEN_ITAMGA.JISHA_KBN = 0 THEN NEXT_DTR19EX.UPNSAKI_GENBA_CD
            ELSE NULL END AS SBN_GENBA_CD_NEXT
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4 AND NEXT_ITAMGA.JISHA_KBN = 0 THEN NEXT_TMU.UPN_SAKI_GENBA_NAME
            WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 AND NEXT_DEN_ITAMGA.JISHA_KBN = 0 THEN NEXT_DEN_ITAMGA.GENBA_NAME1 + NEXT_DEN_ITAMGA.GENBA_NAME2
            ELSE NULL END AS ITAKUSAKI_NAME
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4 AND NEXT_ITAMGA.JISHA_KBN = 0 THEN NEXT_TMU.UPN_SAKI_GENBA_ADDRESS
            WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 AND NEXT_DEN_ITAMGA.JISHA_KBN = 0 THEN 
            /*IF data.ADDRESS_KBN.Value == 1*/
                NEXT_DEN_ITAMT.TODOUFUKEN_NAME + NEXT_DEN_ITAMGA.GENBA_ADDRESS1 + NEXT_DEN_ITAMGA.GENBA_ADDRESS2 
            /*END*/
            /*IF data.ADDRESS_KBN.Value == 2*/
                NEXT_DEN_ITAMGA.GENBA_ADDRESS1 + NEXT_DEN_ITAMGA.GENBA_ADDRESS2
            /*END*/
            /*IF data.ADDRESS_KBN.Value == 3*/
                NEXT_DEN_ITAMT.TODOUFUKEN_NAME + NEXT_DEN_ITAMGA.GENBA_ADDRESS1 
            /*END*/
            ELSE NULL END AS ITAKUSAKI_ADDRESS
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4 AND NEXT_ITAMGA.JISHA_KBN = 0 THEN NEXT_ITAMGA.CHIIKI_CD
            WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 AND NEXT_DEN_ITAMGA.JISHA_KBN = 0 THEN NEXT_DEN_ITAMGA.CHIIKI_CD
            ELSE NULL END AS ITAKUSAKI_CHIIKI_CD
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4 AND NEXT_ITAMGA.JISHA_KBN = 0 THEN
				--二次マニが紙マニフェストの場合
				CASE WHEN NEXT_TME.HAIKI_KBN_CD = 2 THEN
					CASE WHEN TMD_NEXT.HAIKI_SHURUI_CD BETWEEN '0000' AND '2099' THEN NEXT_MCK.FUTSUU_KYOKA_NO
					ELSE NEXT_MCK.TOKUBETSU_KYOKA_NO
					END
				ELSE
					CASE WHEN TMD_NEXT.HAIKI_SHURUI_CD BETWEEN '0000' AND '6999' THEN NEXT_MCK.FUTSUU_KYOKA_NO
					ELSE NEXT_MCK.TOKUBETSU_KYOKA_NO
					END
				END
            WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 AND NEXT_DEN_ITAMGA.JISHA_KBN = 0 THEN 
				--二次マニが電子マニフェストの場合
				CASE WHEN (NEXT_DTR18.HAIKI_DAI_CODE + NEXT_DTR18.HAIKI_CHU_CODE + NEXT_DTR18.HAIKI_SHO_CODE) BETWEEN '0000' AND '6999' THEN NEXT_DEN_MCK.FUTSUU_KYOKA_NO
					ELSE NEXT_DEN_MCK.TOKUBETSU_KYOKA_NO
					END
            ELSE NULL END AS ITAKUSAKI_KYOKA_NO
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4 AND NEXT_ITAMGA.JISHA_KBN = 0 THEN
				--二次マニが紙マニフェストの場合
				CASE WHEN NEXT_TME.HAIKI_KBN_CD = 2 THEN
					CASE WHEN TMD_NEXT.HAIKI_SHURUI_CD BETWEEN '0000' AND '2099' THEN 0
					ELSE 1
					END
				ELSE
					CASE WHEN TMD_NEXT.HAIKI_SHURUI_CD BETWEEN '0000' AND '6999' THEN 0
					ELSE 1
					END
				END
            WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 AND NEXT_DEN_ITAMGA.JISHA_KBN = 0 THEN 
				--二次マニが電子マニフェストの場合
				CASE WHEN (NEXT_DTR18.HAIKI_DAI_CODE + NEXT_DTR18.HAIKI_CHU_CODE + NEXT_DTR18.HAIKI_SHO_CODE) BETWEEN '0000' AND '6999' THEN 0
					ELSE 1
					END
            ELSE NULL END AS ITAKUSAKI_KYOKA_KBN
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4 AND NEXT_ITAMGA.JISHA_KBN = 0 AND ((TMR.NEXT_HAIKI_KBN_CD = 3 AND NEXT_TMU.UPN_ROUTE_NO >= 1) OR TMR.NEXT_HAIKI_KBN_CD != 3)
              THEN T_MANIFEST_UPN_NEXT1.UPN_JYUTAKUSHA_CD  
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 AND NEXT_DEN_ITAMGA.JISHA_KBN = 0 AND NEXT_DTR19.UPN_ROUTE_NO >= 1
              THEN NEXT_UPN_EX1.UPN_GYOUSHA_CD
              ELSE NULL
              END AS UPN_GYOUSHA_CD1_NEXT
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4 AND NEXT_ITAMGA.JISHA_KBN = 0 AND ((TMR.NEXT_HAIKI_KBN_CD = 3 AND NEXT_TMU.UPN_ROUTE_NO >= 2) OR TMR.NEXT_HAIKI_KBN_CD != 3)
              THEN T_MANIFEST_UPN_NEXT2.UPN_JYUTAKUSHA_CD  
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 AND NEXT_DEN_ITAMGA.JISHA_KBN = 0 AND NEXT_DTR19.UPN_ROUTE_NO >= 2 
              THEN NEXT_UPN_EX2.UPN_GYOUSHA_CD
              ELSE NULL
              END AS UPN_GYOUSHA_CD2_NEXT
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4 AND NEXT_ITAMGA.JISHA_KBN = 0 AND ((TMR.NEXT_HAIKI_KBN_CD = 3 AND NEXT_TMU.UPN_ROUTE_NO >= 3) OR TMR.NEXT_HAIKI_KBN_CD != 3)
              THEN T_MANIFEST_UPN_NEXT3.UPN_JYUTAKUSHA_CD  
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 AND NEXT_DEN_ITAMGA.JISHA_KBN = 0 AND NEXT_DTR19.UPN_ROUTE_NO >= 3 
              THEN NEXT_UPN_EX3.UPN_GYOUSHA_CD
              ELSE NULL
              END AS UPN_GYOUSHA_CD3_NEXT
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND (TMR.NEXT_HAIKI_KBN_CD = 1 OR TMR.NEXT_HAIKI_KBN_CD = 2) AND NEXT_ITAMGA.JISHA_KBN = 0
              THEN NEXT_TME.TMH_GYOUSHA_CD   
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 3 AND NEXT_ITAMGA.JISHA_KBN = 0 AND NEXT_TMU.UPN_ROUTE_NO > 1
              THEN T_MANIFEST_UPN_NEXT1.UPN_SAKI_GYOUSHA_CD
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 AND NEXT_DEN_ITAMGA.JISHA_KBN = 0 AND NEXT_DTR19.UPN_ROUTE_NO > 1
              THEN NEXT_UPN_EX1.UPNSAKI_GYOUSHA_CD
              ELSE NULL
              END AS TMH1_GYOUSHA_CD_NEXT
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND (TMR.NEXT_HAIKI_KBN_CD = 1 OR TMR.NEXT_HAIKI_KBN_CD = 2) AND NEXT_ITAMGA.JISHA_KBN = 0
              THEN NEXT_TME.TMH_GENBA_CD   
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 3 AND NEXT_ITAMGA.JISHA_KBN = 0 AND NEXT_TMU.UPN_ROUTE_NO > 1
              THEN T_MANIFEST_UPN_NEXT1.UPN_SAKI_GENBA_CD
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 AND NEXT_DEN_ITAMGA.JISHA_KBN = 0 
              THEN NEXT_UPN_EX1.UPNSAKI_GENBA_CD
              ELSE NULL
              END AS TMH1_GENBA_CD_NEXT 
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND (TMR.NEXT_HAIKI_KBN_CD = 1 OR TMR.NEXT_HAIKI_KBN_CD = 2) AND NEXT_ITAMGA.JISHA_KBN = 0
              THEN NULL   
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 3 AND NEXT_ITAMGA.JISHA_KBN = 0 AND NEXT_TMU.UPN_ROUTE_NO > 2
              THEN T_MANIFEST_UPN_NEXT2.UPN_SAKI_GYOUSHA_CD
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 AND NEXT_DEN_ITAMGA.JISHA_KBN = 0 
              THEN NEXT_UPN_EX2.UPNSAKI_GYOUSHA_CD
              ELSE NULL
              END AS TMH2_GYOUSHA_CD_NEXT
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND (TMR.NEXT_HAIKI_KBN_CD = 1 OR TMR.NEXT_HAIKI_KBN_CD = 2) AND NEXT_ITAMGA.JISHA_KBN = 0
              THEN NULL   
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 3 AND NEXT_ITAMGA.JISHA_KBN = 0 AND NEXT_TMU.UPN_ROUTE_NO > 2
              THEN T_MANIFEST_UPN_NEXT2.UPN_SAKI_GENBA_CD
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 AND NEXT_DEN_ITAMGA.JISHA_KBN = 0 
              THEN NEXT_UPN_EX2.UPNSAKI_GENBA_CD
              ELSE NULL
              END AS TMH2_GENBA_CD_NEXT 
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4 AND NEXT_ITAMGA.JISHA_KBN = 0
              THEN TMD_NEXT.HAIKI_SHURUI_CD
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 AND NEXT_DEN_ITAMGA.JISHA_KBN = 0
              THEN NEXT_DTR18.HAIKI_DAI_CODE + NEXT_DTR18.HAIKI_CHU_CODE + NEXT_DTR18.HAIKI_SHO_CODE
              ELSE NULL
              END AS HAIKI_SHURUI_CD_NEXT 
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4 AND NEXT_ITAMGA.JISHA_KBN = 0
              THEN NEXT_TME.MANIFEST_ID
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 AND NEXT_DEN_ITAMGA.JISHA_KBN = 0
              THEN NEXT_DTR18.MANIFEST_ID
              ELSE NULL
              END AS MANIFEST_ID_NEXT 
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4 AND NEXT_ITAMGA.JISHA_KBN = 0
              THEN NEXT_TME.KOUFU_DATE
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 AND NEXT_DEN_ITAMGA.JISHA_KBN = 0
              THEN NEXT_DTR18.HIKIWATASHI_DATE 
              ELSE NULL
              END AS KOUFU_DATE_NEXT 
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4 AND NEXT_ITAMGA.JISHA_KBN = 0
              THEN TMD.GENNYOU_SUU
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 AND NEXT_DEN_ITAMGA.JISHA_KBN = 0
              THEN TMD.GENNYOU_SUU 
              ELSE NULL
              END AS GENYOU_SUU          
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4 AND NEXT_ITAMGA.JISHA_KBN = 0
				THEN MCB_NEXT.HOUKOKU_BUNRUI_CD
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 AND NEXT_DEN_ITAMGA.JISHA_KBN = 0
				THEN NEXT_D_MCB.HOUKOKU_BUNRUI_CD
              ELSE NULL
              END AS HOUKOKUSHO_BUNRUI_CD_NEXT
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4 AND NEXT_ITAMGA.JISHA_KBN = 0
				THEN MCB_NEXT.HOUKOKU_BUNRUI_NAME
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 AND NEXT_DEN_ITAMGA.JISHA_KBN = 0
				THEN NEXT_D_MCB.HOUKOKU_BUNRUI_NAME
              ELSE NULL
              END AS HOUKOKUSHO_BUNRUI_NAME_NEXT
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4 AND NEXT_ITAMGA.JISHA_KBN = 0
				THEN MCS_NEXT.HOUKOKU_SHOBUN_HOUHOU_CD
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 AND NEXT_DEN_ITAMGA.JISHA_KBN = 0
				THEN NEXT_D_CBS.HOUKOKU_SHOBUN_HOUHOU_CD
              ELSE NULL
              END AS SHOBUN_HOUHOU_CD_NEXT
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4 AND NEXT_ITAMGA.JISHA_KBN = 0
				THEN MCS_NEXT.HOUKOKU_SHOBUN_HOUHOU_NAME
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 AND NEXT_DEN_ITAMGA.JISHA_KBN = 0
				THEN NEXT_D_CBS.HOUKOKU_SHOBUN_HOUHOU_NAME
              ELSE NULL
              END AS SHOBUN_HOUHOU_NAME_NEXT
    /*END*/
    /*IF data.GYOUSHA_KBN.Value != 1*/
    ,0 AS ITAKU_KBN
    ,NULL AS SBN_GYOUSHA_CD_NEXT
    ,NULL AS SBN_GENBA_CD_NEXT
    ,NULL AS ITAKUSAKI_KYOKA_NO
	,NULL AS ITAKUSAKI_KYOKA_KBN
	,NULL AS ITAKUSAKI_NAME
	,NULL AS ITAKUSAKI_ADDRESS
	,NULL AS ITAKUSAKI_CHIIKI_CD
    ,NULL AS UPN_GYOUSHA_CD1_NEXT
    ,NULL AS UPN_GYOUSHA_CD2_NEXT
    ,NULL AS UPN_GYOUSHA_CD3_NEXT
    ,NULL AS TMH1_GYOUSHA_CD_NEXT
    ,NULL AS TMH1_GENBA_CD_NEXT
    ,NULL AS TMH2_GYOUSHA_CD_NEXT
    ,NULL AS TMH2_GENBA_CD_NEXT
    ,NULL AS HAIKI_SHURUI_CD_NEXT
    ,NULL AS MANIFEST_ID_NEXT
    ,NULL AS KOUFU_DATE_NEXT
    ,NULL AS GENYOU_SUU
	,NULL AS HOUKOKUSHO_BUNRUI_CD_NEXT
	,NULL AS HOUKOKUSHO_BUNRUI_NAME_NEXT
	,NULL AS SHOBUN_HOUHOU_CD_NEXT
	,NULL AS SHOBUN_HOUHOU_NAME_NEXT
    /*END*/
    ,TMR.NEXT_HAIKI_KBN_CD AS NEXT_HAIKI_KBN_CD
    
    ,MCB.HOUKOKU_BUNRUI_CD AS HOUKOKUSHO_BUNRUI_CD
    ,MCB.HOUKOKU_BUNRUI_NAME AS HOUKOKUSHO_BUNRUI_NAME
    /*IF data.TOKUBETSU_KANRI_KBN.Value == 1*/
        ,HSTMCK.FUTSUU_KYOKA_NO AS SAIITAKU_KYOKA_NO
        ,CASE WHEN HSTMCK.FUTSUU_KYOKA_NO IS NOT NULL THEN '再委託' ELSE NULL END AS JYUTAKU_KBN 
    /*END*/
    /*IF data.TOKUBETSU_KANRI_KBN.Value == 2*/
        ,HSTMCK.TOKUBETSU_KYOKA_NO AS SAIITAKU_KYOKA_NO
        ,CASE WHEN HSTMCK.TOKUBETSU_KYOKA_NO IS NOT NULL THEN '再委託' ELSE NULL END AS JYUTAKU_KBN 
    /*END*/
    ,HSTMGS.GYOUSHA_NAME1 + HSTMGS.GYOUSHA_NAME2 AS HST_GYOUSHA_NAME
    /*IF data.ADDRESS_KBN.Value == 1*/
        ,HSTMGSMT.TODOUFUKEN_NAME + HSTMGS.GYOUSHA_ADDRESS1 + HSTMGS.GYOUSHA_ADDRESS2 AS HST_GYOUSHA_ADDRESS
    /*END*/
    /*IF data.ADDRESS_KBN.Value == 2*/
        ,HSTMGS.GYOUSHA_ADDRESS1 + HSTMGS.GYOUSHA_ADDRESS2 AS HST_GYOUSHA_ADDRESS
    /*END*/
    /*IF data.ADDRESS_KBN.Value == 3*/
        ,HSTMGSMT.TODOUFUKEN_NAME + HSTMGS.GYOUSHA_ADDRESS1 AS HST_GYOUSHA_ADDRESS
    /*END*/
    ,HSTMGA.GENBA_NAME1 + HSTMGA.GENBA_NAME2 AS HST_GENBA_NAME
    /*IF data.ADDRESS_KBN.Value == 1*/
        ,HSTMGAMT.TODOUFUKEN_NAME + HSTMGA.GENBA_ADDRESS1 + HSTMGA.GENBA_ADDRESS2 AS HST_GENBA_ADDRESS
    /*END*/
    /*IF data.ADDRESS_KBN.Value == 2*/
        ,HSTMGA.GENBA_ADDRESS1 + HSTMGA.GENBA_ADDRESS2 AS HST_GENBA_ADDRESS
    /*END*/
    /*IF data.ADDRESS_KBN.Value == 3*/
        ,HSTMGAMT.TODOUFUKEN_NAME + HSTMGA.GENBA_ADDRESS1 AS HST_GENBA_ADDRESS
    /*END*/
    ,HSTMGA.CHIIKI_CD AS HST_GENBA_CHIIKI_CD
    ,MU.UNIT_NAME AS JYUTAKU_UNIT_NAME
    ,MCH.HOUKOKU_SHOBUN_HOUHOU_CD AS SHOBUN_HOUHOU_CD
    ,MCH.HOUKOKU_SHOBUN_HOUHOU_NAME AS SHOBUN_HOUHOU_NAME
	,NULL AS SBN_MOKUTEKI_CD
	,NULL AS SBN_MOKUTEKI_NAME
    ,SBNMGS.GYOUSHA_NAME1 + SBNMGS.GYOUSHA_NAME2 AS SBN_GYOUSHA_NAME
    /*IF data.ADDRESS_KBN.Value == 1*/
        ,SBNMGSMT.TODOUFUKEN_NAME + SBNMGS.GYOUSHA_ADDRESS1 + SBNMGS.GYOUSHA_ADDRESS2 AS SBN_GYOUSHA_ADDRESS
    /*END*/
    /*IF data.ADDRESS_KBN.Value == 2*/
        ,SBNMGS.GYOUSHA_ADDRESS1 + SBNMGS.GYOUSHA_ADDRESS2 AS SBN_GYOUSHA_ADDRESS
    /*END*/
    /*IF data.ADDRESS_KBN.Value == 3*/
        ,SBNMGSMT.TODOUFUKEN_NAME + SBNMGS.GYOUSHA_ADDRESS1 AS SBN_GYOUSHA_ADDRESS
    /*END*/
    ,TMUMGA.GENBA_NAME1 + TMUMGA.GENBA_NAME2 AS SBN_GENBA_NAME
    /*IF data.ADDRESS_KBN.Value == 1*/
        ,TMUMT.TODOUFUKEN_NAME + TMUMGA.GENBA_ADDRESS1 + TMUMGA.GENBA_ADDRESS2 
    /*END*/
    /*IF data.ADDRESS_KBN.Value == 2*/
        ,TMUMGA.GENBA_ADDRESS1 + TMUMGA.GENBA_ADDRESS2 
    /*END*/
    /*IF data.ADDRESS_KBN.Value == 3*/
        ,TMUMT.TODOUFUKEN_NAME + TMUMGA.GENBA_ADDRESS1 
    /*END*/
    AS SBN_GENBA_ADDRESS
    ,TMUMGA.CHIIKI_CD AS SBN_GENBA_CHIIKI_CD
    ,HSTMGA.CHIIKI_CD AS HST_JOU_CHIIKI_CD
    ,HSTMGA.GENBA_TODOUFUKEN_CD AS HST_JOU_TODOUFUKEN_CD
    ,CASE WHEN HSTMGA.CHIIKI_CD = /*data.TEISHUTSU_CHIIKI_CD*/0 THEN 1 ELSE 2 END AS HST_KEN_KBN
    ,CASE 
     WHEN TMU.UPN_ROUTE_NO >= 1
     THEN T_MANIFEST_UPN1.UPN_GYOUSHA_CD  
     ELSE NULL
     END AS UPN_GYOUSHA_CD1
    ,CASE 
     WHEN TMU.UPN_ROUTE_NO >= 2
     THEN T_MANIFEST_UPN2.UPN_GYOUSHA_CD 
     ELSE NULL
     END AS UPN_GYOUSHA_CD2
    ,CASE 
     WHEN TMU.UPN_ROUTE_NO >= 3
     THEN T_MANIFEST_UPN3.UPN_GYOUSHA_CD 
     ELSE NULL
     END AS UPN_GYOUSHA_CD3
    
    ,CASE 
     WHEN TME.HAIKI_KBN_CD = 3 AND T_MANIFEST_UPN1.UPN_SAKI_KBN = 2 AND TMU.UPN_ROUTE_NO > 1
     THEN T_MANIFEST_UPN1.UPN_SAKI_GYOUSHA_CD 
     WHEN TME.HAIKI_KBN_CD = 1 OR TME.HAIKI_KBN_CD = 2
     THEN TME.TMH_GYOUSHA_CD
     ELSE NULL 
     END AS UPN_SAKI_GYOUSHA_CD1
    ,CASE 
     WHEN TME.HAIKI_KBN_CD = 3 AND T_MANIFEST_UPN1.UPN_SAKI_KBN = 2 AND TMU.UPN_ROUTE_NO > 1
     THEN T_MANIFEST_UPN1.UPN_SAKI_GENBA_CD
     WHEN TME.HAIKI_KBN_CD = 1 OR TME.HAIKI_KBN_CD = 2
     THEN TME.TMH_GENBA_CD
     ELSE NULL 
     END AS UPN_SAKI_GENBA_CD1
    ,CASE 
     WHEN TME.HAIKI_KBN_CD = 3 AND T_MANIFEST_UPN2.UPN_SAKI_KBN = 2 AND TMU.UPN_ROUTE_NO > 2
     THEN T_MANIFEST_UPN2.UPN_SAKI_GYOUSHA_CD
     ELSE NULL
     END AS UPN_SAKI_GYOUSHA_CD2
    ,CASE WHEN TME.HAIKI_KBN_CD = 3 AND T_MANIFEST_UPN2.UPN_SAKI_KBN = 2 AND TMU.UPN_ROUTE_NO > 2
     THEN T_MANIFEST_UPN2.UPN_SAKI_GENBA_CD
     ELSE NULL
     END AS UPN_SAKI_GENBA_CD2
    ,TME.KOUFU_DATE AS KOUFU_DATE
    
FROM 
    T_MANIFEST_ENTRY TME

    INNER JOIN T_MANIFEST_DETAIL TMD ON TMD.SYSTEM_ID = TME.SYSTEM_ID AND TMD.SEQ = TME.SEQ
    LEFT JOIN (SELECT TMU1.* FROM T_MANIFEST_ENTRY TME1 INNER JOIN T_MANIFEST_UPN TMU1 ON TMU1.SYSTEM_ID = TME1.SYSTEM_ID AND TMU1.SEQ = TME1.SEQ AND TMU1.UPN_ROUTE_NO = 1 WHERE (TME1.HAIKI_KBN_CD = 1 OR TME1.HAIKI_KBN_CD =2) AND TME1.DELETE_FLG =0 AND TME1.SEQ = (SELECT MAX(SEQ) FROM T_MANIFEST_ENTRY WHERE SYSTEM_ID = TME1.SYSTEM_ID)
               UNION
               SELECT TMU2.* FROM T_MANIFEST_ENTRY TME2 INNER JOIN T_MANIFEST_UPN TMU2 ON TMU2.SYSTEM_ID = TME2.SYSTEM_ID AND TMU2.SEQ = TME2.SEQ AND TME2.HAIKI_KBN_CD = 3  AND TMU2.UPN_ROUTE_NO = (
	                                                                              SELECT MIN(UPN_ROUTE_NO) FROM T_MANIFEST_UPN WHERE TME2.SYSTEM_ID = SYSTEM_ID AND SEQ = TME2.SEQ AND TME2.HAIKI_KBN_CD = 3 AND UPN_SAKI_KBN = 1) AND TME2.DELETE_FLG = 0) TMU ON TMU.SYSTEM_ID = TME.SYSTEM_ID AND TMU.SEQ = TME.SEQ
    LEFT JOIN M_GENBA HSTMGA ON HSTMGA.GENBA_CD = TME.HST_GENBA_CD AND HSTMGA.GYOUSHA_CD = TME.HST_GYOUSHA_CD
    LEFT JOIN M_GENBA TMUMGA ON TMUMGA.GYOUSHA_CD = TMU.UPN_SAKI_GYOUSHA_CD AND TMUMGA.GENBA_CD = TMU.UPN_SAKI_GENBA_CD
    --LEFT JOIN M_GENBA ITAMGA ON ITAMGA.GENBA_CD = TMU.UPN_SAKI_GYOUSHA_CD AND ITAMGA.GYOUSHA_CD = TMU.UPN_SAKI_GENBA_CD
    --LEFT JOIN M_CHIIKIBETSU_KYOKA SBNMCK ON SBNMCK.GYOUSHA_CD = TMU.UPN_SAKI_GYOUSHA_CD AND SBNMCK.GENBA_CD = TMU.UPN_SAKI_GENBA_CD

    LEFT JOIN T_MANIFEST_RELATION TMR ON  TMR.FIRST_SYSTEM_ID = TMD.DETAIL_SYSTEM_ID AND TMR.FIRST_HAIKI_KBN_CD = TME.HAIKI_KBN_CD  AND TMR.DELETE_FLG = 0
    LEFT JOIN ( SELECT
					MENTRY.*, MDETAIL.DETAIL_SYSTEM_ID
				FROM
					T_MANIFEST_ENTRY AS MENTRY
					INNER JOIN T_MANIFEST_DETAIL AS MDETAIL 
						ON MDETAIL.SYSTEM_ID = MENTRY.SYSTEM_ID
						AND MENTRY.SEQ = MDETAIL.SEQ
				) AS NEXT_TME ON NEXT_TME.DETAIL_SYSTEM_ID = TMR.NEXT_SYSTEM_ID AND NEXT_TME.SEQ = (SELECT MAX(SEQ) FROM T_MANIFEST_ENTRY WHERE SYSTEM_ID = NEXT_TME.SYSTEM_ID) AND NEXT_TME.DELETE_FLG = 0 AND TMR.NEXT_HAIKI_KBN_CD != 4
    LEFT JOIN (SELECT TMU1.* FROM T_MANIFEST_ENTRY TME1 INNER JOIN T_MANIFEST_UPN TMU1 ON TMU1.SYSTEM_ID = TME1.SYSTEM_ID AND TMU1.SEQ = TME1.SEQ AND TMU1.UPN_ROUTE_NO = 1 WHERE (TME1.HAIKI_KBN_CD = 1 OR TME1.HAIKI_KBN_CD =2) AND TME1.DELETE_FLG =0 AND TME1.SEQ = (SELECT MAX(SEQ) FROM T_MANIFEST_ENTRY WHERE SYSTEM_ID = TME1.SYSTEM_ID)
               UNION
               SELECT TMU2.* FROM T_MANIFEST_ENTRY TME2 INNER JOIN T_MANIFEST_UPN TMU2 ON TMU2.SYSTEM_ID = TME2.SYSTEM_ID AND TMU2.SEQ = TME2.SEQ AND TME2.HAIKI_KBN_CD = 3  AND TMU2.UPN_ROUTE_NO = (
	                                                                              SELECT MIN(UPN_ROUTE_NO) FROM T_MANIFEST_UPN WHERE TME2.SYSTEM_ID = SYSTEM_ID AND SEQ = TME2.SEQ AND TME2.HAIKI_KBN_CD = 3 AND UPN_SAKI_KBN = 1) AND TME2.DELETE_FLG = 0 ) NEXT_TMU ON NEXT_TMU.SYSTEM_ID = NEXT_TME.SYSTEM_ID AND NEXT_TMU.SEQ = NEXT_TME.SEQ AND TMR.NEXT_HAIKI_KBN_CD != 4
    LEFT JOIN M_GENBA NEXT_ITAMGA ON NEXT_ITAMGA.GYOUSHA_CD = NEXT_TMU.UPN_SAKI_GYOUSHA_CD AND NEXT_ITAMGA.GENBA_CD = NEXT_TMU.UPN_SAKI_GENBA_CD AND TMR.NEXT_HAIKI_KBN_CD != 4
    LEFT JOIN M_CHIIKIBETSU_KYOKA NEXT_MCK ON NEXT_MCK.GYOUSHA_CD = NEXT_TMU.UPN_SAKI_GYOUSHA_CD AND NEXT_MCK.GENBA_CD = NEXT_TMU.UPN_SAKI_GENBA_CD AND TMR.NEXT_HAIKI_KBN_CD != 4 AND NEXT_MCK.KYOKA_KBN = 3 AND NEXT_MCK.CHIIKI_CD = NEXT_ITAMGA.CHIIKI_CD

    LEFT JOIN DT_R18_EX NEXT_DTR18EX ON NEXT_DTR18EX.SYSTEM_ID = TMR.NEXT_SYSTEM_ID AND NEXT_DTR18EX.DELETE_FLG = 0 AND TMR.NEXT_HAIKI_KBN_CD = 4
    LEFT JOIN DT_MF_TOC NEXT_DMT ON NEXT_DTR18EX.KANRI_ID = NEXT_DMT.KANRI_ID
    LEFT JOIN DT_R18 NEXT_DTR18 ON NEXT_DTR18.KANRI_ID = NEXT_DTR18EX.KANRI_ID AND NEXT_DMT.LATEST_SEQ = NEXT_DTR18.SEQ
    LEFT JOIN DT_R19_EX NEXT_DTR19EX ON NEXT_DTR19EX.SYSTEM_ID = TMR.NEXT_SYSTEM_ID AND NEXT_DTR19EX.DELETE_FLG = 0 AND TMR.NEXT_HAIKI_KBN_CD = 4
    LEFT JOIN DT_R19 NEXT_DTR19 ON NEXT_DTR19.KANRI_ID = NEXT_DTR19EX.KANRI_ID AND NEXT_DTR19.SEQ = NEXT_DTR19EX.SEQ AND TMR.NEXT_HAIKI_KBN_CD = 4
    LEFT JOIN M_GENBA NEXT_DEN_ITAMGA ON NEXT_DEN_ITAMGA.GYOUSHA_CD = NEXT_DTR19EX.UPNSAKI_GYOUSHA_CD AND NEXT_DEN_ITAMGA.GENBA_CD = NEXT_DTR19EX.UPNSAKI_GENBA_CD AND TMR.NEXT_HAIKI_KBN_CD = 4
    LEFT JOIN M_CHIIKIBETSU_KYOKA NEXT_DEN_MCK ON NEXT_DEN_MCK.GYOUSHA_CD = NEXT_DTR19EX.UPNSAKI_GYOUSHA_CD AND NEXT_DEN_MCK.GENBA_CD = NEXT_DTR19EX.UPNSAKI_GENBA_CD AND TMR.NEXT_HAIKI_KBN_CD = 4 AND NEXT_DEN_MCK.KYOKA_KBN = 3 AND NEXT_DEN_MCK.CHIIKI_CD = NEXT_DEN_ITAMGA.CHIIKI_CD
    LEFT JOIN M_DENSHI_HAIKI_SHURUI NEXT_MDHS ON NEXT_MDHS.HAIKI_SHURUI_CD = (NEXT_DTR18.HAIKI_DAI_CODE + NEXT_DTR18.HAIKI_CHU_CODE + NEXT_DTR18.HAIKI_SHO_CODE)
    LEFT JOIN M_CHIIKIBETSU_BUNRUI NEXT_D_MCB ON NEXT_D_MCB.CHIIKI_CD = /*data.TEISHUTSU_CHIIKI_CD*/0 AND NEXT_D_MCB.HOUKOKUSHO_BUNRUI_CD = NEXT_MDHS.HOUKOKUSHO_BUNRUI_CD
	LEFT JOIN M_CHIIKIBETSU_SHOBUN NEXT_D_CBS ON NEXT_D_CBS.CHIIKI_CD = /*data.TEISHUTSU_CHIIKI_CD*/0 AND NEXT_D_CBS.SHOBUN_HOUHOU_CD = NEXT_DTR18EX.SBN_HOUHOU_CD

    LEFT JOIN M_CHIIKI NEXT_DEN_ITAMC ON NEXT_DEN_ITAMC.CHIIKI_CD = NEXT_DEN_ITAMGA.CHIIKI_CD AND TMR.NEXT_HAIKI_KBN_CD = 4
    LEFT JOIN M_TODOUFUKEN NEXT_DEN_ITAMT ON NEXT_DEN_ITAMT.TODOUFUKEN_CD = NEXT_DEN_ITAMC.TODOUFUKEN_CD AND TMR.NEXT_HAIKI_KBN_CD = 4 
    LEFT JOIN M_GYOUSHA HSTMGS ON HSTMGS.GYOUSHA_CD = TME.HST_GYOUSHA_CD
    LEFT JOIN M_CHIIKI HSTMGSMCK ON HSTMGSMCK.CHIIKI_CD = HSTMGS.CHIIKI_CD
    LEFT JOIN M_TODOUFUKEN HSTMGSMT ON HSTMGSMT.TODOUFUKEN_CD = HSTMGSMCK.TODOUFUKEN_CD
    LEFT JOIN M_CHIIKI HSTMGAMCK ON HSTMGAMCK.CHIIKI_CD = HSTMGA.CHIIKI_CD
    LEFT JOIN M_TODOUFUKEN HSTMGAMT ON HSTMGAMT.TODOUFUKEN_CD = HSTMGAMCK.TODOUFUKEN_CD
    LEFT JOIN M_GYOUSHA SBNMGS ON SBNMGS.GYOUSHA_CD = TMU.UPN_SAKI_GYOUSHA_CD
    LEFT JOIN M_CHIIKI SBNMGSMCK ON SBNMGSMCK.CHIIKI_CD = SBNMGS.CHIIKI_CD
    LEFT JOIN M_TODOUFUKEN SBNMGSMT ON SBNMGSMT.TODOUFUKEN_CD = SBNMGSMCK.TODOUFUKEN_CD
    LEFT JOIN M_CHIIKI TMUMC ON TMUMC.CHIIKI_CD = TMUMGA.CHIIKI_CD
    LEFT JOIN M_TODOUFUKEN TMUMT ON TMUMT.TODOUFUKEN_CD = TMUMC.TODOUFUKEN_CD
    LEFT JOIN M_HAIKI_SHURUI MHS ON MHS.HAIKI_KBN_CD = TME.HAIKI_KBN_CD AND MHS.HAIKI_SHURUI_CD = TMD.HAIKI_SHURUI_CD
    LEFT JOIN M_CHIIKIBETSU_BUNRUI MCB ON MCB.CHIIKI_CD = /*data.TEISHUTSU_CHIIKI_CD*/0 AND MCB.HOUKOKUSHO_BUNRUI_CD = MHS.HOUKOKUSHO_BUNRUI_CD 
    LEFT JOIN M_CHIIKIBETSU_KYOKA HSTMCK ON HSTMCK.GYOUSHA_CD = TME.HST_GYOUSHA_CD AND HSTMCK.GENBA_CD = TME.HST_GENBA_CD
    /*IF data.GYOUSHA_KBN.Value == 1*/
        AND HSTMCK.KYOKA_KBN =2 AND HSTMCK.CHIIKI_CD = /*data.TEISHUTSU_CHIIKI_CD*/0
    /*END*/
    /*IF data.GYOUSHA_KBN.Value == 2*/
        AND HSTMCK.KYOKA_KBN =3 AND HSTMCK.CHIIKI_CD = /*data.TEISHUTSU_CHIIKI_CD*/0
    /*END*/
    LEFT JOIN M_UNIT MU ON MU.UNIT_CD = (SELECT MANI_KANSAN_KIHON_UNIT_CD FROM M_SYS_INFO) 
    LEFT JOIN M_CHIIKIBETSU_SHOBUN MCH ON MCH.SHOBUN_HOUHOU_CD = TMD.SBN_HOUHOU_CD AND MCH.CHIIKI_CD = /*data.TEISHUTSU_CHIIKI_CD*/0
    LEFT JOIN T_MANIFEST_UPN T_MANIFEST_UPN1 ON T_MANIFEST_UPN1.SYSTEM_ID = TME.SYSTEM_ID AND T_MANIFEST_UPN1.SEQ = TME.SEQ AND T_MANIFEST_UPN1.UPN_ROUTE_NO = 1 
    LEFT JOIN T_MANIFEST_UPN T_MANIFEST_UPN2 ON T_MANIFEST_UPN2.SYSTEM_ID = TME.SYSTEM_ID AND T_MANIFEST_UPN2.SEQ = TME.SEQ AND T_MANIFEST_UPN2.UPN_ROUTE_NO = 2
    LEFT JOIN T_MANIFEST_UPN T_MANIFEST_UPN3 ON T_MANIFEST_UPN3.SYSTEM_ID = TME.SYSTEM_ID AND T_MANIFEST_UPN3.SEQ = TME.SEQ AND T_MANIFEST_UPN3.UPN_ROUTE_NO = 3
    LEFT JOIN T_MANIFEST_UPN T_MANIFEST_UPN_NEXT1 ON T_MANIFEST_UPN_NEXT1.SYSTEM_ID = NEXT_TME.SYSTEM_ID AND T_MANIFEST_UPN_NEXT1.SEQ = NEXT_TME.SEQ AND T_MANIFEST_UPN_NEXT1.UPN_ROUTE_NO = 1 AND TMR.NEXT_HAIKI_KBN_CD != 4 
    LEFT JOIN T_MANIFEST_UPN T_MANIFEST_UPN_NEXT2 ON T_MANIFEST_UPN_NEXT2.SYSTEM_ID = NEXT_TME.SYSTEM_ID AND T_MANIFEST_UPN_NEXT2.SEQ = NEXT_TME.SEQ AND T_MANIFEST_UPN_NEXT2.UPN_ROUTE_NO = 2 AND TMR.NEXT_HAIKI_KBN_CD != 4
    LEFT JOIN T_MANIFEST_UPN T_MANIFEST_UPN_NEXT3 ON T_MANIFEST_UPN_NEXT3.SYSTEM_ID = NEXT_TME.SYSTEM_ID AND T_MANIFEST_UPN_NEXT3.SEQ = NEXT_TME.SEQ AND T_MANIFEST_UPN_NEXT3.UPN_ROUTE_NO = 3 AND TMR.NEXT_HAIKI_KBN_CD != 4
    LEFT JOIN T_MANIFEST_DETAIL TMD_NEXT ON TMD_NEXT.SYSTEM_ID = NEXT_TME.SYSTEM_ID AND TMD_NEXT.SEQ = NEXT_TME.SEQ  AND TMD_NEXT.DETAIL_SYSTEM_ID = NEXT_TME.DETAIL_SYSTEM_ID
    LEFT JOIN M_HAIKI_SHURUI MHS_NEXT ON MHS_NEXT.HAIKI_KBN_CD = NEXT_TME.HAIKI_KBN_CD AND MHS_NEXT.HAIKI_SHURUI_CD = TMD_NEXT.HAIKI_SHURUI_CD
    LEFT JOIN M_CHIIKIBETSU_BUNRUI MCB_NEXT ON MCB_NEXT.CHIIKI_CD = /*data.TEISHUTSU_CHIIKI_CD*/0 AND MCB_NEXT.HOUKOKUSHO_BUNRUI_CD = MHS_NEXT.HOUKOKUSHO_BUNRUI_CD 
	LEFT JOIN M_CHIIKIBETSU_SHOBUN MCS_NEXT ON MCS_NEXT.CHIIKI_CD = /*data.TEISHUTSU_CHIIKI_CD*/0 AND MCS_NEXT.SHOBUN_HOUHOU_CD = TMD_NEXT.SBN_HOUHOU_CD

    LEFT JOIN DT_R19 NEXT_UPN1
           ON NEXT_DTR18EX.KANRI_ID         = NEXT_UPN1.KANRI_ID
          AND NEXT_DTR18EX.SEQ              = NEXT_UPN1.SEQ
	      AND NEXT_UPN1.UPN_ROUTE_NO    = 1
          AND TMR.NEXT_HAIKI_KBN_CD = 4 
	LEFT JOIN DT_R19_EX NEXT_UPN_EX1
		   ON NEXT_UPN1.KANRI_ID     = NEXT_UPN_EX1.KANRI_ID
		  AND NEXT_DTR18EX.SYSTEM_ID            = NEXT_UPN_EX1.SYSTEM_ID
		  AND NEXT_DTR18EX.SEQ                  = NEXT_UPN_EX1.SEQ
		  AND NEXT_UPN1.UPN_ROUTE_NO = NEXT_UPN_EX1.UPN_ROUTE_NO
		  AND TMR.NEXT_HAIKI_KBN_CD = 4 
	       
	LEFT JOIN DT_R19 NEXT_UPN2
		   ON NEXT_DTR18EX.KANRI_ID         = NEXT_UPN2.KANRI_ID
		  AND NEXT_DTR18EX.SEQ              = NEXT_UPN2.SEQ
		  AND NEXT_UPN2.UPN_ROUTE_NO    = 2
		  AND TMR.NEXT_HAIKI_KBN_CD = 4 
	LEFT JOIN DT_R19_EX NEXT_UPN_EX2
		   ON NEXT_UPN2.KANRI_ID     = NEXT_UPN_EX2.KANRI_ID
		  AND NEXT_DTR18EX.SYSTEM_ID   = NEXT_UPN_EX2.SYSTEM_ID
		  AND NEXT_DTR18EX.SEQ         = NEXT_UPN_EX2.SEQ
		  AND NEXT_UPN2.UPN_ROUTE_NO = NEXT_UPN_EX2.UPN_ROUTE_NO
		  AND TMR.NEXT_HAIKI_KBN_CD = 4 
	       
	LEFT JOIN DT_R19 NEXT_UPN3
		   ON NEXT_DTR18EX.KANRI_ID         = NEXT_UPN3.KANRI_ID
		  AND NEXT_DTR18EX.SEQ              = NEXT_UPN3.SEQ
		  AND NEXT_UPN3.UPN_ROUTE_NO    = 3
		  AND TMR.NEXT_HAIKI_KBN_CD = 4 
	LEFT JOIN DT_R19_EX NEXT_UPN_EX3
		   ON NEXT_UPN3.KANRI_ID     = NEXT_UPN_EX3.KANRI_ID
		  AND NEXT_DTR18EX.SYSTEM_ID   = NEXT_UPN_EX3.SYSTEM_ID
		  AND NEXT_DTR18EX.SEQ         = NEXT_UPN_EX3.SEQ
		  AND NEXT_UPN3.UPN_ROUTE_NO = NEXT_UPN_EX3.UPN_ROUTE_NO
		  AND TMR.NEXT_HAIKI_KBN_CD = 4 
	       
	LEFT JOIN DT_R19 NEXT_UPN4
		   ON NEXT_DTR18EX.KANRI_ID         = NEXT_UPN4.KANRI_ID
		  AND NEXT_DTR18EX.SEQ              = NEXT_UPN4.SEQ
		  AND NEXT_UPN4.UPN_ROUTE_NO    = 4
		  AND TMR.NEXT_HAIKI_KBN_CD = 4 
	LEFT JOIN DT_R19_EX NEXT_UPN_EX4
		   ON NEXT_UPN4.KANRI_ID     = NEXT_UPN_EX4.KANRI_ID
		  AND NEXT_DTR18EX.SYSTEM_ID   = NEXT_UPN_EX4.SYSTEM_ID
		  AND NEXT_DTR18EX.SEQ         = NEXT_UPN_EX4.SEQ
		  AND NEXT_UPN4.UPN_ROUTE_NO = NEXT_UPN_EX4.UPN_ROUTE_NO
		  AND TMR.NEXT_HAIKI_KBN_CD = 4 
	       
	LEFT JOIN DT_R19 NEXT_UPN5
		   ON NEXT_DTR18EX.KANRI_ID         = NEXT_UPN5.KANRI_ID
		  AND NEXT_DTR18EX.SEQ              = NEXT_UPN5.SEQ
		  AND NEXT_UPN5.UPN_ROUTE_NO    = 5
		  AND TMR.NEXT_HAIKI_KBN_CD = 4 
	LEFT JOIN DT_R19_EX NEXT_UPN_EX5
		   ON NEXT_UPN5.KANRI_ID     = NEXT_UPN_EX5.KANRI_ID
		  AND NEXT_DTR18EX.SYSTEM_ID   = NEXT_UPN_EX5.SYSTEM_ID
		  AND NEXT_DTR18EX.SEQ         = NEXT_UPN_EX5.SEQ
		  AND NEXT_UPN5.UPN_ROUTE_NO = NEXT_UPN_EX5.UPN_ROUTE_NO
		  AND TMR.NEXT_HAIKI_KBN_CD = 4 

WHERE TME.DELETE_FLG = 0
    /*IF data.GYOUSHA_KBN.Value == 1*/
	  /*IF data.JIGYOUJOU_KBN.Value == 1*/
	    AND TMD.SBN_END_DATE IS NOT NULL
		AND (TMD.SBN_END_DATE <= CONVERT(DATETIME, CONVERT(NVARCHAR, /*data.DATE_END.Value*/20140901, 111), 120) AND CONVERT(DATETIME, CONVERT(NVARCHAR, /*data.DATE_BEGIN.Value*/20100901, 111), 120) <= TMD.SBN_END_DATE)
		AND TME.FIRST_MANIFEST_KBN = 0
		AND TMU.UPN_SAKI_GYOUSHA_CD = /*data.HOUKOKU_GYOUSHA_CD*/0
		AND TMU.UPN_SAKI_GENBA_CD = /*data.HOUKOKU_GENBA_CD*/0
		/*IF data.KEN_KBN.Value == 1*/
			AND HSTMGA.CHIIKI_CD = TMUMGA.CHIIKI_CD
		/*END*/
		/*IF data.KEN_KBN.Value == 2*/
			AND HSTMGA.CHIIKI_CD != TMUMGA.CHIIKI_CD
		/*END*/
	  /*END*/
	  /*IF data.JIGYOUJOU_KBN.Value == 2*/
	    AND TME.FIRST_MANIFEST_KBN = 0
	    AND ((TMD.LAST_SBN_END_DATE IS NOT NULL
		     AND (TMD.LAST_SBN_END_DATE <= CONVERT(DATETIME, CONVERT(NVARCHAR, /*data.DATE_END.Value*/20140901, 111), 120) AND CONVERT(DATETIME, CONVERT(NVARCHAR, /*data.DATE_BEGIN.Value*/20100901, 111), 120) <= TMD.LAST_SBN_END_DATE)
			 AND TMR.NEXT_SYSTEM_ID IS NULL
			 AND TMD.LAST_SBN_GYOUSHA_CD = /*data.HOUKOKU_GYOUSHA_CD*/0
		     AND TMD.LAST_SBN_GENBA_CD = /*data.HOUKOKU_GENBA_CD*/0)
		   OR (TMD.SBN_END_DATE IS NOT NULL
		     AND (TMD.SBN_END_DATE <= CONVERT(DATETIME, CONVERT(NVARCHAR, /*data.DATE_END.Value*/20140901, 111), 120) AND CONVERT(DATETIME, CONVERT(NVARCHAR, /*data.DATE_BEGIN.Value*/20100901, 111), 120) <= TMD.SBN_END_DATE)
		     AND TMR.NEXT_SYSTEM_ID IS NOT NULL
			 AND TMU.UPN_SAKI_GYOUSHA_CD = /*data.HOUKOKU_GYOUSHA_CD*/0
		     AND TMU.UPN_SAKI_GENBA_CD = /*data.HOUKOKU_GENBA_CD*/0
            ))
        /*IF data.KEN_KBN.Value == 1*/
			AND HSTMGA.CHIIKI_CD = TMUMGA.CHIIKI_CD
		/*END*/
		/*IF data.KEN_KBN.Value == 2*/
			AND HSTMGA.CHIIKI_CD != TMUMGA.CHIIKI_CD
		/*END*/
	  /*END*/
	/*END*/

	/*IF data.GYOUSHA_KBN.Value == 2*/
	  /*IF data.JIGYOUJOU_KBN.Value == 1*/
		AND (TMD.SBN_END_DATE <= CONVERT(DATETIME, CONVERT(NVARCHAR, /*data.DATE_END.Value*/20140901, 111), 120) AND CONVERT(DATETIME, CONVERT(NVARCHAR, /*data.DATE_BEGIN.Value*/20100901, 111), 120) <= TMD.SBN_END_DATE)
		AND TMD.SBN_END_DATE IS NOT NULL
		AND TME.FIRST_MANIFEST_KBN = 1
		AND TMU.UPN_SAKI_GYOUSHA_CD = /*data.HOUKOKU_GYOUSHA_CD*/0
		AND TMU.UPN_SAKI_GENBA_CD = /*data.HOUKOKU_GENBA_CD*/0
		/*IF data.KEN_KBN.Value == 1*/
			AND HSTMGA.CHIIKI_CD = TMUMGA.CHIIKI_CD
		/*END*/
		/*IF data.KEN_KBN.Value == 2*/
			AND HSTMGA.CHIIKI_CD != TMUMGA.CHIIKI_CD
		/*END*/
	  /*END*/

	  /*IF data.JIGYOUJOU_KBN.Value == 2*/
		AND (TMD.LAST_SBN_END_DATE <= CONVERT(DATETIME, CONVERT(NVARCHAR, /*data.DATE_END.Value*/20140901, 111), 120) AND CONVERT(DATETIME, CONVERT(NVARCHAR, /*data.DATE_BEGIN.Value*/20100901, 111), 120) <= TMD.LAST_SBN_END_DATE)
		AND TMD.LAST_SBN_END_DATE IS NOT NULL
		AND TME.FIRST_MANIFEST_KBN = 1
		AND TMD.LAST_SBN_GYOUSHA_CD = /*data.HOUKOKU_GYOUSHA_CD*/0
		AND TMD.LAST_SBN_GENBA_CD = /*data.HOUKOKU_GENBA_CD*/0
		/*IF data.KEN_KBN.Value == 1*/
			AND HSTMGA.CHIIKI_CD = TMUMGA.CHIIKI_CD
		/*END*/
		/*IF data.KEN_KBN.Value == 2*/
			AND HSTMGA.CHIIKI_CD != TMUMGA.CHIIKI_CD
		/*END*/
      /*END*/
	/*END*/
	/*IF data.TOKUBETSU_KANRI_KBN.Value == 1*/
	AND (
	(TME.HAIKI_KBN_CD != 2 AND TMD.HAIKI_SHURUI_CD BETWEEN '0000' AND '6999') OR 
	(TME.HAIKI_KBN_CD = 2 AND TMD.HAIKI_SHURUI_CD BETWEEN '0000' AND '2099')
	)
	/*END*/

	/*IF data.TOKUBETSU_KANRI_KBN.Value == 2*/
	AND (
	(TME.HAIKI_KBN_CD != 2 AND TMD.HAIKI_SHURUI_CD BETWEEN '7000' AND '9999') OR 
	(TME.HAIKI_KBN_CD = 2 AND TMD.HAIKI_SHURUI_CD BETWEEN '2100' AND '9999')
	)
	/*END*/

/*IF data.DENMANI_KBN.Value == 1*/
UNION

SELECT DISTINCT
     NULL AS SYSTEM_ID
    ,NULL AS SEQ
	,DTR18.SYSTEM_ID AS DETAIL_SYSTEM_ID
    ,DTR18.MANIFEST_ID AS MANIFEST_ID
    ,DTR18.KANRI_ID AS KANRI_ID
    ,DTR18.SEQ AS DEN_SEQ
    ,DTR18.HAIKI_SHURUI_NAME AS HAIKI_SHURUI_NAME
    ,'4' AS HAIKI_KBN_CD
    ,DTR18.HAIKI_DAI_CODE + DTR18.HAIKI_CHU_CODE + DTR18.HAIKI_SHO_CODE AS HAIKI_SHURUI_CD
    ,DTR18.HST_GYOUSHA_CD AS HST_GYOUSHA_CD
    ,DTR18.HST_GENBA_CD AS HST_GENBA_CD
    ,DTR18.SBN_GYOUSHA_CD AS SBN_GYOUSHA_CD
    ,DTR18.SBN_GENBA_CD AS SBN_GENBA_CD
    ,DTR19.UPN_ROUTE_NO AS ROUTE_NO
    ,DTR18.SBN_HOUHOU_CD AS SBN_HOUHOU_CD
    ,DTR19.UPNSAKI_JOU_KBN AS UPN_SAKI_KBN
    ,DTR18.KANSAN_SUU AS KANSAN_SUU
    /*IF data.GYOUSHA_KBN.Value == 1 && data.SAI_ITAKU_KBN.Value == 1*/
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4 THEN 1
            WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 THEN 1
            ELSE 0 END AS ITAKU_KBN
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4 THEN NEXT_TMU.UPN_SAKI_GYOUSHA_CD
            WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 THEN NEXT_DTR19EX.UPNSAKI_GYOUSHA_CD
            ELSE NULL END AS SBN_GYOUSHA_CD_NEXT
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4 THEN NEXT_TMU.UPN_SAKI_GENBA_CD
            WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 THEN NEXT_DTR19EX.UPNSAKI_GENBA_CD
            ELSE NULL END AS SBN_GENBA_CD_NEXT
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4 THEN NEXT_TMU.UPN_SAKI_GENBA_NAME
            WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 THEN NEXT_DEN_ITAMGA.GENBA_NAME1 + NEXT_DEN_ITAMGA.GENBA_NAME2
            ELSE NULL END AS ITAKUSAKI_NAME
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4 THEN NEXT_TMU.UPN_SAKI_GENBA_ADDRESS
            WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 THEN 
            /*IF data.ADDRESS_KBN.Value == 1*/
                NEXT_DEN_ITAMT.TODOUFUKEN_NAME + NEXT_DEN_ITAMGA.GENBA_ADDRESS1 + NEXT_DEN_ITAMGA.GENBA_ADDRESS2 
            /*END*/
            /*IF data.ADDRESS_KBN.Value == 2*/
                NEXT_DEN_ITAMGA.GENBA_ADDRESS1 + NEXT_DEN_ITAMGA.GENBA_ADDRESS2
            /*END*/
            /*IF data.ADDRESS_KBN.Value == 3*/
                NEXT_DEN_ITAMT.TODOUFUKEN_NAME + NEXT_DEN_ITAMGA.GENBA_ADDRESS1 
            /*END*/
            ELSE NULL END AS ITAKUSAKI_ADDRESS
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4 THEN NEXT_ITAMGA.CHIIKI_CD
            WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 THEN NEXT_DEN_ITAMGA.CHIIKI_CD
            ELSE NULL END AS ITAKUSAKI_CHIIKI_CD
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4 THEN
				--二次マニが紙マニフェストの場合
				CASE WHEN NEXT_TME.HAIKI_KBN_CD = 2 THEN
					CASE WHEN TMD_NEXT.HAIKI_SHURUI_CD BETWEEN '0000' AND '2099' THEN NEXT_MCK.FUTSUU_KYOKA_NO
					ELSE NEXT_MCK.TOKUBETSU_KYOKA_NO
					END
				ELSE
					CASE WHEN TMD_NEXT.HAIKI_SHURUI_CD BETWEEN '0000' AND '6999' THEN NEXT_MCK.FUTSUU_KYOKA_NO
					ELSE NEXT_MCK.TOKUBETSU_KYOKA_NO
					END
				END
            WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 THEN 
				--二次マニが電子マニフェストの場合
				CASE WHEN (NEXT_DTR18.HAIKI_DAI_CODE + NEXT_DTR18.HAIKI_CHU_CODE + NEXT_DTR18.HAIKI_SHO_CODE) BETWEEN '0000' AND '6999' THEN NEXT_DEN_MCK.FUTSUU_KYOKA_NO
					ELSE NEXT_DEN_MCK.TOKUBETSU_KYOKA_NO
					END
            ELSE NULL END AS ITAKUSAKI_KYOKA_NO
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4 THEN
				--二次マニが紙マニフェストの場合
				CASE WHEN NEXT_TME.HAIKI_KBN_CD = 2 THEN
					CASE WHEN TMD_NEXT.HAIKI_SHURUI_CD BETWEEN '0000' AND '2099' THEN 0
					ELSE 1
					END
				ELSE
					CASE WHEN TMD_NEXT.HAIKI_SHURUI_CD BETWEEN '0000' AND '6999' THEN 0
					ELSE 1
					END
				END
            WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 THEN 
				--二次マニが電子マニフェストの場合
				CASE WHEN (NEXT_DTR18.HAIKI_DAI_CODE + NEXT_DTR18.HAIKI_CHU_CODE + NEXT_DTR18.HAIKI_SHO_CODE) BETWEEN '0000' AND '6999' THEN 0
					ELSE 1
					END
            ELSE NULL END AS ITAKUSAKI_KYOKA_KBN
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4 AND ((TMR.NEXT_HAIKI_KBN_CD = 3 AND NEXT_TMU.UPN_ROUTE_NO >= 1) OR TMR.NEXT_HAIKI_KBN_CD != 3)
              THEN T_MANIFEST_UPN_NEXT1.UPN_JYUTAKUSHA_CD  
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 AND NEXT_DTR19.UPN_ROUTE_NO >= 1
              THEN NEXT_UPN_EX1.UPN_GYOUSHA_CD
              ELSE NULL
              END AS UPN_GYOUSHA_CD1_NEXT
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4 AND ((TMR.NEXT_HAIKI_KBN_CD = 3 AND NEXT_TMU.UPN_ROUTE_NO >= 2) OR TMR.NEXT_HAIKI_KBN_CD != 3)
              THEN T_MANIFEST_UPN_NEXT2.UPN_JYUTAKUSHA_CD  
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 AND NEXT_DTR19.UPN_ROUTE_NO >= 2 
              THEN NEXT_UPN_EX2.UPN_GYOUSHA_CD
              ELSE NULL
              END AS UPN_GYOUSHA_CD2_NEXT
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4 AND ((TMR.NEXT_HAIKI_KBN_CD = 3 AND NEXT_TMU.UPN_ROUTE_NO >= 3) OR TMR.NEXT_HAIKI_KBN_CD != 3)
              THEN T_MANIFEST_UPN_NEXT3.UPN_JYUTAKUSHA_CD  
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 AND NEXT_DTR19.UPN_ROUTE_NO >= 3 
              THEN NEXT_UPN_EX3.UPN_GYOUSHA_CD
              ELSE NULL
              END AS UPN_GYOUSHA_CD3_NEXT
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND (TMR.NEXT_HAIKI_KBN_CD = 1 OR TMR.NEXT_HAIKI_KBN_CD = 2)
              THEN NEXT_TME.TMH_GYOUSHA_CD   
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 3 AND NEXT_TMU.UPN_ROUTE_NO > 1
              THEN T_MANIFEST_UPN_NEXT1.UPN_SAKI_GYOUSHA_CD
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 AND NEXT_DTR19.UPN_ROUTE_NO > 1
              THEN NEXT_UPN_EX1.UPNSAKI_GYOUSHA_CD
              ELSE NULL
              END AS TMH1_GYOUSHA_CD_NEXT
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND (TMR.NEXT_HAIKI_KBN_CD = 1 OR TMR.NEXT_HAIKI_KBN_CD = 2)
              THEN NEXT_TME.TMH_GENBA_CD   
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 3 AND NEXT_TMU.UPN_ROUTE_NO > 1
              THEN T_MANIFEST_UPN_NEXT1.UPN_SAKI_GENBA_CD
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 AND NEXT_DTR19.UPN_ROUTE_NO > 1
              THEN NEXT_UPN_EX1.UPNSAKI_GENBA_CD
              ELSE NULL
              END AS TMH1_GENBA_CD_NEXT 
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND (TMR.NEXT_HAIKI_KBN_CD = 1 OR TMR.NEXT_HAIKI_KBN_CD = 2)
              THEN NULL   
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 3 AND NEXT_TMU.UPN_ROUTE_NO > 2
              THEN T_MANIFEST_UPN_NEXT2.UPN_SAKI_GYOUSHA_CD
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 AND NEXT_DTR19.UPN_ROUTE_NO > 2
              THEN NEXT_UPN_EX2.UPNSAKI_GYOUSHA_CD
              ELSE NULL
              END AS TMH2_GYOUSHA_CD_NEXT
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND (TMR.NEXT_HAIKI_KBN_CD = 1 OR TMR.NEXT_HAIKI_KBN_CD = 2)
              THEN NULL   
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 3 AND NEXT_TMU.UPN_ROUTE_NO > 2
              THEN T_MANIFEST_UPN_NEXT2.UPN_SAKI_GENBA_CD
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 AND NEXT_DTR19.UPN_ROUTE_NO > 2
              THEN NEXT_UPN_EX2.UPNSAKI_GENBA_CD
              ELSE NULL
              END AS TMH2_GENBA_CD_NEXT 
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4
              THEN TMD_NEXT.HAIKI_SHURUI_CD
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4
              THEN NEXT_DTR18.HAIKI_DAI_CODE + NEXT_DTR18.HAIKI_CHU_CODE + NEXT_DTR18.HAIKI_SHO_CODE
              ELSE NULL
              END AS HAIKI_SHURUI_CD_NEXT 
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4
              THEN NEXT_TME.MANIFEST_ID
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4
              THEN NEXT_DTR18.MANIFEST_ID
              ELSE NULL
              END AS MANIFEST_ID_NEXT 
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4
              THEN NEXT_TME.KOUFU_DATE
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4
              THEN NEXT_DTR18.HIKIWATASHI_DATE 
              ELSE NULL
              END AS KOUFU_DATE_NEXT 
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4
              THEN DTR18.GENNYOU_SUU
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4
              THEN DTR18.GENNYOU_SUU 
              ELSE NULL
              END AS GENYOU_SUU
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4
				THEN MCB_NEXT.HOUKOKU_BUNRUI_CD
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4
				THEN NEXT_D_MCB.HOUKOKU_BUNRUI_CD
              ELSE NULL
              END AS HOUKOKUSHO_BUNRUI_CD_NEXT
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4
				THEN MCB_NEXT.HOUKOKU_BUNRUI_NAME
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4
				THEN NEXT_D_MCB.HOUKOKU_BUNRUI_NAME
              ELSE NULL
              END AS HOUKOKUSHO_BUNRUI_NAME_NEXT
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4
				THEN MCS_NEXT.HOUKOKU_SHOBUN_HOUHOU_CD
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4
				THEN NEXT_D_CBS.HOUKOKU_SHOBUN_HOUHOU_CD
              ELSE NULL
              END AS SHOBUN_HOUHOU_CD_NEXT
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4
				THEN MCS_NEXT.HOUKOKU_SHOBUN_HOUHOU_NAME
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4
				THEN NEXT_D_CBS.HOUKOKU_SHOBUN_HOUHOU_NAME
              ELSE NULL
              END AS SHOBUN_HOUHOU_NAME_NEXT
    /*END*/
    /*IF data.GYOUSHA_KBN.Value == 1 && data.SAI_ITAKU_KBN.Value == 2*/
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4 AND NEXT_ITAMGA.JISHA_KBN = 0 THEN 1
            WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 AND NEXT_DEN_ITAMGA.JISHA_KBN = 0 THEN 1
            ELSE 0 END AS ITAKU_KBN
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4 AND NEXT_ITAMGA.JISHA_KBN = 0 THEN NEXT_TMU.UPN_SAKI_GYOUSHA_CD
            WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 AND NEXT_DEN_ITAMGA.JISHA_KBN = 0 THEN NEXT_DTR19EX.UPNSAKI_GYOUSHA_CD
            ELSE NULL END AS SBN_GYOUSHA_CD_NEXT
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4 AND NEXT_ITAMGA.JISHA_KBN = 0 THEN NEXT_TMU.UPN_SAKI_GENBA_CD
            WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 AND NEXT_DEN_ITAMGA.JISHA_KBN = 0 THEN NEXT_DTR19EX.UPNSAKI_GENBA_CD
            ELSE NULL END AS SBN_GENBA_CD_NEXT
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4 AND NEXT_ITAMGA.JISHA_KBN = 0 THEN NEXT_TMU.UPN_SAKI_GENBA_NAME
            WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 AND NEXT_DEN_ITAMGA.JISHA_KBN = 0 THEN NEXT_DEN_ITAMGA.GENBA_NAME1 + NEXT_DEN_ITAMGA.GENBA_NAME2
            ELSE NULL END AS ITAKUSAKI_NAME
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4 AND NEXT_ITAMGA.JISHA_KBN = 0 THEN NEXT_TMU.UPN_SAKI_GENBA_ADDRESS
            WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 AND NEXT_DEN_ITAMGA.JISHA_KBN = 0 THEN 
            /*IF data.ADDRESS_KBN.Value == 1*/
                NEXT_DEN_ITAMT.TODOUFUKEN_NAME + NEXT_DEN_ITAMGA.GENBA_ADDRESS1 + NEXT_DEN_ITAMGA.GENBA_ADDRESS2 
            /*END*/
            /*IF data.ADDRESS_KBN.Value == 2*/
                NEXT_DEN_ITAMGA.GENBA_ADDRESS1 + NEXT_DEN_ITAMGA.GENBA_ADDRESS2
            /*END*/
            /*IF data.ADDRESS_KBN.Value == 3*/
                NEXT_DEN_ITAMT.TODOUFUKEN_NAME + NEXT_DEN_ITAMGA.GENBA_ADDRESS1 
            /*END*/
            ELSE NULL END AS ITAKUSAKI_ADDRESS
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4 AND NEXT_ITAMGA.JISHA_KBN = 0 THEN NEXT_ITAMGA.CHIIKI_CD
            WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 AND NEXT_DEN_ITAMGA.JISHA_KBN = 0 THEN NEXT_DEN_ITAMGA.CHIIKI_CD
            ELSE NULL END AS ITAKUSAKI_CHIIKI_CD
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4 AND NEXT_ITAMGA.JISHA_KBN = 0 THEN
				--二次マニが紙マニフェストの場合
				CASE WHEN NEXT_TME.HAIKI_KBN_CD = 2 THEN
					CASE WHEN TMD_NEXT.HAIKI_SHURUI_CD BETWEEN '0000' AND '2099' THEN NEXT_MCK.FUTSUU_KYOKA_NO
					ELSE NEXT_MCK.TOKUBETSU_KYOKA_NO
					END
				ELSE
					CASE WHEN TMD_NEXT.HAIKI_SHURUI_CD BETWEEN '0000' AND '6999' THEN NEXT_MCK.FUTSUU_KYOKA_NO
					ELSE NEXT_MCK.TOKUBETSU_KYOKA_NO
					END
				END
            WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 AND NEXT_DEN_ITAMGA.JISHA_KBN = 0 THEN 
				--二次マニが電子マニフェストの場合
				CASE WHEN (NEXT_DTR18.HAIKI_DAI_CODE + NEXT_DTR18.HAIKI_CHU_CODE + NEXT_DTR18.HAIKI_SHO_CODE) BETWEEN '0000' AND '6999' THEN NEXT_DEN_MCK.FUTSUU_KYOKA_NO
					ELSE NEXT_DEN_MCK.TOKUBETSU_KYOKA_NO
					END
            ELSE NULL END AS ITAKUSAKI_KYOKA_NO
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4 AND NEXT_ITAMGA.JISHA_KBN = 0 THEN
				--二次マニが紙マニフェストの場合
				CASE WHEN NEXT_TME.HAIKI_KBN_CD = 2 THEN
					CASE WHEN TMD_NEXT.HAIKI_SHURUI_CD BETWEEN '0000' AND '2099' THEN 0
					ELSE 1
					END
				ELSE
					CASE WHEN TMD_NEXT.HAIKI_SHURUI_CD BETWEEN '0000' AND '6999' THEN 0
					ELSE 1
					END
				END
            WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 AND NEXT_DEN_ITAMGA.JISHA_KBN = 0 THEN 
				--二次マニが電子マニフェストの場合
				CASE WHEN (NEXT_DTR18.HAIKI_DAI_CODE + NEXT_DTR18.HAIKI_CHU_CODE + NEXT_DTR18.HAIKI_SHO_CODE) BETWEEN '0000' AND '6999' THEN 0
					ELSE 1
					END
            ELSE NULL END AS ITAKUSAKI_KYOKA_KBN
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4 AND NEXT_ITAMGA.JISHA_KBN = 0 AND ((TMR.NEXT_HAIKI_KBN_CD = 3 AND NEXT_TMU.UPN_ROUTE_NO >= 1) OR TMR.NEXT_HAIKI_KBN_CD != 3)
              THEN T_MANIFEST_UPN_NEXT1.UPN_JYUTAKUSHA_CD  
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 AND NEXT_DEN_ITAMGA.JISHA_KBN = 0 AND NEXT_DTR19.UPN_ROUTE_NO >= 1
              THEN NEXT_UPN_EX1.UPN_GYOUSHA_CD
              ELSE NULL
              END AS UPN_GYOUSHA_CD1_NEXT
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4 AND NEXT_ITAMGA.JISHA_KBN = 0 AND ((TMR.NEXT_HAIKI_KBN_CD = 3 AND NEXT_TMU.UPN_ROUTE_NO >= 2) OR TMR.NEXT_HAIKI_KBN_CD != 3)
              THEN T_MANIFEST_UPN_NEXT2.UPN_JYUTAKUSHA_CD  
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 AND NEXT_DEN_ITAMGA.JISHA_KBN = 0 AND NEXT_DTR19.UPN_ROUTE_NO >= 2 
              THEN NEXT_UPN_EX2.UPN_GYOUSHA_CD
              ELSE NULL
              END AS UPN_GYOUSHA_CD2_NEXT
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4 AND NEXT_ITAMGA.JISHA_KBN = 0 AND ((TMR.NEXT_HAIKI_KBN_CD = 3 AND NEXT_TMU.UPN_ROUTE_NO >= 3) OR TMR.NEXT_HAIKI_KBN_CD != 3)
              THEN T_MANIFEST_UPN_NEXT3.UPN_JYUTAKUSHA_CD  
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 AND NEXT_DEN_ITAMGA.JISHA_KBN = 0 AND NEXT_DTR19.UPN_ROUTE_NO >= 3 
              THEN NEXT_UPN_EX3.UPN_GYOUSHA_CD
              ELSE NULL
              END AS UPN_GYOUSHA_CD3_NEXT
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND (TMR.NEXT_HAIKI_KBN_CD = 1 OR TMR.NEXT_HAIKI_KBN_CD = 2) AND NEXT_ITAMGA.JISHA_KBN = 0
              THEN NEXT_TME.TMH_GYOUSHA_CD   
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 3 AND NEXT_ITAMGA.JISHA_KBN = 0 AND NEXT_TMU.UPN_ROUTE_NO > 1
              THEN T_MANIFEST_UPN_NEXT1.UPN_SAKI_GYOUSHA_CD
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 AND NEXT_DEN_ITAMGA.JISHA_KBN = 0 AND NEXT_DTR19.UPN_ROUTE_NO > 1
              THEN NEXT_UPN_EX1.UPNSAKI_GYOUSHA_CD
              ELSE NULL
              END AS TMH1_GYOUSHA_CD_NEXT
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND (TMR.NEXT_HAIKI_KBN_CD = 1 OR TMR.NEXT_HAIKI_KBN_CD = 2) AND NEXT_ITAMGA.JISHA_KBN = 0
              THEN NEXT_TME.TMH_GENBA_CD   
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 3 AND NEXT_ITAMGA.JISHA_KBN = 0 AND NEXT_TMU.UPN_ROUTE_NO > 1
              THEN T_MANIFEST_UPN_NEXT1.UPN_SAKI_GENBA_CD
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 AND NEXT_DEN_ITAMGA.JISHA_KBN = 0 
              THEN NEXT_UPN_EX1.UPNSAKI_GENBA_CD
              ELSE NULL
              END AS TMH1_GENBA_CD_NEXT 
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND (TMR.NEXT_HAIKI_KBN_CD = 1 OR TMR.NEXT_HAIKI_KBN_CD = 2) AND NEXT_ITAMGA.JISHA_KBN = 0
              THEN NULL   
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 3 AND NEXT_ITAMGA.JISHA_KBN = 0 AND NEXT_TMU.UPN_ROUTE_NO > 2
              THEN T_MANIFEST_UPN_NEXT2.UPN_SAKI_GYOUSHA_CD
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 AND NEXT_DEN_ITAMGA.JISHA_KBN = 0 
              THEN NEXT_UPN_EX2.UPNSAKI_GYOUSHA_CD
              ELSE NULL
              END AS TMH2_GYOUSHA_CD_NEXT
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND (TMR.NEXT_HAIKI_KBN_CD = 1 OR TMR.NEXT_HAIKI_KBN_CD = 2) AND NEXT_ITAMGA.JISHA_KBN = 0
              THEN NULL   
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 3 AND NEXT_ITAMGA.JISHA_KBN = 0 AND NEXT_TMU.UPN_ROUTE_NO > 2
              THEN T_MANIFEST_UPN_NEXT2.UPN_SAKI_GENBA_CD
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 AND NEXT_DEN_ITAMGA.JISHA_KBN = 0 
              THEN NEXT_UPN_EX2.UPNSAKI_GENBA_CD
              ELSE NULL
              END AS TMH2_GENBA_CD_NEXT 
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4 AND NEXT_ITAMGA.JISHA_KBN = 0
              THEN TMD_NEXT.HAIKI_SHURUI_CD
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 AND NEXT_DEN_ITAMGA.JISHA_KBN = 0
              THEN NEXT_DTR18.HAIKI_DAI_CODE + NEXT_DTR18.HAIKI_CHU_CODE + NEXT_DTR18.HAIKI_SHO_CODE
              ELSE NULL
              END AS HAIKI_SHURUI_CD_NEXT 
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4 AND NEXT_ITAMGA.JISHA_KBN = 0
              THEN NEXT_TME.MANIFEST_ID
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 AND NEXT_DEN_ITAMGA.JISHA_KBN = 0
              THEN NEXT_DTR18.MANIFEST_ID
              ELSE NULL
              END AS MANIFEST_ID_NEXT 
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4 AND NEXT_ITAMGA.JISHA_KBN = 0
              THEN NEXT_TME.KOUFU_DATE
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 AND NEXT_DEN_ITAMGA.JISHA_KBN = 0
              THEN NEXT_DTR18.HIKIWATASHI_DATE 
              ELSE NULL
              END AS KOUFU_DATE_NEXT 
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4 AND NEXT_ITAMGA.JISHA_KBN = 0
              THEN DTR18.GENNYOU_SUU
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 AND NEXT_DEN_ITAMGA.JISHA_KBN = 0
              THEN DTR18.GENNYOU_SUU 
              ELSE NULL
              END AS GENYOU_SUU          
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4 AND NEXT_ITAMGA.JISHA_KBN = 0
				THEN MCB_NEXT.HOUKOKU_BUNRUI_CD
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 AND NEXT_DEN_ITAMGA.JISHA_KBN = 0
				THEN NEXT_D_MCB.HOUKOKU_BUNRUI_CD
              ELSE NULL
              END AS HOUKOKUSHO_BUNRUI_CD_NEXT
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4 AND NEXT_ITAMGA.JISHA_KBN = 0
				THEN MCB_NEXT.HOUKOKU_BUNRUI_NAME
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 AND NEXT_DEN_ITAMGA.JISHA_KBN = 0
				THEN NEXT_D_MCB.HOUKOKU_BUNRUI_NAME
              ELSE NULL
              END AS HOUKOKUSHO_BUNRUI_NAME_NEXT
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4 AND NEXT_ITAMGA.JISHA_KBN = 0
				THEN MCS_NEXT.HOUKOKU_SHOBUN_HOUHOU_CD
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 AND NEXT_DEN_ITAMGA.JISHA_KBN = 0
				THEN NEXT_D_CBS.HOUKOKU_SHOBUN_HOUHOU_CD
              ELSE NULL
              END AS SHOBUN_HOUHOU_CD_NEXT
        ,CASE WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD != 4 AND NEXT_ITAMGA.JISHA_KBN = 0
				THEN MCS_NEXT.HOUKOKU_SHOBUN_HOUHOU_NAME
              WHEN TMR.NEXT_SYSTEM_ID IS NOT NULL AND TMR.NEXT_HAIKI_KBN_CD = 4 AND NEXT_DEN_ITAMGA.JISHA_KBN = 0
				THEN NEXT_D_CBS.HOUKOKU_SHOBUN_HOUHOU_NAME
              ELSE NULL
              END AS SHOBUN_HOUHOU_NAME_NEXT
    /*END*/
    /*IF data.GYOUSHA_KBN.Value != 1*/
    ,0 AS ITAKU_KBN
    ,NULL AS SBN_GYOUSHA_CD_NEXT
    ,NULL AS SBN_GENBA_CD_NEXT
    ,NULL AS ITAKUSAKI_KYOKA_NO
	,NULL AS ITAKUSAKI_KYOKA_KBN
	,NULL AS ITAKUSAKI_NAME
	,NULL AS ITAKUSAKI_ADDRESS
	,NULL AS ITAKUSAKI_CHIIKI_CD
    ,NULL AS UPN_GYOUSHA_CD1_NEXT
    ,NULL AS UPN_GYOUSHA_CD2_NEXT
    ,NULL AS UPN_GYOUSHA_CD3_NEXT
    ,NULL AS TMH1_GYOUSHA_CD_NEXT
    ,NULL AS TMH1_GENBA_CD_NEXT
    ,NULL AS TMH2_GYOUSHA_CD_NEXT
    ,NULL AS TMH2_GENBA_CD_NEXT
    ,NULL AS HAIKI_SHURUI_CD_NEXT
    ,NULL AS MANIFEST_ID_NEXT
    ,NULL AS KOUFU_DATE_NEXT
    ,NULL AS GENYOU_SUU
	,NULL AS HOUKOKUSHO_BUNRUI_CD_NEXT
	,NULL AS HOUKOKUSHO_BUNRUI_NAME_NEXT
	,NULL AS SHOBUN_HOUHOU_CD_NEXT
	,NULL AS SHOBUN_HOUHOU_NAME_NEXT
    /*END*/
    ,TMR.NEXT_HAIKI_KBN_CD AS NEXT_HAIKI_KBN_CD
    
    ,MCB.HOUKOKU_BUNRUI_CD AS HOUKOKUSHO_BUNRUI_CD    
    ,MCB.HOUKOKU_BUNRUI_NAME AS HOUKOKUSHO_BUNRUI_NAME
    /*IF data.TOKUBETSU_KANRI_KBN.Value == 1*/
        ,MCK.FUTSUU_KYOKA_NO AS SAIITAKU_KYOKA_NO
        ,CASE WHEN MCK.FUTSUU_KYOKA_NO IS NOT NULL THEN '再委託' ELSE NULL END AS JYUTAKU_KBN 
    /*END*/
    /*IF data.TOKUBETSU_KANRI_KBN.Value == 2*/
        ,MCK.TOKUBETSU_KYOKA_NO AS SAIITAKU_KYOKA_NO
        ,CASE WHEN MCK.TOKUBETSU_KYOKA_NO IS NOT NULL THEN '再委託' ELSE NULL END AS JYUTAKU_KBN 
    /*END*/
    ,HSTMGS.GYOUSHA_NAME1 + HSTMGS.GYOUSHA_NAME2 AS HST_GYOUSHA_NAME
    /*IF data.ADDRESS_KBN.Value == 1*/
        ,HSTMGSMT.TODOUFUKEN_NAME + HSTMGS.GYOUSHA_ADDRESS1 + HSTMGS.GYOUSHA_ADDRESS2 AS HST_GYOUSHA_ADDRESS
    /*END*/
    /*IF data.ADDRESS_KBN.Value == 2*/
        ,HSTMGS.GYOUSHA_ADDRESS1 + HSTMGS.GYOUSHA_ADDRESS2 AS HST_GYOUSHA_ADDRESS
    /*END*/
    /*IF data.ADDRESS_KBN.Value == 3*/
        ,HSTMGSMT.TODOUFUKEN_NAME + HSTMGS.GYOUSHA_ADDRESS1 AS HST_GYOUSHA_ADDRESS
    /*END*/
    
    ,HSTMGA.GENBA_NAME1 + HSTMGA.GENBA_NAME2 AS HST_GENBA_NAME
    /*IF data.ADDRESS_KBN.Value == 1*/
        ,HSTMGAMT.TODOUFUKEN_NAME + HSTMGA.GENBA_ADDRESS1 + HSTMGA.GENBA_ADDRESS2 AS HST_GENBA_ADDRESS
    /*END*/
    /*IF data.ADDRESS_KBN.Value == 2*/
        ,HSTMGA.GENBA_ADDRESS1 + HSTMGA.GENBA_ADDRESS2 AS HST_GENBA_ADDRESS
    /*END*/
    /*IF data.ADDRESS_KBN.Value == 3*/
        ,HSTMGAMT.TODOUFUKEN_NAME + HSTMGA.GENBA_ADDRESS1 AS HST_GENBA_ADDRESS
    /*END*/
    ,HSTMGA.CHIIKI_CD AS HST_GENBA_CHIIKI_CD
    ,MU.UNIT_NAME AS JYUTAKU_UNIT_NAME
    ,MCH.HOUKOKU_SHOBUN_HOUHOU_CD AS SHOBUN_HOUHOU_CD
    ,MCH.HOUKOKU_SHOBUN_HOUHOU_NAME AS SHOBUN_HOUHOU_NAME
    ,NULL AS SBN_MOKUTEKI_CD
	,NULL AS SBN_MOKUTEKI_NAME
    ,SBNMGS.GYOUSHA_NAME1 + SBNMGS.GYOUSHA_NAME2 AS SBN_GYOUSHA_NAME
    /*IF data.ADDRESS_KBN.Value == 1*/
        ,SBNMGSMT.TODOUFUKEN_NAME + SBNMGS.GYOUSHA_ADDRESS1 + SBNMGS.GYOUSHA_ADDRESS2 AS SBN_GYOUSHA_ADDRESS
    /*END*/
    /*IF data.ADDRESS_KBN.Value == 2*/
        ,SBNMGS.GYOUSHA_ADDRESS1 + SBNMGS.GYOUSHA_ADDRESS2 AS SBN_GYOUSHA_ADDRESS
    /*END*/
    /*IF data.ADDRESS_KBN.Value == 3*/
        ,SBNMGSMT.TODOUFUKEN_NAME + SBNMGS.GYOUSHA_ADDRESS1 AS SBN_GYOUSHA_ADDRESS
    /*END*/
    ,TMUMGA.GENBA_NAME1 + TMUMGA.GENBA_NAME2 AS SBN_GENBA_NAME
    /*IF data.ADDRESS_KBN.Value == 1*/
        ,TMUMT.TODOUFUKEN_NAME + TMUMGA.GENBA_ADDRESS1 + TMUMGA.GENBA_ADDRESS2 
    /*END*/
    /*IF data.ADDRESS_KBN.Value == 2*/
        ,TMUMGA.GENBA_ADDRESS1 + TMUMGA.GENBA_ADDRESS2 
    /*END*/
    /*IF data.ADDRESS_KBN.Value == 3*/
        ,TMUMT.TODOUFUKEN_NAME + TMUMGA.GENBA_ADDRESS1 
    /*END*/
    AS SBN_GENBA_ADDRESS
    ,TMUMGA.CHIIKI_CD AS SBN_GENBA_CHIIKI_CD
    ,HSTMGA.CHIIKI_CD AS HST_JOU_CHIIKI_CD
    ,HSTMGA.GENBA_TODOUFUKEN_CD AS HST_JOU_TODOUFUKEN_CD
    ,CASE WHEN HSTMGA.CHIIKI_CD = /*data.TEISHUTSU_CHIIKI_CD*/0 THEN 1
        ELSE 2 END AS HST_KEN_KBN
    ,CASE
	   WHEN DTR19.UPN_ROUTE_NO >= 1
	   THEN
	   UPN_EX1.UPN_GYOUSHA_CD
	   ELSE NULL
	   END AS UPN_GYOUSHA_CD1
    ,CASE
	   WHEN DTR19.UPN_ROUTE_NO >= 2
	   THEN
	   UPN_EX2.UPN_GYOUSHA_CD
	   ELSE NULL
	   END AS UPN_GYOUSHA_CD2
    ,CASE
	   WHEN DTR19.UPN_ROUTE_NO >= 3
	   THEN
	   UPN_EX3.UPN_GYOUSHA_CD 
	   ELSE NULL 
	   END AS UPN_GYOUSHA_CD3
	 ,CASE 
	   WHEN UPN1.UPNSAKI_JOU_KBN = 1 AND DTR19.UPN_ROUTE_NO > 1
	   THEN 
	   UPN_EX1.UPNSAKI_GYOUSHA_CD 
	   ELSE
	   NULL END AS UPN_SAKI_GYOUSHA_CD1
	 ,CASE 
	   WHEN UPN1.UPNSAKI_JOU_KBN = 1 AND DTR19.UPN_ROUTE_NO > 1
	   THEN
	   UPN_EX1.UPNSAKI_GENBA_CD 
	   ELSE
	   NULL END AS UPN_SAKI_GENBA_CD1
	 ,CASE 
	   WHEN UPN2.UPNSAKI_JOU_KBN = 1 AND DTR19.UPN_ROUTE_NO > 2
	   THEN 
	   UPN_EX2.UPNSAKI_GYOUSHA_CD  
	   ELSE
	   NULL END AS UPN_SAKI_GYOUSHA_CD2
	 ,CASE 
	   WHEN UPN2.UPNSAKI_JOU_KBN = 2 AND DTR19.UPN_ROUTE_NO > 2
	   THEN
	   UPN_EX2.UPNSAKI_GENBA_CD 
	   ELSE
	   NULL END AS UPN_SAKI_GENBA_CD2
    ,DTR18.HIKIWATASHI_DATE AS KOUFU_DATE

FROM
    DT_MF_TOC DMT
    INNER JOIN (
            SELECT
                R18.KANRI_ID
                ,R18.SEQ
                ,R18.MANIFEST_ID
                ,R18.HIKIWATASHI_DATE
                ,R18.SBN_END_DATE
                ,R18.MANIFEST_KBN
                ,R18.FIRST_MANIFEST_FLAG
                ,EX.HST_GYOUSHA_CD
                ,EX.HST_GENBA_CD
                ,EX.SBN_GYOUSHA_CD
                ,EX.SBN_GENBA_CD
                ,(CASE WHEN MIX.DETAIL_SYSTEM_ID IS NOT NULL THEN MIX.DETAIL_SYSTEM_ID ELSE EX.SYSTEM_ID END) AS SYSTEM_ID
                ,(CASE WHEN MIX.DETAIL_SYSTEM_ID IS NOT NULL THEN MIX.SBN_HOUHOU_CD ELSE EX.SBN_HOUHOU_CD END) AS SBN_HOUHOU_CD
                ,(CASE WHEN MIX.DETAIL_SYSTEM_ID IS NOT NULL THEN MIX.KANSAN_SUU ELSE EX.KANSAN_SUU END) AS KANSAN_SUU
                ,(CASE WHEN MIX.DETAIL_SYSTEM_ID IS NOT NULL THEN MIX.GENNYOU_SUU ELSE EX.GENNYOU_SUU END) AS GENNYOU_SUU
                ,(CASE WHEN MIX.DETAIL_SYSTEM_ID IS NOT NULL THEN MIX.HAIKI_DAI_CODE ELSE R18.HAIKI_DAI_CODE END) AS HAIKI_DAI_CODE
                ,(CASE WHEN MIX.DETAIL_SYSTEM_ID IS NOT NULL THEN MIX.HAIKI_CHU_CODE ELSE R18.HAIKI_CHU_CODE END) AS HAIKI_CHU_CODE
                ,(CASE WHEN MIX.DETAIL_SYSTEM_ID IS NOT NULL THEN MIX.HAIKI_SHO_CODE ELSE R18.HAIKI_SHO_CODE END) AS HAIKI_SHO_CODE
                ,(CASE WHEN MIX.DETAIL_SYSTEM_ID IS NOT NULL THEN MIX.SBN_ENDREP_KBN ELSE R18.SBN_ENDREP_KBN END) AS SBN_ENDREP_KBN
				,(CASE WHEN MIX.DETAIL_SYSTEM_ID IS NOT NULL THEN MIX_HAIKI_SHURUI.HAIKI_SHURUI_NAME ELSE R18.HAIKI_SHURUI END) AS HAIKI_SHURUI_NAME
            FROM DT_R18 AS R18
            LEFT JOIN DT_R18_EX AS EX
            ON R18.KANRI_ID = EX.KANRI_ID AND EX.DELETE_FLG = 0
            LEFT JOIN DT_R18_MIX AS MIX
            ON EX.SYSTEM_ID = MIX.SYSTEM_ID AND MIX.DELETE_FLG = 0
            LEFT JOIN M_DENSHI_HAIKI_SHURUI AS MIX_HAIKI_SHURUI
            ON (MIX.HAIKI_DAI_CODE + MIX.HAIKI_CHU_CODE + MIX.HAIKI_SHO_CODE) = MIX_HAIKI_SHURUI.HAIKI_SHURUI_CD
        ) AS DTR18
        ON DMT.KANRI_ID = DTR18.KANRI_ID AND DMT.LATEST_SEQ = DTR18.SEQ
    LEFT JOIN DT_R19 DTR19 ON DTR19.KANRI_ID = DTR18.KANRI_ID AND DTR19.SEQ = DTR18.SEQ AND DTR19.UPN_ROUTE_NO = (SELECT  MAX(UPN_ROUTE_NO) FROM DT_R19 WHERE KANRI_ID = DTR19.KANRI_ID AND SEQ = DTR19.SEQ)
    LEFT JOIN DT_R19_EX DTR19EX ON DTR19EX.KANRI_ID = DTR19.KANRI_ID AND DTR19EX.UPN_ROUTE_NO = DTR19.UPN_ROUTE_NO AND DTR19EX.DELETE_FLG = 0
    LEFT JOIN DT_R13 DTR13 ON DTR13.KANRI_ID = DTR18.KANRI_ID AND DTR13.SEQ = DTR18.SEQ
    LEFT JOIN DT_R13_EX DTR13EX ON DTR13EX.KANRI_ID = DTR13.KANRI_ID AND DTR13EX.REC_SEQ = DTR13.REC_SEQ AND DTR13EX.DELETE_FLG = 0
    LEFT JOIN M_GENBA HSTMGA ON HSTMGA.GENBA_CD = DTR18.HST_GENBA_CD AND HSTMGA.GYOUSHA_CD = DTR18.HST_GYOUSHA_CD
    LEFT JOIN M_GENBA SBNMGA ON SBNMGA.GYOUSHA_CD = DTR18.SBN_GYOUSHA_CD AND SBNMGA.GENBA_CD = DTR18.SBN_GENBA_CD

    LEFT JOIN T_MANIFEST_RELATION TMR ON  TMR.FIRST_SYSTEM_ID = DTR18.SYSTEM_ID AND TMR.FIRST_HAIKI_KBN_CD = 4 AND TMR.DELETE_FLG = 0
    LEFT JOIN ( SELECT
					MENTRY.*, MDETAIL.DETAIL_SYSTEM_ID
				FROM
					T_MANIFEST_ENTRY AS MENTRY
					INNER JOIN T_MANIFEST_DETAIL AS MDETAIL 
						ON MDETAIL.SYSTEM_ID = MENTRY.SYSTEM_ID
						AND MENTRY.SEQ = MDETAIL.SEQ
				) AS NEXT_TME ON NEXT_TME.DETAIL_SYSTEM_ID = TMR.NEXT_SYSTEM_ID AND NEXT_TME.DELETE_FLG = 0 AND TMR.NEXT_HAIKI_KBN_CD != 4
    LEFT JOIN (SELECT TMU1.* FROM T_MANIFEST_ENTRY TME1 INNER JOIN T_MANIFEST_UPN TMU1 ON TMU1.SYSTEM_ID = TME1.SYSTEM_ID AND TMU1.SEQ = TME1.SEQ AND TMU1.UPN_ROUTE_NO = 1 WHERE (TME1.HAIKI_KBN_CD = 1 OR TME1.HAIKI_KBN_CD = 2) AND TME1.DELETE_FLG =0 AND TME1.SEQ = (SELECT MAX(SEQ) FROM T_MANIFEST_ENTRY WHERE SYSTEM_ID = TME1.SYSTEM_ID)
               UNION
               SELECT TMU2.* FROM T_MANIFEST_ENTRY TME2 INNER JOIN T_MANIFEST_UPN TMU2 ON TMU2.SYSTEM_ID = TME2.SYSTEM_ID AND TMU2.SEQ = TME2.SEQ AND TME2.HAIKI_KBN_CD = 3  AND TMU2.UPN_ROUTE_NO = (
                                                                                  SELECT MIN(UPN_ROUTE_NO) FROM T_MANIFEST_UPN WHERE TME2.SYSTEM_ID = SYSTEM_ID AND SEQ = TME2.SEQ AND TME2.HAIKI_KBN_CD = 3 AND UPN_SAKI_KBN = 1) AND TME2.DELETE_FLG = 0 ) NEXT_TMU ON NEXT_TMU.SYSTEM_ID = NEXT_TME.SYSTEM_ID AND NEXT_TMU.SEQ = NEXT_TME.SEQ AND TMR.NEXT_HAIKI_KBN_CD != 4
    LEFT JOIN M_GENBA NEXT_ITAMGA ON NEXT_ITAMGA.GYOUSHA_CD = NEXT_TMU.UPN_SAKI_GYOUSHA_CD AND NEXT_ITAMGA.GENBA_CD = NEXT_TMU.UPN_SAKI_GENBA_CD AND TMR.NEXT_HAIKI_KBN_CD != 4
    LEFT JOIN M_CHIIKIBETSU_KYOKA NEXT_MCK ON NEXT_MCK.GYOUSHA_CD = NEXT_TMU.UPN_SAKI_GYOUSHA_CD AND NEXT_MCK.GENBA_CD = NEXT_TMU.UPN_SAKI_GENBA_CD AND TMR.NEXT_HAIKI_KBN_CD != 4 AND NEXT_MCK.KYOKA_KBN = 3 AND NEXT_MCK.CHIIKI_CD = NEXT_ITAMGA.CHIIKI_CD

    LEFT JOIN DT_R18_EX NEXT_DTR18EX ON NEXT_DTR18EX.SYSTEM_ID = TMR.NEXT_SYSTEM_ID AND NEXT_DTR18EX.DELETE_FLG = 0 AND TMR.NEXT_HAIKI_KBN_CD = 4
    LEFT JOIN DT_MF_TOC NEXT_DMT ON NEXT_DTR18EX.KANRI_ID = NEXT_DMT.KANRI_ID
    LEFT JOIN DT_R18 NEXT_DTR18 ON NEXT_DTR18.KANRI_ID = NEXT_DTR18EX.KANRI_ID AND NEXT_DMT.LATEST_SEQ = NEXT_DTR18.SEQ
    LEFT JOIN DT_R19_EX NEXT_DTR19EX ON NEXT_DTR19EX.SYSTEM_ID = TMR.NEXT_SYSTEM_ID AND NEXT_DTR19EX.DELETE_FLG = 0 AND TMR.NEXT_HAIKI_KBN_CD = 4
    LEFT JOIN DT_R19 NEXT_DTR19 ON NEXT_DTR19.KANRI_ID = NEXT_DTR19EX.KANRI_ID AND NEXT_DTR19.SEQ = NEXT_DTR19EX.SEQ AND TMR.NEXT_HAIKI_KBN_CD = 4
    LEFT JOIN M_GENBA NEXT_DEN_ITAMGA ON NEXT_DEN_ITAMGA.GYOUSHA_CD = NEXT_DTR19EX.UPNSAKI_GYOUSHA_CD AND NEXT_DEN_ITAMGA.GENBA_CD = NEXT_DTR19EX.UPNSAKI_GENBA_CD AND TMR.NEXT_HAIKI_KBN_CD = 4
    LEFT JOIN M_CHIIKIBETSU_KYOKA NEXT_DEN_MCK ON NEXT_DEN_MCK.GYOUSHA_CD = NEXT_DTR19EX.UPNSAKI_GYOUSHA_CD AND NEXT_DEN_MCK.GENBA_CD = NEXT_DTR19EX.UPNSAKI_GENBA_CD AND TMR.NEXT_HAIKI_KBN_CD = 4 AND NEXT_DEN_MCK.KYOKA_KBN = 3 AND NEXT_DEN_MCK.CHIIKI_CD = NEXT_DEN_ITAMGA.CHIIKI_CD
    LEFT JOIN M_DENSHI_HAIKI_SHURUI NEXT_MDHS ON NEXT_MDHS.HAIKI_SHURUI_CD = (NEXT_DTR18.HAIKI_DAI_CODE + NEXT_DTR18.HAIKI_CHU_CODE + NEXT_DTR18.HAIKI_SHO_CODE)
    LEFT JOIN M_CHIIKIBETSU_BUNRUI NEXT_D_MCB ON NEXT_D_MCB.CHIIKI_CD = /*data.TEISHUTSU_CHIIKI_CD*/0 AND NEXT_D_MCB.HOUKOKUSHO_BUNRUI_CD = NEXT_MDHS.HOUKOKUSHO_BUNRUI_CD
	LEFT JOIN M_CHIIKIBETSU_SHOBUN NEXT_D_CBS ON NEXT_D_CBS.CHIIKI_CD = /*data.TEISHUTSU_CHIIKI_CD*/0 AND NEXT_D_CBS.SHOBUN_HOUHOU_CD = NEXT_DTR18EX.SBN_HOUHOU_CD

    LEFT JOIN M_CHIIKI NEXT_DEN_ITAMC ON NEXT_DEN_ITAMC.CHIIKI_CD = NEXT_DEN_ITAMGA.CHIIKI_CD AND TMR.NEXT_HAIKI_KBN_CD = 4
    LEFT JOIN M_TODOUFUKEN NEXT_DEN_ITAMT ON NEXT_DEN_ITAMT.TODOUFUKEN_CD = NEXT_DEN_ITAMC.TODOUFUKEN_CD AND TMR.NEXT_HAIKI_KBN_CD = 4 
    LEFT JOIN M_DENSHI_HAIKI_SHURUI MDHS ON MDHS.HAIKI_SHURUI_CD = (DTR18.HAIKI_DAI_CODE + DTR18.HAIKI_CHU_CODE + DTR18.HAIKI_SHO_CODE)
    LEFT JOIN M_CHIIKIBETSU_BUNRUI MCB ON MCB.CHIIKI_CD = /*data.TEISHUTSU_CHIIKI_CD*/0 AND MCB.HOUKOKUSHO_BUNRUI_CD = MDHS.HOUKOKUSHO_BUNRUI_CD
    LEFT JOIN M_CHIIKIBETSU_KYOKA MCK ON MCK.GYOUSHA_CD = DTR18.HST_GYOUSHA_CD AND MCK.GENBA_CD = DTR18.HST_GENBA_CD 
    /*IF data.GYOUSHA_KBN.Value == 1*/
      AND MCK.KYOKA_KBN =2 AND MCK.CHIIKI_CD = /*data.TEISHUTSU_CHIIKI_CD*/0
    /*END*/
    /*IF data.GYOUSHA_KBN.Value == 2*/
      AND MCK.KYOKA_KBN =3 AND MCK.CHIIKI_CD = /*data.TEISHUTSU_CHIIKI_CD*/0
    /*END*/
    LEFT JOIN M_GYOUSHA HSTMGS ON HSTMGS.GYOUSHA_CD = DTR18.HST_GYOUSHA_CD
    LEFT JOIN M_CHIIKI HSTMGSMCK ON HSTMGSMCK.CHIIKI_CD = HSTMGS.CHIIKI_CD
    LEFT JOIN M_TODOUFUKEN HSTMGSMT ON HSTMGSMT.TODOUFUKEN_CD = HSTMGSMCK.TODOUFUKEN_CD
    
    LEFT JOIN M_CHIIKI HSTMGAMCK ON HSTMGAMCK.CHIIKI_CD = HSTMGA.CHIIKI_CD
    LEFT JOIN M_TODOUFUKEN HSTMGAMT ON HSTMGAMT.TODOUFUKEN_CD = HSTMGAMCK.TODOUFUKEN_CD
    
    LEFT JOIN M_UNIT MU ON MU.UNIT_CD = (SELECT MANI_KANSAN_KIHON_UNIT_CD FROM M_SYS_INFO)  
    LEFT JOIN M_CHIIKIBETSU_SHOBUN MCH ON MCH.SHOBUN_HOUHOU_CD = DTR18.SBN_HOUHOU_CD AND MCH.CHIIKI_CD = /*data.TEISHUTSU_CHIIKI_CD*/0
    
    LEFT JOIN M_GYOUSHA SBNMGS ON SBNMGS.GYOUSHA_CD = DTR18.SBN_GYOUSHA_CD
    LEFT JOIN M_CHIIKI SBNMGSMCK ON SBNMGSMCK.CHIIKI_CD = SBNMGS.CHIIKI_CD
    LEFT JOIN M_TODOUFUKEN SBNMGSMT ON SBNMGSMT.TODOUFUKEN_CD = SBNMGSMCK.TODOUFUKEN_CD
    
    LEFT JOIN M_GENBA TMUMGA ON TMUMGA.GYOUSHA_CD = DTR18.SBN_GYOUSHA_CD AND TMUMGA.GENBA_CD = DTR18.SBN_GENBA_CD
    LEFT JOIN M_CHIIKI TMUMC ON TMUMC.CHIIKI_CD = TMUMGA.CHIIKI_CD
    LEFT JOIN M_TODOUFUKEN TMUMT ON TMUMT.TODOUFUKEN_CD = TMUMC.TODOUFUKEN_CD
    LEFT JOIN DT_R19 UPN1 ON UPN1.KANRI_ID = DTR18.KANRI_ID AND  UPN1.UPN_ROUTE_NO = 1 AND UPN1.SEQ = DTR18.SEQ
    LEFT JOIN DT_R19 UPN2 ON UPN2.KANRI_ID = DTR18.KANRI_ID AND  UPN2.UPN_ROUTE_NO = 2 AND UPN2.SEQ = DTR18.SEQ
    LEFT JOIN DT_R19 UPN3 ON UPN3.KANRI_ID = DTR18.KANRI_ID AND  UPN3.UPN_ROUTE_NO = 3 AND UPN3.SEQ = DTR18.SEQ
    LEFT JOIN DT_R19_EX UPN_EX1 ON UPN_EX1.KANRI_ID = UPN1.KANRI_ID AND UPN_EX1.UPN_ROUTE_NO = 1 AND UPN_EX1.DELETE_FLG = 0
    LEFT JOIN DT_R19_EX UPN_EX2 ON UPN_EX2.KANRI_ID = UPN2.KANRI_ID AND UPN_EX2.UPN_ROUTE_NO = 2 AND UPN_EX2.DELETE_FLG = 0
    LEFT JOIN DT_R19_EX UPN_EX3 ON UPN_EX3.KANRI_ID = UPN3.KANRI_ID AND UPN_EX3.UPN_ROUTE_NO = 3 AND UPN_EX3.DELETE_FLG = 0
    LEFT JOIN T_MANIFEST_UPN T_MANIFEST_UPN_NEXT1 ON T_MANIFEST_UPN_NEXT1.SYSTEM_ID = NEXT_TME.SYSTEM_ID AND T_MANIFEST_UPN_NEXT1.SEQ = NEXT_TME.SEQ AND T_MANIFEST_UPN_NEXT1.UPN_ROUTE_NO = 1 AND TMR.NEXT_HAIKI_KBN_CD != 4 
    LEFT JOIN T_MANIFEST_UPN T_MANIFEST_UPN_NEXT2 ON T_MANIFEST_UPN_NEXT2.SYSTEM_ID = NEXT_TME.SYSTEM_ID AND T_MANIFEST_UPN_NEXT2.SEQ = NEXT_TME.SEQ AND T_MANIFEST_UPN_NEXT2.UPN_ROUTE_NO = 2 AND TMR.NEXT_HAIKI_KBN_CD != 4
    LEFT JOIN T_MANIFEST_UPN T_MANIFEST_UPN_NEXT3 ON T_MANIFEST_UPN_NEXT3.SYSTEM_ID = NEXT_TME.SYSTEM_ID AND T_MANIFEST_UPN_NEXT3.SEQ = NEXT_TME.SEQ AND T_MANIFEST_UPN_NEXT3.UPN_ROUTE_NO = 3 AND TMR.NEXT_HAIKI_KBN_CD != 4
    LEFT JOIN T_MANIFEST_DETAIL TMD_NEXT ON TMD_NEXT.SYSTEM_ID = NEXT_TME.SYSTEM_ID AND TMD_NEXT.SEQ = NEXT_TME.SEQ AND TMD_NEXT.DETAIL_SYSTEM_ID = NEXT_TME.DETAIL_SYSTEM_ID AND TMR.NEXT_HAIKI_KBN_CD != 4 
    LEFT JOIN M_HAIKI_SHURUI MHS_NEXT ON MHS_NEXT.HAIKI_KBN_CD = NEXT_TME.HAIKI_KBN_CD AND MHS_NEXT.HAIKI_SHURUI_CD = TMD_NEXT.HAIKI_SHURUI_CD
    LEFT JOIN M_CHIIKIBETSU_BUNRUI MCB_NEXT ON MCB_NEXT.CHIIKI_CD = /*data.TEISHUTSU_CHIIKI_CD*/0 AND MCB_NEXT.HOUKOKUSHO_BUNRUI_CD = MHS_NEXT.HOUKOKUSHO_BUNRUI_CD 
	LEFT JOIN M_CHIIKIBETSU_SHOBUN MCS_NEXT ON MCS_NEXT.CHIIKI_CD = /*data.TEISHUTSU_CHIIKI_CD*/0 AND MCS_NEXT.SHOBUN_HOUHOU_CD = TMD_NEXT.SBN_HOUHOU_CD
    LEFT JOIN DT_R19 NEXT_UPN1
           ON NEXT_DTR18EX.KANRI_ID         = NEXT_UPN1.KANRI_ID
          AND NEXT_DTR18EX.SEQ              = NEXT_UPN1.SEQ
	      AND NEXT_UPN1.UPN_ROUTE_NO    = 1
          AND TMR.NEXT_HAIKI_KBN_CD = 4 
	LEFT JOIN DT_R19_EX NEXT_UPN_EX1
		   ON NEXT_UPN1.KANRI_ID     = NEXT_UPN_EX1.KANRI_ID
		  AND NEXT_DTR18EX.SYSTEM_ID            = NEXT_UPN_EX1.SYSTEM_ID
		  AND NEXT_DTR18EX.SEQ                  = NEXT_UPN_EX1.SEQ
		  AND NEXT_UPN1.UPN_ROUTE_NO = NEXT_UPN_EX1.UPN_ROUTE_NO
		  AND TMR.NEXT_HAIKI_KBN_CD = 4 
	       
	LEFT JOIN DT_R19 NEXT_UPN2
		   ON NEXT_DTR18EX.KANRI_ID         = NEXT_UPN2.KANRI_ID
		  AND NEXT_DTR18EX.SEQ              = NEXT_UPN2.SEQ
		  AND NEXT_UPN2.UPN_ROUTE_NO    = 2
		  AND TMR.NEXT_HAIKI_KBN_CD = 4 
	LEFT JOIN DT_R19_EX NEXT_UPN_EX2
		   ON NEXT_UPN2.KANRI_ID     = NEXT_UPN_EX2.KANRI_ID
		  AND NEXT_DTR18EX.SYSTEM_ID   = NEXT_UPN_EX2.SYSTEM_ID
		  AND NEXT_DTR18EX.SEQ         = NEXT_UPN_EX2.SEQ
		  AND NEXT_UPN2.UPN_ROUTE_NO = NEXT_UPN_EX2.UPN_ROUTE_NO
		  AND TMR.NEXT_HAIKI_KBN_CD = 4 
	       
	LEFT JOIN DT_R19 NEXT_UPN3
		   ON NEXT_DTR18EX.KANRI_ID         = NEXT_UPN3.KANRI_ID
		  AND NEXT_DTR18EX.SEQ              = NEXT_UPN3.SEQ
		  AND NEXT_UPN3.UPN_ROUTE_NO    = 3
		  AND TMR.NEXT_HAIKI_KBN_CD = 4 
	LEFT JOIN DT_R19_EX NEXT_UPN_EX3
		   ON NEXT_UPN3.KANRI_ID     = NEXT_UPN_EX3.KANRI_ID
		  AND NEXT_DTR18EX.SYSTEM_ID   = NEXT_UPN_EX3.SYSTEM_ID
		  AND NEXT_DTR18EX.SEQ         = NEXT_UPN_EX3.SEQ
		  AND NEXT_UPN3.UPN_ROUTE_NO = NEXT_UPN_EX3.UPN_ROUTE_NO
		  AND TMR.NEXT_HAIKI_KBN_CD = 4 
	       
	LEFT JOIN DT_R19 NEXT_UPN4
		   ON NEXT_DTR18EX.KANRI_ID         = NEXT_UPN4.KANRI_ID
		  AND NEXT_DTR18EX.SEQ              = NEXT_UPN4.SEQ
		  AND NEXT_UPN4.UPN_ROUTE_NO    = 4
		  AND TMR.NEXT_HAIKI_KBN_CD = 4 
	LEFT JOIN DT_R19_EX NEXT_UPN_EX4
		   ON NEXT_UPN4.KANRI_ID     = NEXT_UPN_EX4.KANRI_ID
		  AND NEXT_DTR18EX.SYSTEM_ID   = NEXT_UPN_EX4.SYSTEM_ID
		  AND NEXT_DTR18EX.SEQ         = NEXT_UPN_EX4.SEQ
		  AND NEXT_UPN4.UPN_ROUTE_NO = NEXT_UPN_EX4.UPN_ROUTE_NO
		  AND TMR.NEXT_HAIKI_KBN_CD = 4 
	       
	LEFT JOIN DT_R19 NEXT_UPN5
		   ON NEXT_DTR18EX.KANRI_ID         = NEXT_UPN5.KANRI_ID
		  AND NEXT_DTR18EX.SEQ              = NEXT_UPN5.SEQ
		  AND NEXT_UPN5.UPN_ROUTE_NO    = 5
		  AND TMR.NEXT_HAIKI_KBN_CD = 4 
	LEFT JOIN DT_R19_EX NEXT_UPN_EX5
		   ON NEXT_UPN5.KANRI_ID     = NEXT_UPN_EX5.KANRI_ID
		  AND NEXT_DTR18EX.SYSTEM_ID   = NEXT_UPN_EX5.SYSTEM_ID
		  AND NEXT_DTR18EX.SEQ         = NEXT_UPN_EX5.SEQ
		  AND NEXT_UPN5.UPN_ROUTE_NO = NEXT_UPN_EX5.UPN_ROUTE_NO
		  AND TMR.NEXT_HAIKI_KBN_CD = 4 

WHERE 1=1

    /*IF data.GYOUSHA_KBN.Value == 1*/
	  /*IF data.JIGYOUJOU_KBN.Value == 1*/
	    AND DTR18.SBN_END_DATE IS NOT NULL
		AND (DTR18.SBN_END_DATE <= CONVERT(DATETIME, CONVERT(NVARCHAR, /*data.DATE_END.Value*/20140901, 111), 120) AND CONVERT(DATETIME, CONVERT(NVARCHAR, /*data.DATE_BEGIN.Value*/20100901, 111), 120) <= DTR18.SBN_END_DATE)
		AND DTR18.MANIFEST_KBN = 2
		AND (ISNULL(DTR18.FIRST_MANIFEST_FLAG,'') = '' OR ISNULL(HSTMGS.JISHA_KBN, 0) = 0)
		AND DTR18.SBN_GYOUSHA_CD = /*data.HOUKOKU_GYOUSHA_CD*/0
		AND DTR18.SBN_GENBA_CD = /*data.HOUKOKU_GENBA_CD*/0
		/*IF data.KEN_KBN.Value == 1*/
			AND HSTMGA.CHIIKI_CD = SBNMGA.CHIIKI_CD
		/*END*/
		/*IF data.KEN_KBN.Value == 2*/
			AND HSTMGA.CHIIKI_CD != SBNMGA.CHIIKI_CD
		/*END*/
	  /*END*/
	  /*IF data.JIGYOUJOU_KBN.Value == 2*/
		AND DTR18.MANIFEST_KBN = 2
	    AND ((
		     DTR13.LAST_SBN_END_DATE IS NOT NULL
			 AND DTR18.SBN_ENDREP_KBN=1
		     AND (ISNULL(DTR18.FIRST_MANIFEST_FLAG,'') = '' OR ISNULL(HSTMGS.JISHA_KBN, 0) = 0)
		     AND (DTR13.LAST_SBN_END_DATE <= CONVERT(DATETIME, CONVERT(NVARCHAR, /*data.DATE_END.Value*/20140901, 111), 120) AND CONVERT(DATETIME, CONVERT(NVARCHAR, /*data.DATE_BEGIN.Value*/20100901, 111), 120) <= DTR13.LAST_SBN_END_DATE)
			 AND TMR.NEXT_SYSTEM_ID IS NULL
			 AND DTR13EX.LAST_SBN_GYOUSHA_CD = /*data.HOUKOKU_GYOUSHA_CD*/0
		     AND DTR13EX.LAST_SBN_GENBA_CD = /*data.HOUKOKU_GENBA_CD*/0)
		   OR (
		     DTR18.SBN_END_DATE IS NOT NULL
			 AND DTR18.SBN_ENDREP_KBN=2
		     AND (DTR18.SBN_END_DATE <= CONVERT(DATETIME, CONVERT(NVARCHAR, /*data.DATE_END.Value*/20140901, 111), 120) AND CONVERT(DATETIME, CONVERT(NVARCHAR, /*data.DATE_BEGIN.Value*/20100901, 111), 120) <= DTR18.SBN_END_DATE)
		     AND TMR.NEXT_SYSTEM_ID IS NOT NULL
			 AND DTR18.SBN_GYOUSHA_CD = /*data.HOUKOKU_GYOUSHA_CD*/0
		     AND DTR18.SBN_GENBA_CD = /*data.HOUKOKU_GENBA_CD*/0
            ))
        /*IF data.KEN_KBN.Value == 1*/
			AND HSTMGA.CHIIKI_CD = TMUMGA.CHIIKI_CD
		/*END*/
		/*IF data.KEN_KBN.Value == 2*/
			AND HSTMGA.CHIIKI_CD != TMUMGA.CHIIKI_CD
		/*END*/
	  /*END*/
	/*END*/

	/*IF data.GYOUSHA_KBN.Value == 2*/
		/*IF data.JIGYOUJOU_KBN.Value == 1*/
		AND (DTR18.SBN_END_DATE <= CONVERT(DATETIME, CONVERT(NVARCHAR, /*data.DATE_END.Value*/20140901, 111), 120) AND CONVERT(DATETIME, CONVERT(NVARCHAR, /*data.DATE_BEGIN.Value*/20100901, 111), 120) <= DTR18.SBN_END_DATE)
		AND DTR18.SBN_END_DATE IS NOT NULL
		AND DTR18.MANIFEST_KBN = 2
		AND (ISNULL(DTR18.FIRST_MANIFEST_FLAG,'') <> '' AND ISNULL(HSTMGS.JISHA_KBN, 0) = 1)
		AND DTR18.SBN_GYOUSHA_CD = /*data.HOUKOKU_GYOUSHA_CD*/0
		AND DTR18.SBN_GENBA_CD = /*data.HOUKOKU_GENBA_CD*/0
		/*IF data.KEN_KBN.Value == 1*/
			AND HSTMGA.CHIIKI_CD = TMUMGA.CHIIKI_CD
		/*END*/
		/*IF data.KEN_KBN.Value == 2*/
			AND HSTMGA.CHIIKI_CD != TMUMGA.CHIIKI_CD
		/*END*/
	  /*END*/

	  /*IF data.JIGYOUJOU_KBN.Value == 2*/
	    AND 
		((DTR18.SBN_ENDREP_KBN=1 
		AND DTR13.LAST_SBN_END_DATE IS NOT NULL
		AND (DTR13.LAST_SBN_END_DATE <= CONVERT(DATETIME, CONVERT(NVARCHAR, /*data.DATE_END.Value*/20140901, 111), 120) AND CONVERT(DATETIME, CONVERT(NVARCHAR, /*data.DATE_BEGIN.Value*/20100901, 111), 120) <= DTR13.LAST_SBN_END_DATE)
		AND DTR13EX.LAST_SBN_GYOUSHA_CD = /*data.HOUKOKU_GYOUSHA_CD*/0
		AND DTR13EX.LAST_SBN_GYOUSHA_CD = /*data.HOUKOKU_GENBA_CD*/0
		AND (ISNULL(DTR18.FIRST_MANIFEST_FLAG,'') <> '' AND ISNULL(HSTMGS.JISHA_KBN, 0) = 1)
		)
		OR 
		(DTR18.SBN_ENDREP_KBN=2
		AND DTR18.SBN_END_DATE IS NOT NULL
		AND (DTR18.SBN_END_DATE <= CONVERT(DATETIME, CONVERT(NVARCHAR, /*data.DATE_END.Value*/20140901, 111), 120) AND CONVERT(DATETIME, CONVERT(NVARCHAR, /*data.DATE_BEGIN.Value*/20100901, 111), 120) <= DTR18.SBN_END_DATE)
		AND DTR18.SBN_GYOUSHA_CD = /*data.HOUKOKU_GYOUSHA_CD*/0
		AND DTR18.SBN_GENBA_CD = /*data.HOUKOKU_GENBA_CD*/0
		))
		AND DTR18.MANIFEST_KBN = 2
		/*IF data.KEN_KBN.Value == 1*/
			AND HSTMGA.CHIIKI_CD = TMUMGA.CHIIKI_CD
		/*END*/
		/*IF data.KEN_KBN.Value == 2*/
			AND HSTMGA.CHIIKI_CD != TMUMGA.CHIIKI_CD
		/*END*/
      /*END*/
	/*END*/
	/*IF data.TOKUBETSU_KANRI_KBN.Value == 1*/
	AND (DTR18.HAIKI_DAI_CODE + DTR18.HAIKI_CHU_CODE + DTR18.HAIKI_SHO_CODE) BETWEEN '0000' AND '6999'
	/*END*/

	/*IF data.TOKUBETSU_KANRI_KBN.Value == 2*/
	AND (DTR18.HAIKI_DAI_CODE + DTR18.HAIKI_CHU_CODE + DTR18.HAIKI_SHO_CODE) BETWEEN '7000' AND '9999'
	/*END*/
/*END*/
) ,
MANICSV AS
(
SELECT 
--排出業者
MANI.HOUKOKUSHO_BUNRUI_CD   AS HOUKOKUSHO_BUNRUI_CD,
MANI.HOUKOKUSHO_BUNRUI_NAME AS HOUKOKUSHO_BUNRUI_NAME,
CASE MCB.SEKIMEN_KBN
    WHEN 0 THEN '×'
    WHEN 1 THEN '〇'
    ELSE NULL
END AS SEKIMEN_KBN,
CASE MCB.TOKUTEI_YUUGAI_KBN
    WHEN 0 THEN '×'
    WHEN 1 THEN '〇'
    ELSE NULL
END AS TOKUTEI_YUUGAI_KBN,
--MANI.KANSAN_SUU        AS JYUTAKU_RYOU,
MANI.GENYOU_SUU        AS JYUTAKU_RYOU,
MANI.JYUTAKU_UNIT_NAME      AS UNIT_NAME,
MANI.HST_GYOUSHA_CD         AS HST_GYOUSHA_CD,
MANI.HST_GYOUSHA_NAME         AS HST_GYOUSHA_NAME,
MANI.HST_GYOUSHA_ADDRESS         AS HST_GYOUSHA_ADDRESS,
HST_GYOUSHA_CHIIKI.CHIIKI_CD         AS CHIIKI_CD2,
HST_GYOUSHA_CHIIKI.CHIIKI_NAME           AS HST_GYOUSHA_CHIIKI_NAME,
FOR_GYOUSHU_HST.HOUKOKU_GYOUSHU_CD  AS HST_GYOUSHA_GYOUSHU_CD,
FOR_GYOUSHU_HST.HOUKOKU_GYOUSHU_NAME  AS HST_GYOUSHU_NAME,
MANI.HST_GENBA_CD           AS HST_GENBA_CD,
MANI.HST_GENBA_NAME         AS HST_GENBA_NAME,
MANI.HST_GENBA_ADDRESS      AS HST_GENBA_ADDRESS,
MANI.HST_GENBA_CHIIKI_CD    AS HST_GENBA_CHIIKI_CD,
HST_GENBA_CHIIKI.CHIIKI_NAME           AS HST_GENBA_CHIIKI_NAME,
FOR_GYOUSHU_HST_GENBA.HOUKOKU_GYOUSHU_CD       AS HST_GENBA_GYOUSHU_CD,
FOR_GYOUSHU_HST_GENBA.HOUKOKU_GYOUSHU_NAME     AS HST_GENBA_GYOUSHU_NAME,

--運搬受託者（一次）運搬受託者(1)
MANI.UPN_GYOUSHA_CD1        AS UPN_GYOUSHA_CD1,
M_GYOUSHA1.GYOUSHA_NAME1 + M_GYOUSHA1.GYOUSHA_NAME2 AS UPN_GYOUSHA_NAME1,
/*IF data.ADDRESS_KBN.Value == 1*/
FOR_TODOUFUKEN1.TODOUFUKEN_NAME + M_GYOUSHA1.GYOUSHA_ADDRESS1 + M_GYOUSHA1.GYOUSHA_ADDRESS2
/*END*/
/*IF data.ADDRESS_KBN.Value == 2*/
M_GYOUSHA1.GYOUSHA_ADDRESS1 + M_GYOUSHA1.GYOUSHA_ADDRESS2
/*END*/
/*IF data.ADDRESS_KBN.Value == 3*/
FOR_TODOUFUKEN1.TODOUFUKEN_NAME + M_GYOUSHA1.GYOUSHA_ADDRESS1
/*END*/
AS UPN_GYOUSHA_ADDRESS1,
M_GYOUSHA1.CHIIKI_CD                                       AS UPN_GYOUSHA_CHIIKI_CD1,
FOR_GYOUSHA1.CHIIKI_NAME                                  AS UPN_GYOUSHA_CHIIKI_NAME1,
FOR_GYOUSHU1.HOUKOKU_GYOUSHU_CD                                   AS UPN_GYOUSHA_GYOUSHU_CD1,
FOR_GYOUSHU1.HOUKOKU_GYOUSHU_NAME                               AS UPN_GYOUSHA_GYOUSHU_NAME1,
--運搬受託者（一次）運搬受託者(2)
MANI.UPN_GYOUSHA_CD2        AS UPN_GYOUSHA_CD2,
M_GYOUSHA2.GYOUSHA_NAME1 + M_GYOUSHA2.GYOUSHA_NAME2 AS UPN_GYOUSHA_NAME2,
/*IF data.ADDRESS_KBN.Value == 1*/
FOR_TODOUFUKEN2.TODOUFUKEN_NAME + M_GYOUSHA2.GYOUSHA_ADDRESS1 + M_GYOUSHA2.GYOUSHA_ADDRESS2
/*END*/
/*IF data.ADDRESS_KBN.Value == 2*/
M_GYOUSHA2.GYOUSHA_ADDRESS1 + M_GYOUSHA2.GYOUSHA_ADDRESS2
/*END*/
/*IF data.ADDRESS_KBN.Value == 3*/
FOR_TODOUFUKEN2.TODOUFUKEN_NAME + M_GYOUSHA2.GYOUSHA_ADDRESS1
/*END*/
 AS UPN_GYOUSHA_ADDRESS2,
M_GYOUSHA2.CHIIKI_CD                                       AS UPN_GYOUSHA_CHIIKI_CD2,
FOR_GYOUSHA2.CHIIKI_NAME                                  AS UPN_GYOUSHA_CHIIKI_NAME2,
FOR_GYOUSHU2.HOUKOKU_GYOUSHU_CD                                   AS UPN_GYOUSHA_GYOUSHU_CD2,
FOR_GYOUSHU2.HOUKOKU_GYOUSHU_NAME                               AS UPN_GYOUSHA_GYOUSHU_NAME2,
--運搬受託者（一次）運搬受託者(3)
MANI.UPN_GYOUSHA_CD3        AS UPN_GYOUSHA_CD3,
M_GYOUSHA3.GYOUSHA_NAME1 + M_GYOUSHA3.GYOUSHA_NAME2 AS UPN_GYOUSHA_NAME3,
/*IF data.ADDRESS_KBN.Value == 1*/
FOR_TODOUFUKEN3.TODOUFUKEN_NAME + M_GYOUSHA3.GYOUSHA_ADDRESS1 + M_GYOUSHA3.GYOUSHA_ADDRESS2
/*END*/
/*IF data.ADDRESS_KBN.Value == 2*/
M_GYOUSHA3.GYOUSHA_ADDRESS1 + M_GYOUSHA3.GYOUSHA_ADDRESS2
/*END*/
/*IF data.ADDRESS_KBN.Value == 3*/
FOR_TODOUFUKEN3.TODOUFUKEN_NAME + M_GYOUSHA3.GYOUSHA_ADDRESS1
/*END*/
AS UPN_GYOUSHA_ADDRESS3,
M_GYOUSHA3.CHIIKI_CD                                       AS UPN_GYOUSHA_CHIIKI_CD3,
FOR_GYOUSHA3.CHIIKI_NAME                                  AS UPN_GYOUSHA_CHIIKI_NAME3,
FOR_GYOUSHU3.HOUKOKU_GYOUSHU_CD                                   AS UPN_GYOUSHA_GYOUSHU_CD3,
FOR_GYOUSHU3.HOUKOKU_GYOUSHU_NAME                               AS UPN_GYOUSHA_GYOUSHU_NAME3,
--運搬受託者（二次）運搬受託者(1)
MANI.UPN_GYOUSHA_CD1_NEXT        AS UPN_GYOUSHA_NEXT_CD1,
M_GYOUSHA_NEXT1.GYOUSHA_NAME1 + M_GYOUSHA_NEXT1.GYOUSHA_NAME2 AS UPN_GYOUSHA_NAME_NEXT1,
/*IF data.ADDRESS_KBN.Value == 1*/
FOR_TODOUFUKEN_NEXT1.TODOUFUKEN_NAME + M_GYOUSHA_NEXT1.GYOUSHA_ADDRESS1 + M_GYOUSHA_NEXT1.GYOUSHA_ADDRESS2
/*END*/
/*IF data.ADDRESS_KBN.Value == 2*/
M_GYOUSHA_NEXT1.GYOUSHA_ADDRESS1 + M_GYOUSHA_NEXT1.GYOUSHA_ADDRESS2
/*END*/
/*IF data.ADDRESS_KBN.Value == 3*/
FOR_TODOUFUKEN_NEXT1.TODOUFUKEN_NAME + M_GYOUSHA_NEXT1.GYOUSHA_ADDRESS1 
/*END*/
AS UPN_GYOUSHA_ADDRESS_NEXT1,
M_GYOUSHA_NEXT1.CHIIKI_CD                                       AS UPN_GYOUSHA_CHIIKI_CD_NEXT1,
FOR_GYOUSHA_NEXT1.CHIIKI_NAME                                  AS UPN_GYOUSHA_CHIIKI_NAME_NEXT1,
FOR_GYOUSHU_NEXT1.HOUKOKU_GYOUSHU_CD                                   AS UPN_GYOUSHA_GYOUSHU_CD_NEXT1,
FOR_GYOUSHU_NEXT1.HOUKOKU_GYOUSHU_NAME                               AS UPN_GYOUSHA_GYOUSHU_NAME_NEXT1,
--運搬受託者（二次）運搬受託者(2)
MANI.UPN_GYOUSHA_CD2_NEXT        AS UPN_GYOUSHA_NEXT_CD2,
M_GYOUSHA_NEXT2.GYOUSHA_NAME1 + M_GYOUSHA_NEXT2.GYOUSHA_NAME2 AS UPN_GYOUSHA_NAME_NEXT2,
/*IF data.ADDRESS_KBN.Value == 1*/
FOR_TODOUFUKEN_NEXT2.TODOUFUKEN_NAME + M_GYOUSHA_NEXT2.GYOUSHA_ADDRESS1 + M_GYOUSHA_NEXT2.GYOUSHA_ADDRESS2
/*END*/
/*IF data.ADDRESS_KBN.Value == 2*/
M_GYOUSHA_NEXT2.GYOUSHA_ADDRESS1 + M_GYOUSHA_NEXT2.GYOUSHA_ADDRESS2
/*END*/
/*IF data.ADDRESS_KBN.Value == 3*/
FOR_TODOUFUKEN_NEXT2.TODOUFUKEN_NAME + M_GYOUSHA_NEXT2.GYOUSHA_ADDRESS1
/*END*/
AS UPN_GYOUSHA_ADDRESS_NEXT2,
M_GYOUSHA_NEXT2.CHIIKI_CD                                       AS UPN_GYOUSHA_CHIIKI_CD_NEXT2,
FOR_GYOUSHA_NEXT2.CHIIKI_NAME                                  AS UPN_GYOUSHA_CHIIKI_NAME_NEXT2,
FOR_GYOUSHU_NEXT2.HOUKOKU_GYOUSHU_CD                                   AS UPN_GYOUSHA_GYOUSHU_CD_NEXT2,
FOR_GYOUSHU_NEXT2.HOUKOKU_GYOUSHU_NAME                               AS UPN_GYOUSHA_GYOUSHU_NAME_NEXT2,
--運搬受託者（二次）運搬受託者(3)
MANI.UPN_GYOUSHA_CD3_NEXT        AS UPN_GYOUSHA_NEXT_CD3
,M_GYOUSHA_NEXT3.GYOUSHA_NAME1 + M_GYOUSHA_NEXT3.GYOUSHA_NAME2 AS UPN_GYOUSHA_NAME_NEXT3
,
/*IF data.ADDRESS_KBN.Value == 1*/
FOR_TODOUFUKEN_NEXT3.TODOUFUKEN_NAME + M_GYOUSHA_NEXT3.GYOUSHA_ADDRESS1 + M_GYOUSHA_NEXT3.GYOUSHA_ADDRESS2
/*END*/
/*IF data.ADDRESS_KBN.Value == 2*/
M_GYOUSHA_NEXT3.GYOUSHA_ADDRESS1 + M_GYOUSHA_NEXT3.GYOUSHA_ADDRESS2
/*END*/
/*IF data.ADDRESS_KBN.Value == 3*/
FOR_TODOUFUKEN_NEXT3.TODOUFUKEN_NAME + M_GYOUSHA_NEXT3.GYOUSHA_ADDRESS1 
/*END*/ AS UPN_GYOUSHA_ADDRESS_NEXT3
,M_GYOUSHA_NEXT3.CHIIKI_CD                                       AS UPN_GYOUSHA_CHIIKI_CD_NEXT3
,FOR_GYOUSHA_NEXT3.CHIIKI_NAME                                  AS UPN_GYOUSHA_CHIIKI_NAME_NEXT3
,FOR_GYOUSHU_NEXT3.HOUKOKU_GYOUSHU_CD                                   AS UPN_GYOUSHA_GYOUSHU_CD_NEXT3
,FOR_GYOUSHU_NEXT3.HOUKOKU_GYOUSHU_NAME                               AS UPN_GYOUSHA_GYOUSHU_NAME_NEXT3
--許可番号
/*IF data.TOKUBETSU_KANRI_KBN.Value == 1*/
,FOR_KYOKA1.FUTSUU_KYOKA_NO AS KYOKA_NO1
,FOR_KYOKA2.FUTSUU_KYOKA_NO AS KYOKA_NO2
,FOR_KYOKA3.FUTSUU_KYOKA_NO AS KYOKA_NO3
/*END*/
/*IF data.TOKUBETSU_KANRI_KBN.Value == 2*/
,FOR_KYOKA1.TOKUBETSU_KYOKA_NO AS KYOKA_NO1
,FOR_KYOKA2.TOKUBETSU_KYOKA_NO AS KYOKA_NO2
,FOR_KYOKA3.TOKUBETSU_KYOKA_NO AS KYOKA_NO3
/*END*/
,CASE
	WHEN MANI.ITAKUSAKI_KYOKA_KBN IS NULL THEN ''
	WHEN MANI.ITAKUSAKI_KYOKA_KBN = 0 THEN FOR_KYOKA_NEXT1.FUTSUU_KYOKA_NO
	ELSE FOR_KYOKA_NEXT1.TOKUBETSU_KYOKA_NO
	END AS KYOKA_NO_NEXT1
,CASE
	WHEN MANI.ITAKUSAKI_KYOKA_KBN IS NULL THEN ''
	WHEN MANI.ITAKUSAKI_KYOKA_KBN = 0 THEN FOR_KYOKA_NEXT2.FUTSUU_KYOKA_NO
	ELSE FOR_KYOKA_NEXT2.TOKUBETSU_KYOKA_NO
	END AS KYOKA_NO_NEXT2
,CASE
	WHEN MANI.ITAKUSAKI_KYOKA_KBN IS NULL THEN ''
	WHEN MANI.ITAKUSAKI_KYOKA_KBN = 0 THEN FOR_KYOKA_NEXT3.FUTSUU_KYOKA_NO
	ELSE FOR_KYOKA_NEXT3.TOKUBETSU_KYOKA_NO
	END AS KYOKA_NO_NEXT3
--積替保管（一次）(1)
,MANI.UPN_SAKI_GYOUSHA_CD1    AS UPN_SAKI_GYOUSHA_CD1
,MANI.UPN_SAKI_GENBA_CD1      AS UPN_SAKI_GENBA_CD1
,M_GENBA1.GENBA_NAME1 + M_GENBA1.GENBA_NAME2 AS UPN_SAKI_GENBA_NAME1
,
/*IF data.ADDRESS_KBN.Value == 1*/
M_TODOUFUKEN1.TODOUFUKEN_NAME + M_GENBA1.GENBA_ADDRESS1 + M_GENBA1.GENBA_ADDRESS2 
/*END*/
/*IF data.ADDRESS_KBN.Value == 2*/
M_GENBA1.GENBA_ADDRESS1 + M_GENBA1.GENBA_ADDRESS2 
/*END*/
/*IF data.ADDRESS_KBN.Value == 3*/
M_TODOUFUKEN1.TODOUFUKEN_NAME + M_GENBA1.GENBA_ADDRESS1 
/*END*/ AS UPN_SAKI_GENBA_ADDRESS1
,M_GENBA1.CHIIKI_CD AS UPN_SAKI_CHIIKI_CD1
,M_CHIIKI1.CHIIKI_NAME AS UPN_SAKI_CHIIKI_NAME1
,M_GYOUSHU1.HOUKOKU_GYOUSHU_CD AS UPN_SAKI_GYOUSHU_CD1
,M_GYOUSHU1.HOUKOKU_GYOUSHU_NAME AS UPN_SAKI_GYOUSHU_NAME1
--積替保管（一次）(2)
,MANI.UPN_SAKI_GYOUSHA_CD2   AS UPN_SAKI_GYOUSHA_CD2
,MANI.UPN_SAKI_GENBA_CD2     AS UPN_SAKI_GENBA_CD2
,M_GENBA2.GENBA_NAME1 + M_GENBA2.GENBA_NAME2 AS UPN_SAKI_GENBA_NAME2
,
/*IF data.ADDRESS_KBN.Value == 1*/
M_TODOUFUKEN2.TODOUFUKEN_NAME + M_GENBA2.GENBA_ADDRESS1 + M_GENBA2.GENBA_ADDRESS2 
/*END*/
/*IF data.ADDRESS_KBN.Value == 2*/
M_GENBA2.GENBA_ADDRESS1 + M_GENBA2.GENBA_ADDRESS2 
/*END*/
/*IF data.ADDRESS_KBN.Value == 3*/
M_TODOUFUKEN2.TODOUFUKEN_NAME + M_GENBA2.GENBA_ADDRESS1 
/*END*/ AS UPN_SAKI_GENBA_ADDRESS2
,M_GENBA2.CHIIKI_CD AS UPN_SAKI_CHIIKI_CD2
,M_CHIIKI2.CHIIKI_NAME AS UPN_SAKI_CHIIKI_NAME2
,M_GYOUSHU2.HOUKOKU_GYOUSHU_CD AS UPN_SAKI_GYOUSHU_CD2
,M_GYOUSHU2.HOUKOKU_GYOUSHU_NAME AS UPN_SAKI_GYOUSHU_NAME2
--積替保管（二次）(1)
,MANI.TMH1_GYOUSHA_CD_NEXT  AS UPN_SAKI_GYOUSHA_CD_NEXT1
,MANI.TMH1_GENBA_CD_NEXT       AS UPN_SAKI_GENBA_CD_NEXT1
,M_GENBA_NEXT1.GENBA_NAME1 + M_GENBA_NEXT1.GENBA_NAME2 AS UPN_SAKI_GENBA_NAME_NEXT1
,
/*IF data.ADDRESS_KBN.Value == 1*/
M_TODOUFUKEN_NEXT1.TODOUFUKEN_NAME + M_GENBA_NEXT1.GENBA_ADDRESS1 + M_GENBA_NEXT1.GENBA_ADDRESS2 
/*END*/
/*IF data.ADDRESS_KBN.Value == 2*/
M_GENBA_NEXT1.GENBA_ADDRESS1 + M_GENBA_NEXT1.GENBA_ADDRESS2 
/*END*/
/*IF data.ADDRESS_KBN.Value == 3*/
M_TODOUFUKEN_NEXT1.TODOUFUKEN_NAME + M_GENBA_NEXT1.GENBA_ADDRESS1 
/*END*/ AS UPN_SAKI_GENBA_ADDRESS_NEXT1
,M_GENBA_NEXT1.CHIIKI_CD AS UPN_SAKI_CHIIKI_CD_NEXT1
,M_CHIIKI_NEXT1.CHIIKI_NAME AS UPN_SAKI_CHIIKI_NAME_NEXT1
,M_GYOUSHU_NEXT1.HOUKOKU_GYOUSHU_CD AS UPN_SAKI_GYOUSHU_CD_NEXT1
,M_GYOUSHU_NEXT1.HOUKOKU_GYOUSHU_NAME AS UPN_SAKI_GYOUSHU_NAME_NEXT1
--積替保管（二次）(2)
,MANI.TMH2_GYOUSHA_CD_NEXT  AS UPN_SAKI_GYOUSHA_CD_NEXT2
,MANI.TMH2_GENBA_CD_NEXT       AS UPN_SAKI_GENBA_CD_NEXT2
,M_GENBA_NEXT2.GENBA_NAME1 + M_GENBA_NEXT2.GENBA_NAME2 AS UPN_SAKI_GENBA_NAME_NEXT2
,
/*IF data.ADDRESS_KBN.Value == 1*/
M_TODOUFUKEN_NEXT2.TODOUFUKEN_NAME + M_GENBA_NEXT2.GENBA_ADDRESS1 + M_GENBA_NEXT2.GENBA_ADDRESS2 
/*END*/
/*IF data.ADDRESS_KBN.Value == 2*/
M_GENBA_NEXT2.GENBA_ADDRESS1 + M_GENBA_NEXT2.GENBA_ADDRESS2 
/*END*/
/*IF data.ADDRESS_KBN.Value == 3*/
M_TODOUFUKEN_NEXT2.TODOUFUKEN_NAME + M_GENBA_NEXT2.GENBA_ADDRESS1 
/*END*/ AS UPN_SAKI_GENBA_ADDRESS_NEXT2
,M_GENBA_NEXT2.CHIIKI_CD AS UPN_SAKI_CHIIKI_CD_NEXT2
,M_CHIIKI_NEXT2.CHIIKI_NAME AS UPN_SAKI_CHIIKI_NAME_NEXT2
,M_GYOUSHU_NEXT2.HOUKOKU_GYOUSHU_CD AS UPN_SAKI_GYOUSHU_CD_NEXT2
,M_GYOUSHU_NEXT2.HOUKOKU_GYOUSHU_NAME AS UPN_SAKI_GYOUSHU_NAME_NEXT2
--処分受託者
,CASE WHEN /*data.TOKUBETSU_KANRI_KBN.Value*/1 = 1 THEN SBN_KYOKA.FUTSUU_KYOKA_NO ELSE SBN_KYOKA.TOKUBETSU_KYOKA_NO END AS SBN_KYOKA_NO
,MANI.SBN_GYOUSHA_CD AS SBN_GYOUSHA_CD
,MANI.SBN_GYOUSHA_NAME AS SBN_GYOUSHA_NAME
,MANI.SBN_GYOUSHA_ADDRESS AS SBN_GYOUSHA_ADDRESS
,M_GYOUSHA_FOR_SBN.CHIIKI_CD AS SBN_CHIIKI_CD
,M_CHIIKI_FOR_SBN.CHIIKI_NAME AS SBN_CHIIKI_NAME
,M_GYOUSHU_FOR_SBN.HOUKOKU_GYOUSHU_CD AS SBN_GYOUSHU_CD
,M_GYOUSHU_FOR_SBN.HOUKOKU_GYOUSHU_NAME AS SBN_GYOUSHU_NAME
,MANI.SBN_GENBA_CD AS SBN_GENBA_CD
,MANI.SBN_GENBA_NAME AS SBN_GENBA_NAME
,MANI.SBN_GENBA_ADDRESS AS SBN_GENBA_ADDRESS
,MANI.SBN_GENBA_CHIIKI_CD AS SBN_GENBA_CHIIKI_CD
,M_CHIIKI_FOR_SBN_GENBA.CHIIKI_NAME AS SBN_GENBA_CHIIKI_NAME
,M_GYOUSHU_FOR_SBN_GENBA.HOUKOKU_GYOUSHU_CD AS SBN_GENBA_GYOUSHU_CD
,M_GYOUSHU_FOR_SBN_GENBA.HOUKOKU_GYOUSHU_NAME AS SBN_GENBA_GYOUSHU_NAME
,MANI.KANSAN_SUU        AS SBN_RYOU
,MANI.SHOBUN_HOUHOU_CD AS SBN_HOUHOU_CD
,MANI.SHOBUN_HOUHOU_NAME AS SBN_HOUHOU_NAME
,MANI.SBN_MOKUTEKI_CD AS SBN_MOKUTEKI_CD
,NULL AS SBN_MOKUTEKI_NAME
,M_CBSU_FOR_SBN_GENBA.HOUKOKU_SHISETSU_CD AS HOUKOKU_SHISETSU_CD
,M_CBSU_FOR_SBN_GENBA.HOUKOKU_SHISETSU_NAME AS HOUKOKU_SHISETSU_NAME
--委託先
,MANI.ITAKUSAKI_KYOKA_NO AS ITAKUSAKI_KYOKA_NO
,MANI.SBN_GYOUSHA_CD_NEXT AS ITAKUSAKI_CD
,M_GYOUSHA_FOR_ITAKU.GYOUSHA_NAME1 + M_GYOUSHA_FOR_ITAKU.GYOUSHA_NAME2 AS ITAKUSAKI_GYOUSHA_NAME
,
/*IF data.ADDRESS_KBN.Value == 1*/
M_TODOUFUKEN_FOR_ITAKU.TODOUFUKEN_NAME + M_GYOUSHA_FOR_ITAKU.GYOUSHA_ADDRESS1 + M_GYOUSHA_FOR_ITAKU.GYOUSHA_ADDRESS2 
/*END*/
/*IF data.ADDRESS_KBN.Value == 2*/
M_GYOUSHA_FOR_ITAKU.GYOUSHA_ADDRESS1 + M_GYOUSHA_FOR_ITAKU.GYOUSHA_ADDRESS2 
/*END*/
/*IF data.ADDRESS_KBN.Value == 3*/
M_TODOUFUKEN_FOR_ITAKU.TODOUFUKEN_NAME + M_GYOUSHA_FOR_ITAKU.GYOUSHA_ADDRESS1 
/*END*/ AS ITAKUSAKI_GYOUSHA_ADDRESS
,M_GYOUSHA_FOR_ITAKU.CHIIKI_CD AS ITAKUSAKI_CHIIKI_CD
,M_CHIIKI_FOR_ITAKU.CHIIKI_NAME AS ITAKUSAKI_CHIIKI_NAME
,M_GYOUSHU_FOR_ITAKU.HOUKOKU_GYOUSHU_CD AS ITAKUSAKI_GYOUSHU_CD
,M_GYOUSHU_FOR_ITAKU.HOUKOKU_GYOUSHU_NAME AS ITAKUSAKI_GYOUSHU_NAME
,MANI.SBN_GENBA_CD_NEXT AS ITAKUSAKI_GENBA_CD
,MANI.ITAKUSAKI_NAME AS ITAKUSAKI_GENBA_NAME
,MANI.ITAKUSAKI_ADDRESS AS ITAKUSAKI_GENBA_ADDRESS
,MANI.ITAKUSAKI_CHIIKI_CD AS ITAKUSAKI_GENBA_CHIIKI_CD
,M_CHIIKI_FOR_ITAKUGENBA.CHIIKI_NAME AS ITAKUSAKI_GENBA_CHIIKI_NAME
,M_GYOUSHU_FOR_ITAKUGENBA.HOUKOKU_GYOUSHU_CD AS ITAKUSAKI_GENBA_GYOUSHU_CD
,M_GYOUSHU_FOR_ITAKUGENBA.HOUKOKU_GYOUSHU_NAME AS ITAKUSAKI_GENBA_GYOUSHU_NAME
,MANI.HOUKOKUSHO_BUNRUI_CD_NEXT AS ITAKUSAKI_BUNRUI_CD
,MANI.HOUKOKUSHO_BUNRUI_NAME_NEXT AS ITAKUSAKI_BUNRUI_NAME
,MANI.SHOBUN_HOUHOU_CD_NEXT AS ITAKUSAKI_HOUHOU_CD
,MANI.SHOBUN_HOUHOU_NAME_NEXT AS ITAKUSAKI_HOUHOU_NAME
/*IF data.SAI_ITAKU_KBN.Value != 2*/
,MANI.GENYOU_SUU AS ITAKU_RYOU
/*END*/
/*IF data.SAI_ITAKU_KBN.Value == 2*/
,CASE WHEN  M_GYOUSHA_FOR_ITAKU.JISHA_KBN = 1 THEN NULL ELSE MANI.GENYOU_SUU END
 AS ITAKU_RYOU
/*END*/
--一次・二次共通
, MANI.MANIFEST_ID AS MANIFEST_ID
, MANI.MANIFEST_ID_NEXT AS MANIFEST_ID_NEXT
, MANI.KOUFU_DATE AS KOUFU_DATE
, MANI.KOUFU_DATE_NEXT AS KOUFU_DATE_NEXT
--委託チェック
, MANI.ITAKU_KBN
FROM
MANI
LEFT JOIN M_GYOUSHA HST_GYOUSHA ON HST_GYOUSHA.GYOUSHA_CD = MANI.HST_GYOUSHA_CD
LEFT JOIN M_GENBA HST_GENBA ON HST_GENBA.GYOUSHA_CD = MANI.HST_GYOUSHA_CD AND HST_GENBA.GENBA_CD = MANI.HST_GENBA_CD
LEFT JOIN M_CHIIKI HST_GYOUSHA_CHIIKI ON  HST_GYOUSHA_CHIIKI.CHIIKI_CD = HST_GYOUSHA.CHIIKI_CD
LEFT JOIN M_CHIIKI HST_GENBA_CHIIKI ON  HST_GENBA_CHIIKI.CHIIKI_CD = MANI.HST_GENBA_CHIIKI_CD
LEFT JOIN M_CHIIKIBETSU_GYOUSHU FOR_GYOUSHU_HST ON FOR_GYOUSHU_HST.GYOUSHU_CD = HST_GYOUSHA.GYOUSHU_CD AND FOR_GYOUSHU_HST.CHIIKI_CD = HST_GYOUSHA.CHIIKI_CD
LEFT JOIN M_CHIIKIBETSU_GYOUSHU FOR_GYOUSHU_HST_GENBA ON FOR_GYOUSHU_HST_GENBA.GYOUSHU_CD = HST_GENBA.GYOUSHU_CD AND FOR_GYOUSHU_HST_GENBA.CHIIKI_CD = HST_GENBA.CHIIKI_CD
LEFT JOIN M_GYOUSHA M_GYOUSHA1 ON M_GYOUSHA1.GYOUSHA_CD = MANI.UPN_GYOUSHA_CD1
LEFT JOIN M_CHIIKI FOR_GYOUSHA1 ON FOR_GYOUSHA1.CHIIKI_CD = M_GYOUSHA1.CHIIKI_CD
LEFT JOIN M_CHIIKIBETSU_GYOUSHU FOR_GYOUSHU1 ON FOR_GYOUSHU1.GYOUSHU_CD = M_GYOUSHA1.GYOUSHU_CD AND FOR_GYOUSHU1.CHIIKI_CD = M_GYOUSHA1.CHIIKI_CD
LEFT JOIN M_CHIIKIBETSU_KYOKA FOR_KYOKA1 ON FOR_KYOKA1.GENBA_CD = '' AND FOR_KYOKA1.CHIIKI_CD = FOR_GYOUSHA1.CHIIKI_CD AND FOR_KYOKA1.GYOUSHA_CD = M_GYOUSHA1.GYOUSHA_CD AND FOR_KYOKA1.KYOKA_KBN = 1
LEFT JOIN M_TODOUFUKEN FOR_TODOUFUKEN1 ON FOR_TODOUFUKEN1.TODOUFUKEN_CD = M_GYOUSHA1.GYOUSHA_TODOUFUKEN_CD

LEFT JOIN M_GYOUSHA M_GYOUSHA2 ON M_GYOUSHA2.GYOUSHA_CD = MANI.UPN_GYOUSHA_CD2
LEFT JOIN M_CHIIKI FOR_GYOUSHA2 ON FOR_GYOUSHA2.CHIIKI_CD = M_GYOUSHA2.CHIIKI_CD
LEFT JOIN M_CHIIKIBETSU_GYOUSHU FOR_GYOUSHU2 ON FOR_GYOUSHU2.GYOUSHU_CD = M_GYOUSHA2.GYOUSHU_CD AND FOR_GYOUSHU2.CHIIKI_CD = M_GYOUSHA2.CHIIKI_CD
LEFT JOIN M_CHIIKIBETSU_KYOKA FOR_KYOKA2 ON FOR_KYOKA2.GENBA_CD = '' AND FOR_KYOKA2.CHIIKI_CD = FOR_GYOUSHA2.CHIIKI_CD AND FOR_KYOKA2.GYOUSHA_CD = M_GYOUSHA2.GYOUSHA_CD AND FOR_KYOKA2.KYOKA_KBN = 1
LEFT JOIN M_TODOUFUKEN FOR_TODOUFUKEN2 ON FOR_TODOUFUKEN2.TODOUFUKEN_CD = M_GYOUSHA2.GYOUSHA_TODOUFUKEN_CD

LEFT JOIN M_GYOUSHA M_GYOUSHA3 ON M_GYOUSHA3.GYOUSHA_CD = MANI.UPN_GYOUSHA_CD3
LEFT JOIN M_CHIIKI FOR_GYOUSHA3 ON FOR_GYOUSHA3.CHIIKI_CD = M_GYOUSHA3.CHIIKI_CD
LEFT JOIN M_CHIIKIBETSU_GYOUSHU FOR_GYOUSHU3 ON FOR_GYOUSHU3.GYOUSHU_CD = M_GYOUSHA3.GYOUSHU_CD AND FOR_GYOUSHU3.CHIIKI_CD = M_GYOUSHA3.CHIIKI_CD
LEFT JOIN M_CHIIKIBETSU_KYOKA FOR_KYOKA3 ON FOR_KYOKA3.GENBA_CD = '' AND FOR_KYOKA3.CHIIKI_CD = FOR_GYOUSHA3.CHIIKI_CD AND FOR_KYOKA3.GYOUSHA_CD = M_GYOUSHA3.GYOUSHA_CD AND FOR_KYOKA3.KYOKA_KBN = 1
LEFT JOIN M_TODOUFUKEN FOR_TODOUFUKEN3 ON FOR_TODOUFUKEN3.TODOUFUKEN_CD = M_GYOUSHA3.GYOUSHA_TODOUFUKEN_CD


LEFT JOIN M_GYOUSHA M_GYOUSHA_NEXT1 ON M_GYOUSHA_NEXT1.GYOUSHA_CD = MANI.UPN_GYOUSHA_CD1_NEXT
LEFT JOIN M_CHIIKI FOR_GYOUSHA_NEXT1 ON FOR_GYOUSHA_NEXT1.CHIIKI_CD = M_GYOUSHA_NEXT1.CHIIKI_CD
LEFT JOIN M_CHIIKIBETSU_GYOUSHU FOR_GYOUSHU_NEXT1 ON FOR_GYOUSHU_NEXT1.GYOUSHU_CD = M_GYOUSHA_NEXT1.GYOUSHU_CD AND FOR_GYOUSHU_NEXT1.CHIIKI_CD = M_GYOUSHA_NEXT1.CHIIKI_CD
LEFT JOIN M_CHIIKIBETSU_KYOKA FOR_KYOKA_NEXT1 ON FOR_KYOKA_NEXT1.GENBA_CD = '' AND FOR_KYOKA_NEXT1.CHIIKI_CD = M_GYOUSHA_NEXT1.CHIIKI_CD AND FOR_KYOKA_NEXT1.GYOUSHA_CD = M_GYOUSHA_NEXT1.GYOUSHA_CD AND FOR_KYOKA_NEXT1.KYOKA_KBN = 1
LEFT JOIN M_TODOUFUKEN FOR_TODOUFUKEN_NEXT1 ON FOR_TODOUFUKEN_NEXT1.TODOUFUKEN_CD = M_GYOUSHA_NEXT1.GYOUSHA_TODOUFUKEN_CD

LEFT JOIN M_GYOUSHA M_GYOUSHA_NEXT2 ON M_GYOUSHA_NEXT2.GYOUSHA_CD = MANI.UPN_GYOUSHA_CD2_NEXT
LEFT JOIN M_CHIIKI FOR_GYOUSHA_NEXT2 ON FOR_GYOUSHA_NEXT2.CHIIKI_CD = M_GYOUSHA_NEXT2.CHIIKI_CD
LEFT JOIN M_CHIIKIBETSU_GYOUSHU FOR_GYOUSHU_NEXT2 ON FOR_GYOUSHU_NEXT2.GYOUSHU_CD = M_GYOUSHA_NEXT2.GYOUSHU_CD AND FOR_GYOUSHU_NEXT2.CHIIKI_CD = M_GYOUSHA_NEXT2.CHIIKI_CD
LEFT JOIN M_CHIIKIBETSU_KYOKA FOR_KYOKA_NEXT2 ON FOR_KYOKA_NEXT2.GENBA_CD = '' AND FOR_KYOKA_NEXT2.CHIIKI_CD = M_GYOUSHA_NEXT2.CHIIKI_CD AND FOR_KYOKA_NEXT2.GYOUSHA_CD = M_GYOUSHA_NEXT2.GYOUSHA_CD AND FOR_KYOKA_NEXT2.KYOKA_KBN = 1
LEFT JOIN M_TODOUFUKEN FOR_TODOUFUKEN_NEXT2 ON FOR_TODOUFUKEN_NEXT2.TODOUFUKEN_CD = M_GYOUSHA_NEXT2.GYOUSHA_TODOUFUKEN_CD

LEFT JOIN M_GYOUSHA M_GYOUSHA_NEXT3 ON M_GYOUSHA_NEXT3.GYOUSHA_CD = MANI.UPN_GYOUSHA_CD3_NEXT
LEFT JOIN M_CHIIKI FOR_GYOUSHA_NEXT3 ON FOR_GYOUSHA_NEXT3.CHIIKI_CD = M_GYOUSHA_NEXT3.CHIIKI_CD
LEFT JOIN M_CHIIKIBETSU_GYOUSHU FOR_GYOUSHU_NEXT3 ON FOR_GYOUSHU_NEXT3.GYOUSHU_CD = M_GYOUSHA_NEXT3.GYOUSHU_CD AND FOR_GYOUSHU_NEXT3.CHIIKI_CD = M_GYOUSHA_NEXT3.CHIIKI_CD
LEFT JOIN M_CHIIKIBETSU_KYOKA FOR_KYOKA_NEXT3 ON FOR_KYOKA_NEXT3.GENBA_CD = '' AND FOR_KYOKA_NEXT3.CHIIKI_CD = M_GYOUSHA_NEXT3.CHIIKI_CD AND FOR_KYOKA_NEXT3.GYOUSHA_CD = M_GYOUSHA_NEXT3.GYOUSHA_CD AND FOR_KYOKA_NEXT3.KYOKA_KBN = 1
LEFT JOIN M_TODOUFUKEN FOR_TODOUFUKEN_NEXT3 ON FOR_TODOUFUKEN_NEXT3.TODOUFUKEN_CD = M_GYOUSHA_NEXT3.GYOUSHA_TODOUFUKEN_CD

LEFT JOIN M_GENBA M_GENBA1 ON M_GENBA1.GYOUSHA_CD = MANI.UPN_SAKI_GYOUSHA_CD1 AND M_GENBA1.GENBA_CD = MANI.UPN_SAKI_GENBA_CD1
LEFT JOIN M_CHIIKI M_CHIIKI1 ON M_CHIIKI1.CHIIKI_CD = M_GENBA1.CHIIKI_CD
LEFT JOIN M_CHIIKIBETSU_GYOUSHU M_GYOUSHU1 ON M_GYOUSHU1.GYOUSHU_CD =M_GENBA1.GYOUSHU_CD AND M_GYOUSHU1.CHIIKI_CD = M_GENBA1.CHIIKI_CD
LEFT JOIN M_TODOUFUKEN M_TODOUFUKEN1 ON M_TODOUFUKEN1.TODOUFUKEN_CD = M_GENBA1.GENBA_TODOUFUKEN_CD

LEFT JOIN M_GENBA M_GENBA2 ON M_GENBA2.GYOUSHA_CD = MANI.UPN_SAKI_GYOUSHA_CD2 AND M_GENBA2.GENBA_CD = MANI.UPN_SAKI_GENBA_CD2
LEFT JOIN M_CHIIKI M_CHIIKI2 ON M_CHIIKI2.CHIIKI_CD =M_GENBA2.CHIIKI_CD
LEFT JOIN M_CHIIKIBETSU_GYOUSHU M_GYOUSHU2 ON M_GYOUSHU2.GYOUSHU_CD = M_GENBA2.GYOUSHU_CD AND M_GYOUSHU2.CHIIKI_CD = M_GENBA2.CHIIKI_CD
LEFT JOIN M_TODOUFUKEN M_TODOUFUKEN2 ON M_TODOUFUKEN2.TODOUFUKEN_CD = M_GENBA2.GENBA_TODOUFUKEN_CD

LEFT JOIN M_GENBA M_GENBA_NEXT1 ON M_GENBA_NEXT1.GYOUSHA_CD = MANI.TMH1_GYOUSHA_CD_NEXT AND M_GENBA_NEXT1.GENBA_CD = MANI.TMH1_GENBA_CD_NEXT
LEFT JOIN M_CHIIKI M_CHIIKI_NEXT1 ON M_CHIIKI_NEXT1.CHIIKI_CD = M_GENBA_NEXT1.CHIIKI_CD
LEFT JOIN M_CHIIKIBETSU_GYOUSHU M_GYOUSHU_NEXT1 ON M_GYOUSHU_NEXT1.GYOUSHU_CD =M_GENBA_NEXT1.GYOUSHU_CD AND M_GYOUSHU_NEXT1.CHIIKI_CD = M_GENBA_NEXT1.CHIIKI_CD
LEFT JOIN M_TODOUFUKEN M_TODOUFUKEN_NEXT1 ON M_TODOUFUKEN_NEXT1.TODOUFUKEN_CD = M_GENBA_NEXT1.GENBA_TODOUFUKEN_CD

LEFT JOIN M_GENBA M_GENBA_NEXT2 ON M_GENBA_NEXT2.GYOUSHA_CD = MANI.TMH2_GYOUSHA_CD_NEXT AND M_GENBA_NEXT2.GENBA_CD = MANI.TMH2_GENBA_CD_NEXT
LEFT JOIN M_CHIIKI M_CHIIKI_NEXT2 ON M_CHIIKI_NEXT2.CHIIKI_CD = M_GENBA_NEXT2.CHIIKI_CD
LEFT JOIN M_CHIIKIBETSU_GYOUSHU M_GYOUSHU_NEXT2 ON M_GYOUSHU_NEXT2.GYOUSHU_CD =M_GENBA_NEXT2.GYOUSHU_CD AND M_GYOUSHU_NEXT2.CHIIKI_CD = M_GENBA_NEXT2.CHIIKI_CD
LEFT JOIN M_TODOUFUKEN M_TODOUFUKEN_NEXT2 ON M_TODOUFUKEN_NEXT2.TODOUFUKEN_CD = M_GENBA_NEXT2.GENBA_TODOUFUKEN_CD

LEFT JOIN M_GYOUSHA M_GYOUSHA_FOR_SBN ON M_GYOUSHA_FOR_SBN.GYOUSHA_CD = MANI.SBN_GYOUSHA_CD
LEFT JOIN M_CHIIKI M_CHIIKI_FOR_SBN ON M_CHIIKI_FOR_SBN.CHIIKI_CD = M_GYOUSHA_FOR_SBN.CHIIKI_CD
LEFT JOIN M_CHIIKIBETSU_GYOUSHU M_GYOUSHU_FOR_SBN ON M_GYOUSHU_FOR_SBN.GYOUSHU_CD = M_GYOUSHA_FOR_SBN.GYOUSHU_CD AND M_GYOUSHU_FOR_SBN.CHIIKI_CD = M_GYOUSHA_FOR_SBN.CHIIKI_CD
LEFT JOIN M_CHIIKI M_CHIIKI_FOR_SBN_GENBA ON M_CHIIKI_FOR_SBN_GENBA.CHIIKI_CD = MANI.SBN_GENBA_CHIIKI_CD
LEFT JOIN M_GENBA M_GENBA_FOR_SBN_GENBA ON M_GENBA_FOR_SBN_GENBA.GYOUSHA_CD = MANI.SBN_GYOUSHA_CD AND M_GENBA_FOR_SBN_GENBA.GENBA_CD = MANI.SBN_GENBA_CD
LEFT JOIN M_CHIIKIBETSU_GYOUSHU M_GYOUSHU_FOR_SBN_GENBA ON M_GYOUSHU_FOR_SBN_GENBA.GYOUSHU_CD = M_GENBA_FOR_SBN_GENBA.GYOUSHU_CD AND M_GYOUSHU_FOR_SBN_GENBA.CHIIKI_CD = MANI.SBN_GENBA_CHIIKI_CD
LEFT JOIN M_CHIIKIBETSU_SHISETSU M_CBSU_FOR_SBN_GENBA ON M_CBSU_FOR_SBN_GENBA.CHIIKI_CD = MANI.SBN_GENBA_CHIIKI_CD AND M_CBSU_FOR_SBN_GENBA.SHOBUN_HOUHOU_CD = MANI.SBN_HOUHOU_CD

LEFT JOIN M_CHIIKIBETSU_KYOKA SBN_KYOKA ON 
    SBN_KYOKA.GYOUSHA_CD = MANI.SBN_GYOUSHA_CD 
AND SBN_KYOKA.GENBA_CD = MANI.SBN_GENBA_CD 
AND SBN_KYOKA.CHIIKI_CD = M_GENBA_FOR_SBN_GENBA.CHIIKI_CD
AND SBN_KYOKA.KYOKA_KBN = 2

LEFT JOIN M_GYOUSHA M_GYOUSHA_FOR_ITAKU ON M_GYOUSHA_FOR_ITAKU.GYOUSHA_CD = MANI.SBN_GYOUSHA_CD_NEXT
LEFT JOIN M_CHIIKI M_CHIIKI_FOR_ITAKU ON M_CHIIKI_FOR_ITAKU.CHIIKI_CD = M_GYOUSHA_FOR_ITAKU.CHIIKI_CD
LEFT JOIN M_CHIIKIBETSU_GYOUSHU M_GYOUSHU_FOR_ITAKU ON M_GYOUSHU_FOR_ITAKU.GYOUSHU_CD = M_GYOUSHA_FOR_ITAKU.GYOUSHU_CD AND M_GYOUSHU_FOR_ITAKU.CHIIKI_CD = M_GYOUSHA_FOR_ITAKU.CHIIKI_CD
LEFT JOIN M_TODOUFUKEN M_TODOUFUKEN_FOR_ITAKU ON M_TODOUFUKEN_FOR_ITAKU.TODOUFUKEN_CD = M_GYOUSHA_FOR_ITAKU.GYOUSHA_TODOUFUKEN_CD
LEFT JOIN M_CHIIKI M_CHIIKI_FOR_ITAKUGENBA ON M_CHIIKI_FOR_ITAKUGENBA.CHIIKI_CD = MANI.ITAKUSAKI_CHIIKI_CD
LEFT JOIN M_GENBA M_GENBA_FOR_ITAKUGENBA ON M_GENBA_FOR_ITAKUGENBA.GYOUSHA_CD = MANI.SBN_GYOUSHA_CD_NEXT AND M_GENBA_FOR_ITAKUGENBA.GENBA_CD = MANI.SBN_GENBA_CD_NEXT
LEFT JOIN M_CHIIKIBETSU_GYOUSHU M_GYOUSHU_FOR_ITAKUGENBA ON M_GYOUSHU_FOR_ITAKUGENBA.GYOUSHU_CD = M_GENBA_FOR_ITAKUGENBA.GYOUSHU_CD AND M_GYOUSHU_FOR_ITAKUGENBA.CHIIKI_CD = MANI.ITAKUSAKI_CHIIKI_CD
LEFT JOIN M_HOUKOKUSHO_BUNRUI M_HKKUSHO_FOR_ITAKU ON M_HKKUSHO_FOR_ITAKU.HOUKOKUSHO_BUNRUI_CD = MANI.HAIKI_SHURUI_CD_NEXT
LEFT JOIN M_CHIIKIBETSU_SHOBUN M_CKBTU_FOR_ITAKU ON M_CKBTU_FOR_ITAKU.CHIIKI_CD = MANI.ITAKUSAKI_CHIIKI_CD AND M_CKBTU_FOR_ITAKU.SHOBUN_HOUHOU_CD = MANI.SBN_HOUHOU_CD
LEFT JOIN M_CHIIKIBETSU_SHOBUN M_CKBTU_FOR_SBN ON M_CKBTU_FOR_SBN.CHIIKI_CD = MANI.SBN_GENBA_CHIIKI_CD AND M_CKBTU_FOR_SBN.SHOBUN_HOUHOU_CD = MANI.SBN_HOUHOU_CD
LEFT JOIN M_CHIIKIBETSU_BUNRUI MCB ON MCB.CHIIKI_CD = /*data.TEISHUTSU_CHIIKI_CD*/ AND MCB.HOUKOKU_BUNRUI_CD = MANI.HOUKOKUSHO_BUNRUI_CD
)
SELECT   
--排出業者
HOUKOKUSHO_BUNRUI_CD                 AS HOUKOKUSHO_BUNRUI_CD,
HOUKOKUSHO_BUNRUI_NAME               AS HOUKOKUSHO_BUNRUI_NAME,
SEKIMEN_KBN                          AS SEKIMEN_KBN,
TOKUTEI_YUUGAI_KBN                   AS TOKUTEI_YUUGAI_KBN,
JYUTAKU_RYOU                         AS JYUTAKU_RYOU,
UNIT_NAME                            AS UNIT_NAME,
HST_GYOUSHA_CD                       AS HST_GYOUSHA_CD,
HST_GYOUSHA_NAME                     AS HST_GYOUSHA_NAME,
HST_GYOUSHA_ADDRESS                  AS HST_GYOUSHA_ADDRESS,
CHIIKI_CD2                           AS CHIIKI_CD2,
HST_GYOUSHA_CHIIKI_NAME              AS HST_GYOUSHA_CHIIKI_NAME,
HST_GYOUSHA_GYOUSHU_CD               AS HST_GYOUSHA_GYOUSHU_CD,
HST_GYOUSHU_NAME                     AS HST_GYOUSHU_NAME,
HST_GENBA_CD                         AS HST_GENBA_CD,
HST_GENBA_NAME                       AS HST_GENBA_NAME,
HST_GENBA_ADDRESS                    AS HST_GENBA_ADDRESS,
HST_GENBA_CHIIKI_CD                  AS HST_GENBA_CHIIKI_CD,
HST_GENBA_CHIIKI_NAME                AS HST_GENBA_CHIIKI_NAME,
HST_GENBA_GYOUSHU_CD                 AS HST_GENBA_GYOUSHU_CD,
HST_GENBA_GYOUSHU_NAME               AS HST_GENBA_GYOUSHU_NAME,
--運搬受託者（一次）運搬受託者(1)
UPN_GYOUSHA_CD1                      AS UPN_GYOUSHA_CD1,
UPN_GYOUSHA_NAME1                    AS UPN_GYOUSHA_NAME1,
UPN_GYOUSHA_ADDRESS1                 AS UPN_GYOUSHA_ADDRESS1,
UPN_GYOUSHA_CHIIKI_CD1               AS UPN_GYOUSHA_CHIIKI_CD1,
UPN_GYOUSHA_CHIIKI_NAME1             AS UPN_GYOUSHA_CHIIKI_NAME1,
UPN_GYOUSHA_GYOUSHU_CD1              AS UPN_GYOUSHA_GYOUSHU_CD1,
UPN_GYOUSHA_GYOUSHU_NAME1            AS UPN_GYOUSHA_GYOUSHU_NAME1,
KYOKA_NO1                            AS KYOKA_NO1,
--運搬受託者（一次）運搬受託者(2)
UPN_GYOUSHA_CD2                      AS UPN_GYOUSHA_CD2,
UPN_GYOUSHA_NAME2                    AS UPN_GYOUSHA_NAME2,
UPN_GYOUSHA_ADDRESS2                 AS UPN_GYOUSHA_ADDRESS2,
UPN_GYOUSHA_CHIIKI_CD2               AS UPN_GYOUSHA_CHIIKI_CD2,
UPN_GYOUSHA_CHIIKI_NAME2             AS UPN_GYOUSHA_CHIIKI_NAME2,
UPN_GYOUSHA_GYOUSHU_CD2              AS UPN_GYOUSHA_GYOUSHU_CD2,
UPN_GYOUSHA_GYOUSHU_NAME2            AS UPN_GYOUSHA_GYOUSHU_NAME2,
KYOKA_NO2                            AS KYOKA_NO2,
--運搬受託者（一次）運搬受託者(3)
UPN_GYOUSHA_CD3                      AS UPN_GYOUSHA_CD3,
UPN_GYOUSHA_NAME3                    AS UPN_GYOUSHA_NAME3,
UPN_GYOUSHA_ADDRESS3                 AS UPN_GYOUSHA_ADDRESS3,
UPN_GYOUSHA_CHIIKI_CD3               AS UPN_GYOUSHA_CHIIKI_CD3,
UPN_GYOUSHA_CHIIKI_NAME3             AS UPN_GYOUSHA_CHIIKI_NAME3,
UPN_GYOUSHA_GYOUSHU_CD3              AS UPN_GYOUSHA_GYOUSHU_CD3,
UPN_GYOUSHA_GYOUSHU_NAME3            AS UPN_GYOUSHA_GYOUSHU_NAME3,
KYOKA_NO3                            AS KYOKA_NO3,
--積替保管（一次）(1)
UPN_SAKI_GYOUSHA_CD1                 AS UPN_SAKI_GYOUSHA_CD1,
UPN_SAKI_GENBA_CD1                   AS UPN_SAKI_GENBA_CD1,
UPN_SAKI_GENBA_NAME1                 AS UPN_SAKI_GENBA_NAME1,
UPN_SAKI_GENBA_ADDRESS1              AS UPN_SAKI_GENBA_ADDRESS1,
UPN_SAKI_CHIIKI_CD1                  AS UPN_SAKI_CHIIKI_CD1,
UPN_SAKI_CHIIKI_NAME1                AS UPN_SAKI_CHIIKI_NAME1,
UPN_SAKI_GYOUSHU_CD1                 AS UPN_SAKI_GYOUSHU_CD1,
UPN_SAKI_GYOUSHU_NAME1               AS UPN_SAKI_GYOUSHU_NAME1,
--積替保管（一次）(2)
UPN_SAKI_GYOUSHA_CD2                 AS UPN_SAKI_GYOUSHA_CD2,
UPN_SAKI_GENBA_CD2                   AS UPN_SAKI_GENBA_CD2,
UPN_SAKI_GENBA_NAME2                 AS UPN_SAKI_GENBA_NAME2,
UPN_SAKI_GENBA_ADDRESS2              AS UPN_SAKI_GENBA_ADDRESS2,
UPN_SAKI_CHIIKI_CD2                  AS UPN_SAKI_CHIIKI_CD2,
UPN_SAKI_CHIIKI_NAME2                AS UPN_SAKI_CHIIKI_NAME2,
UPN_SAKI_GYOUSHU_CD2                 AS UPN_SAKI_GYOUSHU_CD2,
UPN_SAKI_GYOUSHU_NAME2               AS UPN_SAKI_GYOUSHU_NAME2,
--処分受託者
SBN_KYOKA_NO                         AS SBN_KYOKA_NO,
SBN_GYOUSHA_CD                       AS SBN_GYOUSHA_CD,
SBN_GYOUSHA_NAME                     AS SBN_GYOUSHA_NAME,
SBN_GYOUSHA_ADDRESS                  AS SBN_GYOUSHA_ADDRESS,
SBN_CHIIKI_CD                        AS SBN_CHIIKI_CD,
SBN_CHIIKI_NAME                      AS SBN_CHIIKI_NAME,
SBN_GYOUSHU_CD                       AS SBN_GYOUSHU_CD,
SBN_GYOUSHU_NAME                     AS SBN_GYOUSHU_NAME,
SBN_GENBA_CD                         AS SBN_GENBA_CD,
SBN_GENBA_NAME                       AS SBN_GENBA_NAME,
SBN_GENBA_ADDRESS                    AS SBN_GENBA_ADDRESS,
SBN_GENBA_CHIIKI_CD                  AS SBN_GENBA_CHIIKI_CD,
SBN_GENBA_CHIIKI_NAME                AS SBN_GENBA_CHIIKI_NAME,
SBN_GENBA_GYOUSHU_CD                 AS SBN_GENBA_GYOUSHU_CD,
SBN_GENBA_GYOUSHU_NAME               AS SBN_GENBA_GYOUSHU_NAME,
SBN_RYOU                             AS SBN_RYOU,
UNIT_NAME                            AS UNIT_NAME2,
SBN_HOUHOU_CD                        AS SBN_HOUHOU_CD,
SBN_HOUHOU_NAME                      AS SBN_HOUHOU_NAME,
SBN_MOKUTEKI_CD                      AS SBN_MOKUTEKI_CD,
SBN_MOKUTEKI_NAME                    AS SBN_MOKUTEKI_NAME,
HOUKOKU_SHISETSU_CD                  AS HOUKOKU_SHISETSU_CD,
HOUKOKU_SHISETSU_NAME                AS HOUKOKU_SHISETSU_NAME,
--運搬受託者（二次）運搬受託者(1)
UPN_GYOUSHA_NEXT_CD1                 AS UPN_GYOUSHA_NEXT_CD1,
UPN_GYOUSHA_NAME_NEXT1               AS UPN_GYOUSHA_NAME_NEXT1,
UPN_GYOUSHA_ADDRESS_NEXT1            AS UPN_GYOUSHA_ADDRESS_NEXT1,
UPN_GYOUSHA_CHIIKI_CD_NEXT1          AS UPN_GYOUSHA_CHIIKI_CD_NEXT1,
UPN_GYOUSHA_CHIIKI_NAME_NEXT1        AS UPN_GYOUSHA_CHIIKI_NAME_NEXT1,
UPN_GYOUSHA_GYOUSHU_CD_NEXT1         AS UPN_GYOUSHA_GYOUSHU_CD_NEXT1,
UPN_GYOUSHA_GYOUSHU_NAME_NEXT1       AS UPN_GYOUSHA_GYOUSHU_NAME_NEXT1,
KYOKA_NO_NEXT1                       AS KYOKA_NO_NEXT1,
--運搬受託者（二次）運搬受託者(2)
UPN_GYOUSHA_NEXT_CD2                 AS UPN_GYOUSHA_NEXT_CD2,
UPN_GYOUSHA_NAME_NEXT2               AS UPN_GYOUSHA_NAME_NEXT2,
UPN_GYOUSHA_ADDRESS_NEXT2            AS UPN_GYOUSHA_ADDRESS_NEXT2,
UPN_GYOUSHA_CHIIKI_CD_NEXT2          AS UPN_GYOUSHA_CHIIKI_CD_NEXT2,
UPN_GYOUSHA_CHIIKI_NAME_NEXT2        AS UPN_GYOUSHA_CHIIKI_NAME_NEXT2,
UPN_GYOUSHA_GYOUSHU_CD_NEXT2         AS UPN_GYOUSHA_GYOUSHU_CD_NEXT2,
UPN_GYOUSHA_GYOUSHU_NAME_NEXT2       AS UPN_GYOUSHA_GYOUSHU_NAME_NEXT2,
KYOKA_NO_NEXT2                       AS KYOKA_NO_NEXT2,
--運搬受託者（二次）運搬受託者(3)
UPN_GYOUSHA_NEXT_CD3                 AS UPN_GYOUSHA_NEXT_CD3,
UPN_GYOUSHA_NAME_NEXT3               AS UPN_GYOUSHA_NAME_NEXT3,
UPN_GYOUSHA_ADDRESS_NEXT3            AS UPN_GYOUSHA_ADDRESS_NEXT3,
UPN_GYOUSHA_CHIIKI_CD_NEXT3          AS UPN_GYOUSHA_CHIIKI_CD_NEXT3,
UPN_GYOUSHA_CHIIKI_NAME_NEXT3        AS UPN_GYOUSHA_CHIIKI_NAME_NEXT3,
UPN_GYOUSHA_GYOUSHU_CD_NEXT3         AS UPN_GYOUSHA_GYOUSHU_CD_NEXT3,
UPN_GYOUSHA_GYOUSHU_NAME_NEXT3       AS UPN_GYOUSHA_GYOUSHU_NAME_NEXT3,
KYOKA_NO_NEXT3                       AS KYOKA_NO_NEXT3,
--積替保管（二次）(1)
UPN_SAKI_GYOUSHA_CD_NEXT1            AS UPN_SAKI_GYOUSHA_CD_NEXT1,
UPN_SAKI_GENBA_CD_NEXT1              AS UPN_SAKI_GENBA_CD_NEXT1,
UPN_SAKI_GENBA_NAME_NEXT1            AS UPN_SAKI_GENBA_NAME_NEXT1,
UPN_SAKI_GENBA_ADDRESS_NEXT1         AS UPN_SAKI_GENBA_ADDRESS_NEXT1,
UPN_SAKI_CHIIKI_CD_NEXT1             AS UPN_SAKI_CHIIKI_CD_NEXT1,
UPN_SAKI_CHIIKI_NAME_NEXT1           AS UPN_SAKI_CHIIKI_NAME_NEXT1,
UPN_SAKI_GYOUSHU_CD_NEXT1            AS UPN_SAKI_GYOUSHU_CD_NEXT1,
UPN_SAKI_GYOUSHU_NAME_NEXT1          AS UPN_SAKI_GYOUSHU_NAME_NEXT1,
--積替保管（二次）(2)
UPN_SAKI_GYOUSHA_CD_NEXT2            AS UPN_SAKI_GYOUSHA_CD_NEXT2,
UPN_SAKI_GENBA_CD_NEXT2              AS UPN_SAKI_GENBA_CD_NEXT2,
UPN_SAKI_GENBA_NAME_NEXT2            AS UPN_SAKI_GENBA_NAME_NEXT2,
UPN_SAKI_GENBA_ADDRESS_NEXT2         AS UPN_SAKI_GENBA_ADDRESS_NEXT2,
UPN_SAKI_CHIIKI_CD_NEXT2             AS UPN_SAKI_CHIIKI_CD_NEXT2,
UPN_SAKI_CHIIKI_NAME_NEXT2           AS UPN_SAKI_CHIIKI_NAME_NEXT2,
UPN_SAKI_GYOUSHU_CD_NEXT2            AS UPN_SAKI_GYOUSHU_CD_NEXT2,
UPN_SAKI_GYOUSHU_NAME_NEXT2          AS UPN_SAKI_GYOUSHU_NAME_NEXT2,
--委託先
ITAKUSAKI_KYOKA_NO                   AS ITAKUSAKI_KYOKA_NO,
ITAKUSAKI_CD                         AS ITAKUSAKI_CD,
ITAKUSAKI_GYOUSHA_NAME               AS ITAKUSAKI_GYOUSHA_NAME,
ITAKUSAKI_GYOUSHA_ADDRESS            AS ITAKUSAKI_GYOUSHA_ADDRESS,
ITAKUSAKI_CHIIKI_CD                  AS ITAKUSAKI_CHIIKI_CD,
ITAKUSAKI_CHIIKI_NAME                AS ITAKUSAKI_CHIIKI_NAME,
ITAKUSAKI_GYOUSHU_CD                 AS ITAKUSAKI_GYOUSHU_CD,
ITAKUSAKI_GYOUSHU_NAME               AS ITAKUSAKI_GYOUSHU_NAME,
ITAKUSAKI_GENBA_CD                   AS ITAKUSAKI_GENBA_CD,
ITAKUSAKI_GENBA_NAME                 AS ITAKUSAKI_GENBA_NAME,
ITAKUSAKI_GENBA_ADDRESS              AS ITAKUSAKI_GENBA_ADDRESS,
ITAKUSAKI_GENBA_CHIIKI_CD            AS ITAKUSAKI_GENBA_CHIIKI_CD,
ITAKUSAKI_GENBA_CHIIKI_NAME          AS ITAKUSAKI_GENBA_CHIIKI_NAME,
ITAKUSAKI_GENBA_GYOUSHU_CD           AS ITAKUSAKI_GENBA_GYOUSHU_CD,
ITAKUSAKI_GENBA_GYOUSHU_NAME         AS ITAKUSAKI_GENBA_GYOUSHU_NAME,
ITAKUSAKI_BUNRUI_CD                  AS ITAKUSAKI_BUNRUI_CD,
ITAKUSAKI_BUNRUI_NAME                AS ITAKUSAKI_BUNRUI_NAME,
ITAKUSAKI_HOUHOU_CD                  AS ITAKUSAKI_HOUHOU_CD,
ITAKUSAKI_HOUHOU_NAME                AS ITAKUSAKI_HOUHOU_NAME,
ITAKU_RYOU                           AS ITAKU_RYOU,
UNIT_NAME                            AS UNIT_NAME3,
''                                   AS SAI_ITAKU,
--一次・二次共通
MANIFEST_ID                          AS MANIFEST_ID,
MANIFEST_ID_NEXT                     AS MANIFEST_ID_NEXT,
KOUFU_DATE                           AS KOUFU_DATE,
KOUFU_DATE_NEXT                      AS KOUFU_DATE_NEXT,
ITAKU_KBN                            AS ITAKU_KBN
FROM MANICSV
