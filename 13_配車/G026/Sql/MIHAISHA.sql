/*IF data.ShoriKbn == 1 || data.ShoriKbn == 2*/
SELECT CAST(1 AS smallint) SHUBETSU_KBN_
, SS.SYSTEM_ID SYSTEM_ID_
, SS.UKETSUKE_NUMBER DENPYOU_NUM_
, SS.SEQ
, SS.HAISHA_JOKYO_CD AS HAISHA_JOKYO
, CASE SS.HAISHA_SHURUI_CD WHEN 2 THEN '仮' WHEN 3 THEN '確' ELSE '' END AS HAISHA_SHURUI
, CASE WHEN SS.SAGYOU_DATE_BEGIN IS NULL AND SS.SAGYOU_DATE_END IS NULL THEN '' WHEN SS.SAGYOU_DATE_END <> SS.SAGYOU_DATE THEN '期間' ELSE '期間終了' END AS SAGYOUDATE_KUBUN
, ISNULL(SS.GENCHAKU_TIME_NAME,'') + ISNULL(LEFT(CONVERT(varchar, SS.GENCHAKU_TIME, 114), 5),'') AS GENCHAKU_JIKAN
, GTSS.GENCHAKU_BACK_COLOR
, CASE SS.HAISHA_SIJISHO_FLG WHEN 0 THEN '未印刷' WHEN 1 THEN '印刷済' ELSE '' END AS HAISHA_SIJISHO_STATUS
, CAST(0 AS bit) HAISHA_SIJISHO_CHECKED
, CASE SS.MAIL_SEND_FLG WHEN 0 THEN '未送信' WHEN 1 THEN '送信済'  ELSE '' END AS MAIL_SEND_STATUS
, CAST(0 AS bit) MAIL_SEND_CHECKED
, '拠点：' + GTKS.KYOTEN_NAME_RYAKU + CHAR(13) + CHAR(10) + ISNULL(SS.GYOUSHA_NAME,'') + CHAR(13) + CHAR(10) + ISNULL(SS.GENBA_NAME,'') + CHAR(13) + CHAR(10) + ISNULL(GBSS.GENBA_ADDRESS1,'') AS DENPYOU_CONTENT
, 0 ROW_NUM
, CAST(0 AS bit) KARADENPYOU_FLG_
, 1 AS HAISHA_FLG
, ISNULL(GTSS.GENCHAKU_PRIORITY, 0) SORT_KEY1_
, RIGHT(CONVERT(varchar, SS.GENCHAKU_TIME, 120), 8) SORT_KEY2_
, ISNULL(SS.HAISHA_SHURUI_CD, 0) SORT_KEY3_
, SS.GYOUSHA_CD SORT_KEY4_
, SS.GENBA_CD SORT_KEY5_
, ISNULL(SS.UKETSUKE_NUMBER, 0) SORT_KEY6_
, SS.UNPAN_GYOUSHA_CD AS GYOUSHA_CD
, GSSS.GYOUSHA_NAME_RYAKU
FROM (SELECT * FROM T_UKETSUKE_SS_ENTRY
WHERE DELETE_FLG = 0 
AND COURSE_KUMIKOMI_CD = 1
AND (ISNULL(SHARYOU_CD, '') = '' OR  SAGYOU_DATE IS NULL)
/*IF data.KyotenCd != null && data.KyotenCd != '' && data.KyotenCd != 99*/
AND (KYOTEN_CD = /*data.KyotenCd*/ OR KYOTEN_CD = 99)
/*END*/
AND ((SAGYOU_DATE IS NOT NULL AND SAGYOU_DATE = /*data.SagyouDate*/)
OR (SAGYOU_DATE IS NULL))
AND HAISHA_JOKYO_CD <> 4) SS
LEFT JOIN (SELECT * FROM M_GENBA WHERE DELETE_FLG = 0) GBSS
ON SS.GYOUSHA_CD = GBSS.GYOUSHA_CD AND SS.GENBA_CD = GBSS.GENBA_CD
LEFT JOIN (SELECT * FROM M_GENCHAKU_TIME WHERE DELETE_FLG = 0) GTSS
ON SS.GENCHAKU_TIME_CD = GTSS.GENCHAKU_TIME_CD
LEFT JOIN (SELECT * FROM M_KYOTEN WHERE DELETE_FLG = 0) GTKS
ON SS.KYOTEN_CD = GTKS.KYOTEN_CD
LEFT JOIN (SELECT * FROM M_GYOUSHA WHERE DELETE_FLG = 0) GSSS
ON SS.UNPAN_GYOUSHA_CD = GSSS.GYOUSHA_CD
UNION ALL
SELECT CAST(2 AS smallint) SHUBETSU_KBN_
, SK.SYSTEM_ID SYSTEM_ID_
, SK.UKETSUKE_NUMBER DENPYOU_NUM_
, SK.SEQ
, SK.HAISHA_JOKYO_CD AS HAISHA_JOKYO
, CASE SK.HAISHA_SHURUI_CD WHEN 2 THEN '仮' WHEN 3 THEN '確' ELSE '' END AS HAISHA_SHURUI
, CASE WHEN SK.SAGYOU_DATE_BEGIN IS NULL AND SK.SAGYOU_DATE_END IS NULL THEN '' WHEN SK.SAGYOU_DATE_END <> SK.SAGYOU_DATE THEN '期間' ELSE '期間終了' END AS SAGYOUDATE_KUBUN
, ISNULL(SK.GENCHAKU_TIME_NAME,'') + ISNULL(LEFT(CONVERT(varchar, SK.GENCHAKU_TIME, 114), 5),'') AS GENCHAKU_JIKAN
, GTSK.GENCHAKU_BACK_COLOR
, CASE SK.HAISHA_SIJISHO_FLG WHEN 0 THEN '未印刷' WHEN 1 THEN '印刷済' ELSE '' END AS HAISHA_SIJISHO_STATUS
, CAST(0 AS bit) HAISHA_SIJISHO_CHECKED
, CASE SK.MAIL_SEND_FLG WHEN 0 THEN '未送信' WHEN 1 THEN '送信済'  ELSE '' END AS MAIL_SEND_STATUS
, CAST(0 AS bit) MAIL_SEND_CHECKED
, '拠点：' + GTKK.KYOTEN_NAME_RYAKU + CHAR(13) + CHAR(10) + ISNULL(SK.GYOUSHA_NAME,'') + CHAR(13) + CHAR(10) + ISNULL(SK.GENBA_NAME,'') + CHAR(13) + CHAR(10) + ISNULL(GBSK.GENBA_ADDRESS1,'') AS DENPYOU_CONTENT
, 0 ROW_NUM
, CAST(0 AS bit) KARADENPYOU_FLG_
, 1 AS HAISHA_FLG
, ISNULL(GTSK.GENCHAKU_PRIORITY, 0) SORT_KEY1_
, RIGHT(CONVERT(varchar, SK.GENCHAKU_TIME, 120), 8) SORT_KEY2_
, ISNULL(SK.HAISHA_SHURUI_CD, 0) SORT_KEY3_
, SK.GYOUSHA_CD SORT_KEY4_
, SK.GENBA_CD SORT_KEY5_
, ISNULL(SK.UKETSUKE_NUMBER, 0) SORT_KEY6_
, SK.UNPAN_GYOUSHA_CD AS GYOUSHA_CD
, GSSK.GYOUSHA_NAME_RYAKU
FROM (SELECT * FROM T_UKETSUKE_SK_ENTRY
WHERE DELETE_FLG = 0 AND COURSE_KUMIKOMI_CD = 1
AND (ISNULL(SHARYOU_CD, '') = '' OR  SAGYOU_DATE IS NULL)
/*IF data.KyotenCd != null && data.KyotenCd != '' && data.KyotenCd != 99*/
AND (KYOTEN_CD = /*data.KyotenCd*/ OR KYOTEN_CD = 99)
/*END*/
AND ((SAGYOU_DATE IS NOT NULL AND SAGYOU_DATE = /*data.SagyouDate*/)
OR (SAGYOU_DATE IS NULL))
AND HAISHA_JOKYO_CD <> 4)  SK
LEFT JOIN (SELECT * FROM M_GENBA WHERE DELETE_FLG = 0) GBSK
ON SK.GYOUSHA_CD = GBSK.GYOUSHA_CD AND SK.GENBA_CD = GBSK.GENBA_CD
LEFT JOIN (SELECT * FROM M_GENCHAKU_TIME WHERE DELETE_FLG = 0) GTSK
ON SK.GENCHAKU_TIME_CD = GTSK.GENCHAKU_TIME_CD
LEFT JOIN (SELECT * FROM M_KYOTEN WHERE DELETE_FLG = 0) GTKK
ON SK.KYOTEN_CD = GTKK.KYOTEN_CD
LEFT JOIN (SELECT * FROM M_GYOUSHA WHERE DELETE_FLG = 0) GSSK
ON SK.UNPAN_GYOUSHA_CD = GSSK.GYOUSHA_CD
/*END*/
/*IF data.ShoriKbn == 1*/
UNION ALL
/*END*/
/*IF data.ShoriKbn == 1 || data.ShoriKbn == 3*/
SELECT CAST(3 AS smallint) SHUBETSU_KBN_
, TK.SYSTEM_ID SYSTEM_ID_
, TK.TEIKI_HAISHA_NUMBER DENPYOU_NUM_
, TK.SEQ
, '' AS HAISHA_JOKYO
, '' AS HAISHA_SHURUI
, '' AS SAGYOUDATE_KUBUN
, REPLACE(STR(TK.SAGYOU_BEGIN_HOUR, 2, 0), ' ', '0') + ':'
+ REPLACE(STR(TK.SAGYOU_BEGIN_MINUTE, 2, 0), ' ', '0') + '～'
+ REPLACE(STR(TK.SAGYOU_END_HOUR, 2, 0), ' ', '0') + ':'
+ REPLACE(STR(TK.SAGYOU_END_MINUTE, 2, 0), ' ', '0') AS GENCHAKU_JIKAN
, NULL GENCHAKU_BACK_COLOR
, '' AS HAISHA_SIJISHO_STATUS
, CAST(0 AS bit) HAISHA_SIJISHO_CHECKED
, '' AS MAIL_SEND_STATUS
, CAST(0 AS bit) MAIL_SEND_CHECKED
, '拠点：' + GTKN.KYOTEN_NAME_RYAKU + CHAR(13) + CHAR(10) + CN.COURSE_NAME_RYAKU AS DENPYOU_CONTENT
, 0 ROW_NUM
, CAST(0 AS bit) KARADENPYOU_FLG_
, 1 AS HAISHA_FLG
, POWER(2, 16) - 1 SORT_KEY1_
, REPLACE(STR(TK.SAGYOU_BEGIN_HOUR, 2, 0), ' ', '0') + ':'
+ REPLACE(STR(TK.SAGYOU_BEGIN_MINUTE, 2, 0), ' ', '0') + ':00' AS SORT_KEY2_
, 0 SORT_KEY3_
, '' SORT_KEY4_
, '' SORT_KEY5_
, TK.TEIKI_HAISHA_NUMBER SORT_KEY6_
, TK.UNPAN_GYOUSHA_CD AS GYOUSHA_CD
, GYTK.GYOUSHA_NAME_RYAKU
FROM (SELECT * FROM T_TEIKI_HAISHA_ENTRY
WHERE DELETE_FLG = 0
AND ISNULL(SHARYOU_CD, '') = '' 
/*IF data.KyotenCd != null && data.KyotenCd != '' && data.KyotenCd != 99*/
AND (KYOTEN_CD = /*data.KyotenCd*/ OR KYOTEN_CD = 99)
/*END*/
AND SAGYOU_DATE = /*data.SagyouDate*/) TK
LEFT JOIN (SELECT * FROM M_GYOUSHA WHERE DELETE_FLG = 0) GYTK
ON TK.UNPAN_GYOUSHA_CD = GYTK.GYOUSHA_CD
LEFT JOIN (SELECT * FROM M_COURSE_NAME WHERE DELETE_FLG = 0) CN
ON TK.COURSE_NAME_CD = CN.COURSE_NAME_CD
LEFT JOIN (SELECT * FROM M_KYOTEN WHERE DELETE_FLG = 0) GTKN
ON CN.KYOTEN_CD = GTKN.KYOTEN_CD
/*END*/