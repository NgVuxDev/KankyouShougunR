SELECT DISTINCT
	0 AS TAISHO
	,ENTRY.ROW_NO AS ROW_NUMBER
	,0 AS NIOROSHI
	,ENTRY.UKETSUKE_NUMBER
	,ENTRY.GENCHAKU_TIME_NAME
	,ENTRY.GENCHAKU_TIME
	,NULL AS TEIKI_HAISHA_NUMBER	--定期配車用のため未使用
	,ENTRY.GYOUSHA_CD
	,ENTRY.GYOUSHA_NAME AS GYOUSHA_NAME_RYAKU
	,ENTRY.GENBA_CD
	,ENTRY.GENBA_NAME AS GENBA_NAME_RYAKU
	,GEN.GENBA_ADDRESS1 AS GENBA_ADDRESS
	,ENTRY.SHASHU_CD
	,ENTRY.SHARYOU_CD
	,ENTRY.UNTENSHA_CD
	,ENTRY.UNPAN_GYOUSHA_CD
	,ENTRY.SAGYOU_DATE AS DELIVERY_DATE
	,ENTRY.SYSTEM_ID AS REF_SYSTEM_ID
	,NULL AS REF_DETAIL_SYSTEM_ID	--定期配車用のため未使用
	,ENTRY.DENPYOU_ATTR
	,MGD.POINT_ID
	,CASE ISNULL(MDOG.GYOUSHA_CD, '')
	WHEN '' THEN '未連携'
	ELSE '済'
	END AS RENKEI_JYOUKYOU
	,MDSS.DIGI_SHASHU_CD
	,MDSR.DIGI_SHARYOU_CD
	,0 AS NIZUMI_NIOROSHI_FLG
FROM
	-- 収集受付
	(SELECT
		1 AS ROW_NO
		,ENT.UKETSUKE_NUMBER
		,ENT.GENCHAKU_TIME_NAME
		,ENT.GENCHAKU_TIME
		,ENT.GYOUSHA_CD
		,ENT.GYOUSHA_NAME
		,ENT.GENBA_CD
		,ENT.GENBA_NAME
		,ENT.SHASHU_CD
		,ENT.SHARYOU_CD
		,ENT.UNTENSHA_CD
		,ENT.UNPAN_GYOUSHA_CD
		,ENT.SAGYOU_DATE
		,ENT.SYSTEM_ID
		,1 AS DENPYOU_ATTR
	FROM
		T_UKETSUKE_SS_ENTRY ENT
	LEFT JOIN T_UKETSUKE_SS_DETAIL AS DEL ON ENT.SYSTEM_ID = DEL.SYSTEM_ID AND ENT.SEQ = DEL.SEQ
	WHERE
		ENT.DELETE_FLG = 0
		AND (ENT.HAISHA_SHURUI_CD = 1 OR ENT.HAISHA_SHURUI_CD = 3)
		AND ENT.HAISHA_JOKYO_CD = 2
		AND (ENT.GENBA_CD IS NOT NULL AND ENT.GENBA_CD != '')
		AND (ENT.SHARYOU_CD IS NOT NULL AND ENT.SHARYOU_CD != '')
		AND (ENT.SAGYOU_DATE IS NOT NULL AND ENT.SAGYOU_DATE != '')
		AND CONVERT(DATETIME, CONVERT(nvarchar, ENT.SAGYOU_DATE, 111), 120) >= /*searchData.SAGYOU_DATE_FROM*/
		AND CONVERT(DATETIME, CONVERT(nvarchar, ENT.SAGYOU_DATE, 111), 120) <= /*searchData.SAGYOU_DATE_TO*/
		AND NOT EXISTS (SELECT * FROM T_LOGI_DELIVERY_DETAIL WHERE DENPYOU_ATTR = 1 AND DELETE_FLG = 0 AND REF_SYSTEM_ID = ENT.SYSTEM_ID)
		--画面上の条件
		/*IF searchData.GYOUSHA_CD != null && searchData.GYOUSHA_CD != ''*/ AND ENT.GYOUSHA_CD = /*searchData.GYOUSHA_CD*/ /*END*/
		/*IF searchData.GENBA_CD != null && searchData.GENBA_CD != ''*/ AND ENT.GENBA_CD = /*searchData.GENBA_CD*/ /*END*/
		/*IF selectData.UNPAN_GYOUSHA_CD != null && selectData.UNPAN_GYOUSHA_CD != ''*/ AND ENT.UNPAN_GYOUSHA_CD = /*selectData.UNPAN_GYOUSHA_CD*/ /*END*/
		/*IF selectData.SHARYOU_CD != null && selectData.SHARYOU_CD != ''*/ AND ENT.SHARYOU_CD = /*selectData.SHARYOU_CD*/ /*END*/
		/*IF selectData.SHASHU_CD != null && selectData.SHASHU_CD != ''*/ AND ENT.SHASHU_CD = /*selectData.SHASHU_CD*/ /*END*/
		/*IF selectData.UNTENSHA_CD != null && selectData.UNTENSHA_CD != ''*/ AND ENT.UNTENSHA_CD = /*selectData.UNTENSHA_CD*/ /*END*/
	UNION ALL
	-- 出荷受付
	SELECT
		1 AS ROW_NO
		,ENT.UKETSUKE_NUMBER
		,ENT.GENCHAKU_TIME_NAME
		,ENT.GENCHAKU_TIME
		,ENT.GYOUSHA_CD
		,ENT.GYOUSHA_NAME
		,ENT.GENBA_CD
		,ENT.GENBA_NAME
		,ENT.SHASHU_CD
		,ENT.SHARYOU_CD
		,ENT.UNTENSHA_CD
		,ENT.UNPAN_GYOUSHA_CD
		,ENT.SAGYOU_DATE
		,ENT.SYSTEM_ID
		,2 AS DENPYOU_ATTR
	FROM
		T_UKETSUKE_SK_ENTRY ENT
	LEFT JOIN T_UKETSUKE_SK_DETAIL AS DEL ON ENT.SYSTEM_ID = DEL.SYSTEM_ID AND ENT.SEQ = DEL.SEQ
	WHERE
		ENT.DELETE_FLG = 0
		AND (ENT.HAISHA_SHURUI_CD = 1 OR ENT.HAISHA_SHURUI_CD = 3)
		AND ENT.HAISHA_JOKYO_CD = 2
		AND (ENT.GENBA_CD IS NOT NULL AND ENT.GENBA_CD != '')
		AND (ENT.SHARYOU_CD IS NOT NULL AND ENT.SHARYOU_CD != '')
		AND (ENT.SAGYOU_DATE IS NOT NULL AND ENT.SAGYOU_DATE != '')
		AND CONVERT(DATETIME, CONVERT(nvarchar, ENT.SAGYOU_DATE, 111), 120) >= /*searchData.SAGYOU_DATE_FROM*/
		AND CONVERT(DATETIME, CONVERT(nvarchar, ENT.SAGYOU_DATE, 111), 120) <= /*searchData.SAGYOU_DATE_TO*/
		AND NOT EXISTS (SELECT * FROM T_LOGI_DELIVERY_DETAIL WHERE DENPYOU_ATTR = 2 AND DELETE_FLG = 0 AND REF_SYSTEM_ID = ENT.SYSTEM_ID)
		--画面上の条件
		/*IF searchData.GYOUSHA_CD != null && searchData.GYOUSHA_CD != ''*/ AND ENT.GYOUSHA_CD = /*searchData.GYOUSHA_CD*/ /*END*/
		/*IF searchData.GENBA_CD != null && searchData.GENBA_CD != ''*/ AND ENT.GENBA_CD = /*searchData.GENBA_CD*/ /*END*/
		/*IF selectData.UNPAN_GYOUSHA_CD != null && selectData.UNPAN_GYOUSHA_CD != ''*/ AND ENT.UNPAN_GYOUSHA_CD = /*selectData.UNPAN_GYOUSHA_CD*/ /*END*/
		/*IF selectData.SHARYOU_CD != null && selectData.SHARYOU_CD != ''*/ AND ENT.SHARYOU_CD = /*selectData.SHARYOU_CD*/ /*END*/
		/*IF selectData.SHASHU_CD != null && selectData.SHASHU_CD != ''*/ AND ENT.SHASHU_CD = /*selectData.SHASHU_CD*/ /*END*/
		/*IF selectData.UNTENSHA_CD != null && selectData.UNTENSHA_CD != ''*/ AND ENT.UNTENSHA_CD = /*selectData.UNTENSHA_CD*/ /*END*/
	) AS ENTRY
LEFT JOIN M_GENBA AS GEN ON ENTRY.GYOUSHA_CD = GEN.GYOUSHA_CD AND ENTRY.GENBA_CD = GEN.GENBA_CD
LEFT JOIN M_DIGI_OUTPUT_GENBA AS MDOG ON ENTRY.GYOUSHA_CD = MDOG.GYOUSHA_CD AND ENTRY.GENBA_CD = MDOG.GENBA_CD AND MDOG.JYOGAI_FLG = 0	--PointID確認用
LEFT JOIN M_GENBA_DIGI MGD ON ENTRY.GYOUSHA_CD = MGD.GYOUSHA_CD AND ENTRY.GENBA_CD = MGD.GENBA_CD	--PointID確認用
LEFT JOIN M_DIGI_OUTPUT_SHASHU MDSS ON ENTRY.SHASHU_CD = MDSS.SHASHU_CD	--車輌確認用
LEFT JOIN M_DIGI_OUTPUT_SHARYOU MDSR ON ENTRY.UNPAN_GYOUSHA_CD = MDSR.GYOUSHA_CD AND ENTRY.SHARYOU_CD = MDSR.SHARYOU_CD	--車輌確認用
ORDER BY ENTRY.UKETSUKE_NUMBER,ENTRY.ROW_NO
