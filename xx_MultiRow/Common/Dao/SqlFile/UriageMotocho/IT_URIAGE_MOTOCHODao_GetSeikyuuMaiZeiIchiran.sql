SELECT
	SEIDEN.TORIHIKISAKI_CD AS TORIHIKISAKI_CD,
	SEIDET.DENPYOU_SHURUI_CD AS DENPYOU_SHURUI_CD,
	SEIDEN.SEIKYUU_NUMBER AS SEIKYUU_NUMBER,
	ISNULL(SEIDEN.KONKAI_SEI_UTIZEI_GAKU, 0) AS KONKAI_SEI_UTIZEI_GAKU,
	ISNULL(SEIDEN.KONKAI_SEI_SOTOZEI_GAKU, 0) AS KONKAI_SEI_SOTOZEI_GAKU,
	UD.SYSTEM_ID AS SYSTEM_ID,
	UD.SEQ AS SEQ,
	UD.DETAIL_SYSTEM_ID AS DETAIL_SYSTEM_ID
FROM
	T_SEIKYUU_DENPYOU AS SEIDEN
	LEFT JOIN T_SEIKYUU_DETAIL AS SEIDET 
	ON SEIDEN.SEIKYUU_NUMBER = SEIDET.SEIKYUU_NUMBER
	LEFT JOIN T_UKEIRE_DETAIL AS UD 
	ON SEIDET.DENPYOU_SHURUI_CD = 1
	AND SEIDET.DENPYOU_SYSTEM_ID = UD.SYSTEM_ID
	AND SEIDET.DENPYOU_SEQ = UD.SEQ
	AND SEIDET.DETAIL_SYSTEM_ID = UD.DETAIL_SYSTEM_ID
	AND SEIDET.DELETE_FLG = 0
	LEFT JOIN T_UKEIRE_ENTRY AS UE
	ON  ((UE.SYSTEM_ID = UD.SYSTEM_ID) AND (UE.SEQ = UD.SEQ))
	AND UE.DELETE_FLG = 0
	/*IF startDay != null*/
	AND CONVERT (DATETIME ,CONVERT (NVARCHAR ,UE.URIAGE_DATE ,111),120) >= CONVERT (DATETIME ,CONVERT (NVARCHAR ,/*startDay*/'2014/05/01 0:00:00' ,111),120)
	/*END*/
	/*IF endDay != null*/
	AND CONVERT (DATETIME ,CONVERT (NVARCHAR ,UE.URIAGE_DATE ,111),120) <= CONVERT (DATETIME ,CONVERT (NVARCHAR ,/*endDay*/'2014/05/31 0:00:00' ,111),120)
	/*END*/
WHERE
	SEIDEN.DELETE_FLG = 0
AND	SEIDEN.TORIHIKISAKI_CD = /*torihikisakiCD*/'000001'
AND	CONVERT(DATETIME, CONVERT(nvarchar, SEIDEN.SEIKYUU_DATE, 111), 120) >= CONVERT(DATETIME, CONVERT(nvarchar, /*startDay*/'2014/05/01 0:00:00', 111), 120)
AND	CONVERT(DATETIME, CONVERT(nvarchar, SEIDEN.SEIKYUU_DATE, 111), 120) <= CONVERT(DATETIME, CONVERT(nvarchar, /*endDay*/'2014/05/31 0:00:00', 111), 120)

UNION ALL 
(
SELECT
	SEIDEN.TORIHIKISAKI_CD AS TORIHIKISAKI_CD,
	SEIDET.DENPYOU_SHURUI_CD AS DENPYOU_SHURUI_CD,
	SEIDEN.SEIKYUU_NUMBER AS SEIKYUU_NUMBER,
	--ISNULL(SUM(ISNULL(SEIDEN.KONKAI_SEI_UTIZEI_GAKU, 0)) + SUM(ISNULL(SEIDEN.KONKAI_SEI_SOTOZEI_GAKU, 0)), 0) AS SEIKYUU_TAX,
	ISNULL(SEIDEN.KONKAI_SEI_UTIZEI_GAKU, 0) AS KONKAI_SEI_UTIZEI_GAKU,
	ISNULL(SEIDEN.KONKAI_SEI_SOTOZEI_GAKU, 0) AS KONKAI_SEI_SOTOZEI_GAKU,
	SD.SYSTEM_ID AS SYSTEM_ID,
	SD.SEQ AS SEQ,
	SD.DETAIL_SYSTEM_ID AS DETAIL_SYSTEM_ID
FROM
	T_SEIKYUU_DENPYOU AS SEIDEN
	LEFT JOIN T_SEIKYUU_DETAIL AS SEIDET 
	ON SEIDEN.SEIKYUU_NUMBER = SEIDET.SEIKYUU_NUMBER
	LEFT JOIN T_SHUKKA_DETAIL AS SD 
	ON SEIDET.DENPYOU_SHURUI_CD = 2
	AND SEIDET.DENPYOU_SYSTEM_ID = SD.SYSTEM_ID
	AND SEIDET.DENPYOU_SEQ = SD.SEQ
	AND SEIDET.DETAIL_SYSTEM_ID = SD.DETAIL_SYSTEM_ID
	AND SEIDET.DELETE_FLG = 0
	LEFT JOIN T_SHUKKA_ENTRY AS SE
	ON  ((SE.SYSTEM_ID = SD.SYSTEM_ID) AND (SE.SEQ = SD.SEQ))
	AND SE.DELETE_FLG = 0
	AND (SE.KENSHU_MUST_KBN = 0 OR SE.KENSHU_MUST_KBN IS NULL)
	/*IF startDay != null*/
	AND CONVERT (DATETIME ,CONVERT (NVARCHAR ,SE.URIAGE_DATE ,111),120) >= CONVERT (DATETIME ,CONVERT (NVARCHAR ,/*startDay*/'2014/05/01 0:00:00' ,111),120)
	/*END*/
	/*IF endDay != null*/
	AND CONVERT (DATETIME ,CONVERT (NVARCHAR ,SE.URIAGE_DATE ,111),120) <= CONVERT (DATETIME ,CONVERT (NVARCHAR ,/*endDay*/'2014/05/31 0:00:00' ,111),120)
	/*END*/
WHERE
	SEIDEN.DELETE_FLG = 0
AND	SEIDEN.TORIHIKISAKI_CD = /*torihikisakiCD*/'000001'
AND	CONVERT(DATETIME, CONVERT(nvarchar, SEIDEN.SEIKYUU_DATE, 111), 120) >= CONVERT(DATETIME, CONVERT(nvarchar, /*startDay*/'2014/05/01 0:00:00', 111), 120)
AND	CONVERT(DATETIME, CONVERT(nvarchar, SEIDEN.SEIKYUU_DATE, 111), 120) <= CONVERT(DATETIME, CONVERT(nvarchar, /*endDay*/'2014/05/31 0:00:00', 111), 120)
)
UNION ALL 
(
SELECT
	SEIDEN.TORIHIKISAKI_CD AS TORIHIKISAKI_CD,
	SEIDET.DENPYOU_SHURUI_CD AS DENPYOU_SHURUI_CD,
	SEIDEN.SEIKYUU_NUMBER AS SEIKYUU_NUMBER,
	--ISNULL(SUM(ISNULL(SEIDEN.KONKAI_SEI_UTIZEI_GAKU, 0)) + SUM(ISNULL(SEIDEN.KONKAI_SEI_SOTOZEI_GAKU, 0)), 0) AS SEIKYUU_TAX,
	ISNULL(SEIDEN.KONKAI_SEI_UTIZEI_GAKU, 0) AS KONKAI_SEI_UTIZEI_GAKU,
	ISNULL(SEIDEN.KONKAI_SEI_SOTOZEI_GAKU, 0) AS KONKAI_SEI_SOTOZEI_GAKU,
	SD.SYSTEM_ID AS SYSTEM_ID,
	SD.SEQ AS SEQ,
	SD.DETAIL_SYSTEM_ID AS DETAIL_SYSTEM_ID
FROM
	T_SEIKYUU_DENPYOU AS SEIDEN
	LEFT JOIN T_SEIKYUU_DETAIL AS SEIDET 
	ON SEIDEN.SEIKYUU_NUMBER = SEIDET.SEIKYUU_NUMBER
	LEFT JOIN (
		SELECT
			KENSHU_DETAIL.SYSTEM_ID,
			KENSHU_DETAIL.SEQ,
			KENSHU_DETAIL.DETAIL_SYSTEM_ID,
			KENSHU_DETAIL.KENSHU_SYSTEM_ID,
			KENSHU_DETAIL.SHUKKA_NUMBER,
			KENSHU_DETAIL.ROW_NO,
			KENSHU_DETAIL.KENSHU_ROW_NO,
			KENSHU_DETAIL.DENPYOU_KBN_CD,
			KENSHU_DETAIL.HINMEI_CD,
			KENSHU_DETAIL.HINMEI_NAME,
			KENSHU_DETAIL.SHUKKA_NET,
			KENSHU_DETAIL.BUBIKI,
			KENSHU_DETAIL.KENSHU_NET,
			KENSHU_DETAIL.SUURYOU,
			KENSHU_DETAIL.UNIT_CD,
			KENSHU_DETAIL.TANKA,
			KENSHU_DETAIL.KINGAKU,
			KENSHU_DETAIL.TAX_SOTO,
			KENSHU_DETAIL.TAX_UCHI,
			KENSHU_DETAIL.HINMEI_ZEI_KBN_CD,
			KENSHU_DETAIL.HINMEI_KINGAKU,
			KENSHU_DETAIL.HINMEI_TAX_SOTO,
			KENSHU_DETAIL.HINMEI_TAX_UCHI
		FROM
			T_SHUKKA_DETAIL SHUKKA_DETAIL
			INNER JOIN T_KENSHU_DETAIL KENSHU_DETAIL
				ON SHUKKA_DETAIL.SYSTEM_ID = KENSHU_DETAIL.SYSTEM_ID
				AND SHUKKA_DETAIL.SEQ = KENSHU_DETAIL.SEQ
				AND SHUKKA_DETAIL.DETAIL_SYSTEM_ID = KENSHU_DETAIL.DETAIL_SYSTEM_ID
	) AS SD
	ON SEIDET.DENPYOU_SHURUI_CD = 2
	AND SEIDET.DENPYOU_SYSTEM_ID = SD.SYSTEM_ID
	AND SEIDET.DENPYOU_SEQ = SD.SEQ
	AND SEIDET.DETAIL_SYSTEM_ID = SD.DETAIL_SYSTEM_ID
	AND SEIDET.DELETE_FLG = 0
	LEFT JOIN T_SHUKKA_ENTRY AS SE
	ON  ((SE.SYSTEM_ID = SD.SYSTEM_ID) AND (SE.SEQ = SD.SEQ))
	AND SE.DELETE_FLG = 0
	AND SE.KENSHU_MUST_KBN = 1
	AND SE.KENSHU_DATE IS NOT NULL
	/*IF startDay != null*/
	AND CONVERT (DATETIME ,CONVERT (NVARCHAR ,SE.KENSHU_URIAGE_DATE ,111),120) >= CONVERT (DATETIME ,CONVERT (NVARCHAR ,/*startDay*/'2014/05/01 0:00:00' ,111),120)
	/*END*/
	/*IF endDay != null*/
	AND CONVERT (DATETIME ,CONVERT (NVARCHAR ,SE.KENSHU_URIAGE_DATE ,111),120) <= CONVERT (DATETIME ,CONVERT (NVARCHAR ,/*endDay*/'2014/05/31 0:00:00' ,111),120)
	/*END*/
WHERE
	SEIDEN.DELETE_FLG = 0
AND	SEIDEN.TORIHIKISAKI_CD = /*torihikisakiCD*/'000001'
AND	CONVERT(DATETIME, CONVERT(nvarchar, SEIDEN.SEIKYUU_DATE, 111), 120) >= CONVERT(DATETIME, CONVERT(nvarchar, /*startDay*/'2014/05/01 0:00:00', 111), 120)
AND	CONVERT(DATETIME, CONVERT(nvarchar, SEIDEN.SEIKYUU_DATE, 111), 120) <= CONVERT(DATETIME, CONVERT(nvarchar, /*endDay*/'2014/05/31 0:00:00', 111), 120)
)
UNION ALL 
(
SELECT
	SEIDEN.TORIHIKISAKI_CD AS TORIHIKISAKI_CD,
	SEIDET.DENPYOU_SHURUI_CD AS DENPYOU_SHURUI_CD,
	SEIDEN.SEIKYUU_NUMBER AS SEIKYUU_NUMBER,
	--ISNULL(SUM(ISNULL(SEIDEN.KONKAI_SEI_UTIZEI_GAKU, 0)) + SUM(ISNULL(SEIDEN.KONKAI_SEI_SOTOZEI_GAKU, 0)), 0) AS SEIKYUU_TAX,
	ISNULL(SEIDEN.KONKAI_SEI_UTIZEI_GAKU, 0) AS KONKAI_SEI_UTIZEI_GAKU,
	ISNULL(SEIDEN.KONKAI_SEI_SOTOZEI_GAKU, 0) AS KONKAI_SEI_SOTOZEI_GAKU,
	U_SD.SYSTEM_ID AS SYSTEM_ID,
	U_SD.SEQ AS SEQ,
	U_SD.DETAIL_SYSTEM_ID AS DETAIL_SYSTEM_ID
FROM
	T_SEIKYUU_DENPYOU AS SEIDEN
	LEFT JOIN T_SEIKYUU_DETAIL AS SEIDET 
	ON SEIDEN.SEIKYUU_NUMBER = SEIDET.SEIKYUU_NUMBER
	LEFT JOIN T_UR_SH_DETAIL AS U_SD 
	ON SEIDET.DENPYOU_SHURUI_CD = 3
	AND SEIDET.DENPYOU_SYSTEM_ID = U_SD.SYSTEM_ID
	AND SEIDET.DENPYOU_SEQ = U_SD.SEQ
	AND SEIDET.DETAIL_SYSTEM_ID = U_SD.DETAIL_SYSTEM_ID
	AND SEIDET.DELETE_FLG = 0
	LEFT JOIN T_UR_SH_ENTRY AS U_SE
	ON  ((U_SE.SYSTEM_ID = U_SD.SYSTEM_ID) AND (U_SE.SEQ = U_SD.SEQ))
	AND U_SE.DELETE_FLG = 0
	/*IF startDay != null*/
	AND CONVERT (DATETIME ,CONVERT (NVARCHAR ,U_SE.URIAGE_DATE ,111),120) >= CONVERT (DATETIME ,CONVERT (NVARCHAR ,/*startDay*/'2014/05/01 0:00:00' ,111),120)
	/*END*/
	/*IF endDay != null*/
	AND CONVERT (DATETIME ,CONVERT (NVARCHAR ,U_SE.URIAGE_DATE ,111),120) <= CONVERT (DATETIME ,CONVERT (NVARCHAR ,/*endDay*/'2014/05/31 0:00:00' ,111),120)
	/*END*/
WHERE
	SEIDEN.DELETE_FLG = 0
AND	SEIDEN.TORIHIKISAKI_CD = /*torihikisakiCD*/'000001'
AND	CONVERT(DATETIME, CONVERT(nvarchar, SEIDEN.SEIKYUU_DATE, 111), 120) >= CONVERT(DATETIME, CONVERT(nvarchar, /*startDay*/'2014/05/01 0:00:00', 111), 120)
AND	CONVERT(DATETIME, CONVERT(nvarchar, SEIDEN.SEIKYUU_DATE, 111), 120) <= CONVERT(DATETIME, CONVERT(nvarchar, /*endDay*/'2014/05/31 0:00:00', 111), 120)
)